import{d as A,m as I,p as q,r,B as V,k as S,l as $,e as b,o as f,F as B,b as g,w as x,c as z,f as R,u as F,a as c,q as m,i as T,h as j,y as G,n as J}from"./app-CZLkYVhz.js";import{_ as P}from"./Dropdown.vue_vue_type_script_setup_true_lang-2TV_nqEm.js";import{_ as Q}from"./TagCreateModal.vue_vue_type_script_setup_true_lang-JZMNiY85.js";import{_ as W}from"./MultiselectDropdownItem.vue_vue_type_script_setup_true_lang-DfGNKO5q.js";import{U as X,r as Y}from"./component-CexCnHe5.js";const Z=["value","onKeydown"],ee=["value","data-tag-id"],ae={class:"hover:bg-card-background-active rounded-b-lg"},se=A({__name:"TagDropdown",props:I({tags:{},createTag:{},align:{default:"start"}},{modelValue:{default:[]},modelModifiers:{}}),emits:I(["changed","submit"],["update:modelValue"]),setup(y,{emit:M}){const u=y,l=q(y,"modelValue"),C=r(null),s=r(!1),U=r(null),i=r("");function D(a){return l.value.includes(a)}function p(a){l.value.includes(a)?l.value=l.value.filter(e=>e!==a):l.value=[...l.value,a],h("changed")}const _=r(u.tags);V(s,a=>{a&&(S(()=>{var e;(e=C.value)==null||e.focus()}),_.value=[...u.tags].sort((e,t)=>{const d=l.value.includes(e.id),k=l.value.includes(t.id);return d===k?e.name.localeCompare(t.name):l.value.includes(e.id)?-1:1}),S(()=>{n.value.length>0&&(o.value=n.value[0].id)}))});const n=$(()=>_.value.filter(a=>{var e,t;return a.name.toLowerCase().includes(((t=(e=i.value)==null?void 0:e.toLowerCase())==null?void 0:t.trim())||"")}));async function E(a){const e=await u.createTag(a);return e&&p(e.id),i.value="",e}async function H(){o.value&&p(o.value)}V(n,()=>{n.value.length>0&&(o.value=n.value[0].id)});function N(a){const e=a.target.value;if(e===" "){i.value="";const t=o.value;if(t){const d=u.tags.find(k=>k.id===t);d&&p(d.id)}}else i.value=e}const h=M;function O(a){l.value.includes(a)?l.value=[...l.value].filter(e=>e!==a):l.value=[...l.value,a],h("changed")}function K(){if(v.value){const a=n.value.indexOf(v.value);a===0?o.value=n.value[n.value.length-1].id:o.value=n.value[a-1].id}}function L(){if(v.value){const a=n.value.indexOf(v.value);a===n.value.length-1?o.value=n.value[0].id:o.value=n.value[a+1].id}}const o=r(null),v=$(()=>u.tags.find(a=>a.id===o.value)),w=r(!1);return(a,e)=>(f(),b(B,null,[g(Q,{show:w.value,"onUpdate:show":e[0]||(e[0]=t=>w.value=t),"create-tag":E},null,8,["show"]),g(P,{modelValue:s.value,"onUpdate:modelValue":e[3]||(e[3]=t=>s.value=t),align:a.align,"close-on-content-click":!1,onSubmit:e[4]||(e[4]=t=>h("submit"))},{trigger:x(()=>[G(a.$slots,"trigger")]),content:x(()=>[s.value?(f(),z(F(X),{key:0,options:{immediate:!0,allowOutsideClick:!0}},{default:x(()=>[c("input",{ref_key:"searchInput",ref:C,value:i.value,"data-testid":"tag_dropdown_search",class:"dark:bg-[#171E31] dark:text-[#BFC7D6] border-0 placeholder-muted text-sm text-text-primary py-2.5 focus:ring-0 border-b border-card-background-separator focus:border-card-background-separator w-full",placeholder:"Search for a Tag...",onInput:N,onKeydown:[e[1]||(e[1]=m(T(t=>s.value=!1,["prevent"]),["esc"])),m(H,["enter"]),m(T(K,["prevent"]),["up"]),m(T(L,["prevent"]),["down"])]},null,40,Z),c("div",{ref_key:"dropdownViewport",ref:U,class:"w-60 max-h-60 overflow-y-scroll"},[(f(!0),b(B,null,j(n.value,t=>(f(),b("div",{key:t.id,role:"option",value:t.id,class:J({"bg-card-background-active":t.id===o.value}),"data-testid":"tag_dropdown_entries","data-tag-id":t.id},[g(W,{selected:D(t.id),name:t.name,onClick:d=>O(t.id)},null,8,["selected","name","onClick"])],10,ee))),128))],512),c("div",ae,[c("button",{class:"dark:bg-[#171E31] dark:text-[#BFC7D6] hover:bg-gray-600/10 hover:dark:bg-gray-800/80 w-full flex space-x-3 items-center px-4 py-3 text-xs font-semibold border-t dark:border-[#303F61]",onClick:e[2]||(e[2]=t=>{s.value=!1,w.value=!0})},[g(F(Y),{class:"w-5 flex-shrink-0 text-icon-default"}),e[5]||(e[5]=c("span",null,"Create new Tag",-1))])])]),_:1})):R("",!0)]),_:3},8,["modelValue","align"])],64))}});export{se as _};
//# sourceMappingURL=TagDropdown.vue_vue_type_script_setup_true_lang-fidraWsZ.js.map
