{"version":3,"file":"TimeEntryRowDurationInput.vue_vue_type_script_setup_true_lang-G0TwUc7C.js","sources":["../../../resources/js/packages/ui/src/TimeEntry/TimeEntryRowDurationInput.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport {\n    calculateDifference,\n    formatHumanReadableDuration,\n    parseTimeInput,\n} from '@/packages/ui/src/utils/time';\nimport { computed, defineProps, ref, inject, type ComputedRef } from 'vue';\nimport dayjs from 'dayjs';\nimport type { Organization } from '@/packages/api/src';\n\nconst organization = inject<ComputedRef<Organization>>('organization');\n\nconst organizationSettings = computed(() => ({\n    intervalFormat: organization?.value?.interval_format ?? 'hours-minutes',\n    numberFormat: organization?.value?.number_format ?? 'point',\n}));\n\nconst props = defineProps<{\n    start: string;\n    end: string | null;\n}>();\nconst emit = defineEmits<{\n    changed: [start: string, end: string | null];\n}>();\n\nconst temporaryCustomTimerEntry = ref<string>('');\nconst open = ref(false);\n\nfunction updateTimerAndStartLiveTimerUpdate() {\n    const defaultUnit =\n        organizationSettings?.value?.intervalFormat === 'decimal'\n            ? 'hours'\n            : 'minutes';\n    const { seconds } = parseTimeInput(\n        temporaryCustomTimerEntry.value,\n        defaultUnit\n    );\n    if (seconds && seconds > 0) {\n        let newEndDate = props.end;\n        let newStartDate = props.start;\n        if (props.end) {\n            // only update end for time entries that are already finished\n            newEndDate = dayjs(props.start).utc().add(seconds, 's').format();\n        } else {\n            newStartDate = dayjs().utc().subtract(seconds, 's').format();\n        }\n        emit('changed', newStartDate, newEndDate);\n    }\n    temporaryCustomTimerEntry.value = '';\n}\n\nconst currentTime = computed({\n    get() {\n        if (temporaryCustomTimerEntry.value !== '') {\n            return temporaryCustomTimerEntry.value;\n        }\n        return formatHumanReadableDuration(\n            calculateDifference(props.start, props.end),\n            organizationSettings.value.intervalFormat,\n            organizationSettings.value.numberFormat\n        );\n    },\n    // setter\n    set(newValue) {\n        if (newValue) {\n            temporaryCustomTimerEntry.value = newValue;\n        } else {\n            temporaryCustomTimerEntry.value = '';\n        }\n    },\n});\n\nfunction selectInput(event: Event) {\n    open.value = true;\n    const target = event.target as HTMLInputElement;\n    target.select();\n}\n</script>\n\n<template>\n    <input\n        v-model=\"currentTime\"\n        data-testid=\"time_entry_duration_input\"\n        name=\"Duration\"\n        class=\" w-[90px] px-2.5 py-1.5 bg-transparent text-right  hover:dark:bg-[#0C101E] rounded-lg border border-transparent hover:border-[#303F61]r text-sm font-semibold focus-visible:bg-tertiary focus-visible:border-transparent focus-visible:ring-2 focus-visible:ring-ring\"\n        @focus=\"selectInput\"\n        @keydown.tab=\"open = false\"\n        @blur=\"updateTimerAndStartLiveTimerUpdate\"\n        @keydown.enter=\"updateTimerAndStartLiveTimerUpdate\" />\n</template>\n\n<style scoped></style>\n"],"names":["organization","inject","organizationSettings","computed","_a","_b","props","__props","emit","__emit","temporaryCustomTimerEntry","ref","open","updateTimerAndStartLiveTimerUpdate","defaultUnit","seconds","parseTimeInput","newEndDate","newStartDate","dayjs","currentTime","formatHumanReadableDuration","calculateDifference","newValue","selectInput","event","_createElementBlock","$event"],"mappings":"oSAUA,MAAMA,EAAeC,EAAkC,cAAc,EAE/DC,EAAuBC,EAAS,IAAA,SAAO,OACzC,iBAAgBC,EAAAJ,GAAA,YAAAA,EAAc,QAAd,YAAAI,EAAqB,kBAAmB,gBACxD,eAAcC,EAAAL,GAAA,YAAAA,EAAc,QAAd,YAAAK,EAAqB,gBAAiB,OAAA,EACtD,EAEIC,EAAQC,EAIRC,EAAOC,EAIPC,EAA4BC,EAAY,EAAE,EAC1CC,EAAOD,EAAI,EAAK,EAEtB,SAASE,GAAqC,OAC1C,MAAMC,IACFV,EAAAF,GAAA,YAAAA,EAAsB,QAAtB,YAAAE,EAA6B,kBAAmB,UAC1C,QACA,UACJ,CAAE,QAAAW,GAAYC,EAChBN,EAA0B,MAC1BI,CAAA,EAEJ,GAAIC,GAAWA,EAAU,EAAG,CACxB,IAAIE,EAAaX,EAAM,IACnBY,EAAeZ,EAAM,MACrBA,EAAM,IAENW,EAAaE,EAAMb,EAAM,KAAK,EAAE,MAAM,IAAIS,EAAS,GAAG,EAAE,OAAA,EAExDG,EAAeC,EAAA,EAAQ,IAAA,EAAM,SAASJ,EAAS,GAAG,EAAE,OAAA,EAExDP,EAAK,UAAWU,EAAcD,CAAU,CAAA,CAE5CP,EAA0B,MAAQ,EAAA,CAGtC,MAAMU,EAAcjB,EAAS,CACzB,KAAM,CACF,OAAIO,EAA0B,QAAU,GAC7BA,EAA0B,MAE9BW,EACHC,EAAoBhB,EAAM,MAAOA,EAAM,GAAG,EAC1CJ,EAAqB,MAAM,eAC3BA,EAAqB,MAAM,YAAA,CAC/B,EAGJ,IAAIqB,EAAU,CACNA,EACAb,EAA0B,MAAQa,EAElCb,EAA0B,MAAQ,EACtC,CACJ,CACH,EAED,SAASc,EAAYC,EAAc,CAC/Bb,EAAK,MAAQ,GACEa,EAAM,OACd,OAAA,CAAO,qBAKdC,EAQ0D,QAAA,sCAP7CN,EAAW,MAAAO,GACpB,cAAY,4BACZ,KAAK,WACL,MAAM,sQACL,QAAOH,EACP,UAAO,kBAAMZ,EAAA,MAAI,GAAA,CAAA,KAAA,CAAA,KAEFC,EAAkC,CAAA,OAAA,CAAA,CAAA,EADjD,OAAMA,CAAA,iBANEO,EAAA,KAAW,CAAA"}