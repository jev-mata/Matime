{"version":3,"file":"MultiselectDropdown.vue_vue_type_script_setup_true_lang-Vdr6fO98.js","sources":["../../../resources/js/packages/ui/src/Input/MultiselectDropdown.vue"],"sourcesContent":["<script setup lang=\"ts\" generic=\"T\">\nimport Dropdown from '@/packages/ui/src/Input/Dropdown.vue';\nimport { type Component, computed, nextTick, ref, watch } from 'vue';\nimport MultiselectDropdownItem from '@/packages/ui/src/Input/MultiselectDropdownItem.vue';\n\nconst model = defineModel<string[]>({\n    default: [],\n});\n\nconst props = defineProps<{\n    items: T[];\n    searchPlaceholder: string;\n    getKeyFromItem: (item: T) => string;\n    getNameForItem: (item: T) => string;\n}>();\n\nconst searchInput = ref<HTMLInputElement | null>(null);\nconst open = ref(false);\nconst dropdownViewport = ref<Component | null>(null);\n\nconst searchValue = ref('');\n\nfunction isItemSelected(id: string) {\n    return model.value.includes(id);\n}\n\nfunction addOrRemoveItemFromSelection(id: string) {\n    if (model.value.includes(id)) {\n        model.value = model.value.filter((itemId) => itemId !== id);\n    } else {\n        model.value.push(id);\n    }\n    emit('changed');\n}\n\nwatch(open, (isOpen) => {\n    if (isOpen) {\n        nextTick(() => {\n            searchInput.value?.focus();\n        });\n\n        // sort tags alphabetically\n        [...props.items].sort((a, b) => {\n            const aIsSelected = model.value.includes(props.getKeyFromItem(a));\n            const bIsSelected = model.value.includes(props.getKeyFromItem(b));\n            if (aIsSelected === bIsSelected) {\n                return props\n                    .getNameForItem(a)\n                    .localeCompare(props.getNameForItem(b));\n            }\n            return model.value.includes(props.getKeyFromItem(a)) ? -1 : 1;\n        });\n        nextTick(() => {\n            if (filteredItems.value.length > 0) {\n                highlightedItemId.value = props.getKeyFromItem(\n                    filteredItems.value[0]\n                );\n            }\n        });\n    }\n});\n\nconst filteredItems = computed<T[]>(() => {\n    return props.items.filter((item: T) => {\n        return props\n            .getNameForItem(item)\n            .toLowerCase()\n            .includes(searchValue.value?.toLowerCase()?.trim() || '');\n    });\n});\n\nwatch(filteredItems, () => {\n    if (filteredItems.value.length > 0) {\n        highlightedItemId.value = props.getKeyFromItem(filteredItems.value[0]);\n    }\n});\n\nfunction updateSearchValue(event: Event) {\n    const newInput = (event.target as HTMLInputElement).value;\n    if (newInput === ' ') {\n        searchValue.value = '';\n        const highlightedTagId = highlightedItemId.value;\n        if (highlightedTagId) {\n            const highlightedItem = props.items.find(\n                (item) => props.getKeyFromItem(item) === highlightedTagId\n            );\n            if (highlightedItem) {\n                addOrRemoveItemFromSelection(\n                    props.getKeyFromItem(highlightedItem)\n                );\n            }\n        }\n    } else {\n        searchValue.value = newInput;\n    }\n}\n\nconst emit = defineEmits(['update:modelValue', 'changed']);\n\nfunction toggleItem(newValue: string | null) {\n    if (newValue !== null) {\n        if (model.value.includes(newValue)) {\n            model.value = [...model.value].filter((id) => id !== newValue);\n        } else {\n            model.value = [...model.value, newValue];\n        }\n        emit('changed');\n    }\n}\n\nfunction moveHighlightUp() {\n    if (highlightedItem.value) {\n        const currentHightlightedIndex = filteredItems.value.indexOf(\n            highlightedItem.value\n        );\n        if (currentHightlightedIndex === 0) {\n            highlightedItemId.value = props.getKeyFromItem(\n                filteredItems.value[filteredItems.value.length - 1]\n            );\n        } else {\n            highlightedItemId.value = props.getKeyFromItem(\n                filteredItems.value[currentHightlightedIndex - 1]\n            );\n        }\n    }\n}\n\nfunction moveHighlightDown() {\n    if (highlightedItem.value) {\n        const currentHightlightedIndex = filteredItems.value.indexOf(\n            highlightedItem.value\n        );\n        if (currentHightlightedIndex === filteredItems.value.length - 1) {\n            highlightedItemId.value = props.getKeyFromItem(\n                filteredItems.value[0]\n            );\n        } else {\n            highlightedItemId.value = props.getKeyFromItem(\n                filteredItems.value[currentHightlightedIndex + 1]\n            );\n        }\n    }\n}\n\nconst highlightedItemId = ref<string | null>(null);\nconst highlightedItem = computed(() => {\n    return props.items.find(\n        (item) => props.getKeyFromItem(item) === highlightedItemId.value\n    );\n});\n</script>\n\n<template>\n    <Dropdown v-model=\"open\" align=\"start\" :close-on-content-click=\"false\">\n        <template #trigger>\n            <slot name=\"trigger\"></slot>\n        </template>\n        <template #content>\n            <input\n                ref=\"searchInput\"\n                :value=\"searchValue\"\n                class=\"border-0 placeholder-muted text-sm font-bold dark:text-[#BFC7D6]  dark:bg-[#171E31] bg-white   py-2.5 focus:ring-0 border-b   focus:border-card-background-separator w-full\"\n                :placeholder=\"searchPlaceholder\"\n                @input=\"updateSearchValue\"\n                @keydown.up.prevent=\"moveHighlightUp\"\n                @keydown.down.prevent=\"moveHighlightDown\"\n                @keydown.enter=\"toggleItem(highlightedItemId)\" />\n            <div\n                ref=\"dropdownViewport\"\n                class=\"min-w-60 max-w-80 max-h-60 overflow-y-scroll\">\n                <div\n                    v-for=\"item in filteredItems\"\n                    :key=\"props.getKeyFromItem(item)\"\n                    role=\"option\"\n                    :value=\"props.getKeyFromItem(item)\"\n                    :style=\"{color:(item as any)?.color}\"\n                    :class=\"{\n                        'dark:bg-[#303F61] dark:text-[#BFC7D6]':\n                            props.getKeyFromItem(item) === highlightedItemId,\n                    }\"\n                    :data-item-id=\"props.getKeyFromItem(item)\"> \n                    <MultiselectDropdownItem\n                        :selected=\"isItemSelected(props.getKeyFromItem(item))\"\n                        :name=\"\n                            props.getNameForItem(item)\n                        \" \n                    :style=\"{color:(item as any)?.color}\"\n                        @click=\"toggleItem(props.getKeyFromItem(item))\"></MultiselectDropdownItem>\n                </div>\n            </div>\n        </template>\n    </Dropdown>\n</template>\n\n<style scoped></style>\n"],"names":["model","_useModel","__props","props","searchInput","ref","open","dropdownViewport","searchValue","isItemSelected","id","addOrRemoveItemFromSelection","itemId","emit","watch","isOpen","nextTick","_a","a","b","aIsSelected","bIsSelected","filteredItems","highlightedItemId","computed","item","_b","updateSearchValue","event","newInput","highlightedTagId","highlightedItem","__emit","toggleItem","newValue","moveHighlightUp","currentHightlightedIndex","moveHighlightDown","_createBlock","Dropdown","$event","_renderSlot","_ctx","_createElementVNode","searchPlaceholder","_cache","_withKeys","_createElementBlock","_Fragment","_renderList","_normalizeStyle","_normalizeClass","_createVNode","MultiselectDropdownItem"],"mappings":"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"}