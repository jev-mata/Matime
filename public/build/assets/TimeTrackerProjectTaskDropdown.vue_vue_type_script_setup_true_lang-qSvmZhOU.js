import{h as d,o as r,f as c,d as F,x as E,y as A,D as L,r as b,b as Z,u as _,P as he,z as B,g as I,e as y,v as ue,c as z,n as H,V as xe,F as S,w as U,j as $,i as G,t as D}from"./app-DUID27fb.js";import{u as we,s as ke}from"./index-D03bkDOQ.js";import{D as re}from"./DatePicker-BtvDsz6k.js";import{h as j,g as T}from"./time-D8fzVCgi.js";import{d as ye}from"./utc-CJhWvcZK.js";import{t as Q}from"./bundle-mjs-D696Ktp4.js";import"./money-C8rBYmfS.js";import{_ as be}from"./TextInput.vue_vue_type_script_setup_true_lang-DItGfPyY.js";import"./useMembers-fKrmzvmk.js";import"./notification-cXlbw5Vr.js";import"./permissions-BsGx_A78.js";import{B as _e}from"./BillableIcon-BvHKiDs7.js";import{b as je,k as Ce}from"./AppLayout.vue_vue_type_script_setup_true_lang-B5it3Y5_.js";import{_ as Ie,a as Pe}from"./ProjectDropdownItem.vue_vue_type_script_setup_true_lang-DK8_tzCt.js";import{a as Ve}from"./SelectDropdown.vue_vue_type_script_setup_true_lang-BzQ1fREU.js";import{_ as $e}from"./ProjectCreateModal.vue_vue_type_script_setup_true_lang-DoyrMytA.js";import{U as Be}from"./component-CGwmUpCj.js";import{r as Me}from"./PlusIcon-BdS72468.js";function Ne(w,C){return r(),d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[c("path",{"fill-rule":"evenodd",d:"M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z","clip-rule":"evenodd"})])}function ze(w,C){return r(),d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[c("path",{"fill-rule":"evenodd",d:"M6.22 4.22a.75.75 0 0 1 1.06 0l3.25 3.25a.75.75 0 0 1 0 1.06l-3.25 3.25a.75.75 0 0 1-1.06-1.06L8.94 8 6.22 5.28a.75.75 0 0 1 0-1.06Z","clip-rule":"evenodd"})])}function He(w,C){return r(),d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[c("path",{d:"M3.75 7.25a.75.75 0 0 0 0 1.5h8.5a.75.75 0 0 0 0-1.5h-8.5Z"})])}function Se(w,C){return r(),d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[c("path",{"fill-rule":"evenodd",d:"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14Zm.75-10.25v2.5h2.5a.75.75 0 0 1 0 1.5h-2.5v2.5a.75.75 0 0 1-1.5 0v-2.5h-2.5a.75.75 0 0 1 0-1.5h2.5v-2.5a.75.75 0 0 1 1.5 0Z","clip-rule":"evenodd"})])}const ie=F({__name:"TimePickerSimple",props:E({size:{default:"base"},focus:{type:Boolean,default:!1}},{modelValue:{default:null},modelModifiers:{}}),emits:E(["changed"],["update:modelValue"]),setup(w,{emit:C}){const l=A(w,"modelValue"),m=w;function k(v){const t=v.target.value.trim();if(t.split(":").length===2){const[f,V]=t.split(":");!isNaN(parseInt(f))&&!isNaN(parseInt(V))&&(l.value=j(l.value).set("hours",Math.min(parseInt(f),23)).set("minutes",Math.min(parseInt(V),59)).format(),h("changed",l.value))}else if(/^\d+$/.test(t))if(t.length===4){const[f,V]=[t.slice(0,2),t.slice(2,4)];l.value=j(l.value).set("hours",Math.min(parseInt(f),23)).set("minutes",Math.min(parseInt(V),59)).format(),h("changed",l.value)}else if(t.length===3){const[f,V]=[t.slice(0,1),t.slice(1,3)];l.value=j(l.value).set("hours",Math.min(parseInt(f),23)).set("minutes",Math.min(parseInt(V),59)).format(),h("changed",l.value)}else t.length===2?(l.value=j(l.value).set("hours",Math.min(parseInt(t),23)).set("minutes",0).format(),h("changed",l.value)):t.length===1&&(l.value=j(l.value).set("hours",Math.min(parseInt(t),23)).set("minutes",0).format(),h("changed",l.value));g.value=j(l.value).format("HH:mm")}L(l,v=>{g.value=v?j(v).format("HH:mm"):null});const i=b(null),h=C;we(i,{initialValue:m.focus});const g=b(l.value?j(l.value).format("HH:mm"):null);return(v,u)=>(r(),Z(_(be),he(v.$attrs,{ref_key:"timeInput",ref:i,modelValue:g.value,"onUpdate:modelValue":u[0]||(u[0]=t=>g.value=t),class:_(Q)("text-center w-24 px-3 py-2",v.size==="large"&&"w-28"),"data-testid":"time_picker_input",type:"text",onBlur:k,onFocus:u[1]||(u[1]=t=>t.target.select()),onMouseup:u[2]||(u[2]=t=>t.target.select()),onClick:u[3]||(u[3]=t=>t.target.select()),onPointerup:u[4]||(u[4]=t=>t.target.select())}),null,16,["modelValue","class"]))}}),Ue={class:"space-y-2"},Le={class:"px-2"},Ee={key:0,class:"space-y-2"},De={key:1,class:"text-text-secondary"},gt=F({__name:"TimeRangeSelector",props:{start:{},end:{},focus:{type:Boolean}},emits:["changed","close"],setup(w,{emit:C}){const l=w,m=C,k=b(l.start?j(l.start).format():ye().format()),i=b(l.end?j(l.end).format():null);L(l,()=>{k.value=j(l.start).format(),i.value=l.end?j(l.end).format():null});function h(){const u=T()(k.value).utc().format(),t=i.value?T()(i.value).utc().format():null;(u!==l.start||t!==l.end)&&m("changed",T()(k.value).utc().format(),T()(i.value).utc().format())}const g=b(),{focused:v}=ke(g);return L(v,(u,t)=>{t===!0&&u===!1&&h()}),(u,t)=>(r(),d("div",{ref_key:"dropdownContent",ref:g,class:"grid grid-cols-2 divide-x divide-card-background-separator text-center py-2"},[c("div",{class:"px-2",onKeydown:t[4]||(t[4]=B(I(f=>ue(()=>m("close")),["prevent"]),["enter"]))},[t[8]||(t[8]=c("div",{class:"font-semibold text-text-primary text-sm pb-2"},"Start",-1)),c("div",Ue,[y(ie,{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=f=>k.value=f),"data-testid":"time_entry_range_start",tabindex:"0",focus:u.focus,onKeydown:t[1]||(t[1]=B(I(f=>m("close"),["exact","shift","stop","prevent"]),["tab"])),onChanged:h},null,8,["modelValue","focus"]),y(re,{modelValue:k.value,"onUpdate:modelValue":t[2]||(t[2]=f=>k.value=f),class:"text-xs text-text-tertiary max-w-24 px-1.5 py-1.5",onChanged:h,onBlur:t[3]||(t[3]=I(f=>m("close"),["stop","prevent"]))},null,8,["modelValue"])])],32),c("div",Le,[t[9]||(t[9]=c("div",{class:"font-semibold text-text-primary text-sm pb-2"},"End",-1)),i.value!==null?(r(),d("div",Ee,[y(ie,{modelValue:i.value,"onUpdate:modelValue":t[5]||(t[5]=f=>i.value=f),"data-testid":"time_entry_range_end",onChanged:h},null,8,["modelValue"]),y(re,{modelValue:i.value,"onUpdate:modelValue":t[6]||(t[6]=f=>i.value=f),class:"text-xs text-text-tertiary max-w-24 px-1.5 py-1.5",onChanged:h},null,8,["modelValue"])])):(r(),d("div",De,"-- : --")),c("div",{tabindex:"0",onFocusin:t[7]||(t[7]=f=>m("close"))},null,32)])],512))}}),ht=F({__name:"BillableToggleButton",props:E({size:{default:"base"}},{modelValue:{default:!1},modelModifiers:{}}),emits:E(["changed"],["update:modelValue"]),setup(w,{emit:C}){const l=A(w,"modelValue"),m=C;function k(){l.value=!l.value,m("changed",l.value)}const i=w,h=z(()=>l.value?"text-input-select-active focus:text-input-select-active-hover hover:text-input-select-active-hover":"text-icon-default focus:text-icon-active hover:text-icon-active"),g=z(()=>i.size==="small"?"w-5 h-5":"w-5 lg:w-6 h-5 lg:h-6"),v=i.size==="small"?"w-6 sm:w-8 h-6 sm:h-8":"w-10 h-10";return(u,t)=>(r(),d("button",{class:H(_(Q)(h.value,_(v),"flex-shrink-0 ring-0 focus:outline-none focus-visible:ring-2 focus-visible:ring-ring transition focus:bg-card-background-separator hover:bg-card-background-separator rounded-full flex items-center justify-center")),onClick:k},[y(_e,{class:H(g.value)},null,8,["class"])],2))}}),qe={key:0},Ke={class:"flex items-center lg:space-x-1 min-w-0"},Te={class:"whitespace-nowrap text-xs lg:text-sm"},Ze={key:1,class:"min-w-0 shrink text-xs lg:text-sm truncate"},Ae=["value","onKeydown"],Fe={key:0,class:"w-full pb-1 pt-2 px-2 text-text-tertiary text-xs font-semibold flex space-x-1 items-center"},Oe=["value","data-project-id","onClick"],Re=["onClick"],Je={key:0,class:"bg-quaternary"},Ge=["data-task-id","onClick","onMouseenter"],Qe={key:0,class:"hover:bg-card-background-active rounded-b-lg"},xt=F({__name:"TimeTrackerProjectTaskDropdown",props:E({showBadgeBorder:{type:Boolean,default:!0},size:{default:"large"},projects:{},tasks:{},clients:{},createProject:{},createClient:{},currency:{},emptyPlaceholder:{default:"No Project"},allowReset:{type:Boolean,default:!1},enableEstimatedTime:{type:Boolean},canCreateProject:{type:Boolean},class:{}},{task:{default:null},taskModifiers:{},project:{default:null},projectModifiers:{}}),emits:E(["update:modelValue","changed"],["update:task","update:project"]),setup(w,{emit:C}){const l=A(w,"task"),m=A(w,"project"),k=b(null),i=b(!1),h=b(null),g=b("");L(i,a=>{a&&ue(()=>{var e;X(),(e=k.value)==null||e.focus({preventScroll:!0})})});const v=w,u=b([]),t=z(()=>u.value.map(a=>a.projects).flat());function f(a,e,n,s=!1){const x=a.findIndex(p=>p.id===e.client_id),M=v.clients.find(p=>p.id===e.client_id);if(x!==-1)a[x].projects.push({...e,expanded:s,tasks:n});else if(M)a.push({...M,projects:[{...e,expanded:s,tasks:n}]});else{const p="no_client",P=a.findIndex(R=>R.id===p);P!==-1?a[P].projects.push({...e,expanded:s,tasks:n}):a.push({id:p,name:"No Client",color:"var(--theme-color-icon-default)",created_at:"",updated_at:"",value:"",is_archived:!1,projects:[{...e,expanded:s,tasks:n}]})}}xe(()=>{var e,n,s,x,M;const a=[];g.value.length===0&&a.push({id:"no_project_no_client",name:"No Client",color:"var(--theme-color-icon-default)",created_at:"",updated_at:"",value:"",is_archived:!1,projects:[{id:"",name:"No Project",color:"var(--theme-color-icon-default)",value:"",client_id:null,billable_rate:null,is_archived:!1,is_billable:!1,expanded:!1,tasks:[],estimated_time:null,spent_time:0,is_public:!1}]});for(const p of v.projects){const P=p.name.toLowerCase().includes(((n=(e=g.value)==null?void 0:e.toLowerCase())==null?void 0:n.trim())||""),R=(M=v.clients.find(N=>N.id===p.client_id))==null?void 0:M.name.toLowerCase().includes(((x=(s=g.value)==null?void 0:s.toLowerCase())==null?void 0:x.trim())||""),J=v.tasks.filter(N=>N.project_id===p.id).filter(N=>{var se,oe;return N.name.toLowerCase().includes(((oe=(se=g.value)==null?void 0:se.toLowerCase())==null?void 0:oe.trim())||"")&&(!N.is_done||N.id===l.value)});(P||R)&&(!p.is_archived||m.value===p.id)?f(a,p,J,!1):J.length>0&&!p.is_archived&&f(a,p,J,!0)}a.sort((p,P)=>p.id==="no_project_no_client"?-1:P.id==="no_project_no_client"?1:p.id==="no_client"?-1:P.id==="no_client"?1:p.name<P.name?-1:p.name>P.name?1:0),u.value=a});async function V(){Y()}function de(a){return a.value===a.id}function X(){t.value.length>0&&(o.value=t.value[0].id)}L(t,()=>{X()});function Y(){const a=t.value.find(n=>n.id===o.value),e=t.value.map(n=>n.tasks).flat().find(n=>n.id===o.value);a&&le(a.id),e&&ne(e.id)}function ce(a){const e=a.target.value;e===" "?(g.value="",Y()):g.value=e}const W=C;function ve(){q.value=!1;const a=t.value.findIndex(e=>e.id===o.value);if(a===-1){const e=t.value.find(n=>n.tasks.some(s=>s.id===o.value));if(e){const n=e.tasks.findIndex(s=>s.id===o.value);if(n===-1)return;if(n===0){o.value=e.id;return}o.value=e.tasks[n-1].id}}if(a===0){const e=t.value[t.value.length-1];e.tasks.length>0&&e.expanded?o.value=e.tasks[e.tasks.length-1].id:o.value=t.value[t.value.length-1].id}else{const e=t.value[a-1];e.tasks.length>0&&e.expanded?o.value=e.tasks[e.tasks.length-1].id:o.value=t.value[a-1].id}}function fe(){q.value=!1;const a=t.value.findIndex(e=>e.id===o.value);if(a===-1){const e=t.value.find(n=>n.tasks.some(s=>s.id===o.value));if(e){const n=e.tasks.findIndex(s=>s.id===o.value);if(n===-1)return;if(n===e.tasks.length-1){const s=t.value.indexOf(e);s===t.value.length-1?o.value=t.value[0].id:o.value=t.value[s+1].id;return}o.value=e.tasks[n+1].id}}if(a===t.value.length-1){const e=t.value[t.value.length-1];e.tasks.length>0&&e.expanded?o.value=e.tasks[0].id:o.value=t.value[0].id}else{const e=t.value[a];e.tasks.length>0&&e.expanded?o.value=e.tasks[0].id:o.value=t.value[a+1].id}}const o=b(null);L(o,()=>{var e,n;const a=(e=h.value)==null?void 0:e.querySelector(`[data-project-id="${o.value}"]`);if(a)a.scrollIntoView({block:"nearest",inline:"nearest"});else{const s=(n=h.value)==null?void 0:n.querySelector(`[data-task-id="${o.value}"]`);s&&s.scrollIntoView({block:"nearest",inline:"nearest"})}});function me(){const a=t.value.findIndex(n=>n.id===o.value);if(a===-1)return;const e=t.value[a];e.expanded=!0}function pe(){const a=t.value.findIndex(n=>n.id===o.value);if(a===-1)return;const e=t.value[a];e.expanded=!1}const ee=z(()=>v.projects.find(a=>a.id===m.value)),O=z(()=>v.tasks.find(a=>a.id===l.value)),te=z(()=>{var a;return m.value===null?v.emptyPlaceholder:m.value===""?"No Project":(a=ee.value)==null?void 0:a.name}),ge=z(()=>{var a;return((a=ee.value)==null?void 0:a.color)||"var(--theme-color-icon-default)"}),q=b(!0);function ae(a){q.value&&(o.value=a)}function ne(a){var e;l.value=a,m.value=((e=v.tasks.find(n=>n.id===a))==null?void 0:e.project_id)||null,i.value=!1,g.value="",W("changed",m.value,l.value)}function le(a){m.value=a,l.value=null,i.value=!1,g.value="",W("changed",m.value,l.value)}const K=b(!1);return(a,e)=>(r(),d(S,null,[a.projects.length===0&&a.canCreateProject?(r(),d("div",qe,[y(Ve,{size:"large",tag:"button",class:"cursor-pointer hover:bg-tertiary",onClick:e[0]||(e[0]=n=>K.value=!0)},{default:U(()=>[y(_(Me),{class:"-ml-1 w-5"}),e[7]||(e[7]=c("span",null,"Add new project",-1))]),_:1,__:[7]})])):(r(),Z(je,{key:1,modelValue:i.value,"onUpdate:modelValue":e[5]||(e[5]=n=>i.value=n),"close-on-content-click":!1,align:"center"},{trigger:U(()=>[y(Ie,{ref:"projectDropdownTrigger",color:ge.value,size:a.size,border:a.showBadgeBorder,tag:"button",name:te.value,class:H(_(Q)("focus:border-border-tertiary w-full focus:outline-0 focus:bg-card-background-separator min-w-0 relative",v.class))},{default:U(()=>[c("div",Ke,[c("span",Te,D(te.value),1),O.value?(r(),Z(_(ze),{key:0,class:"w-4 lg:w-5 text-text-secondary shrink-0"})):$("",!0),O.value?(r(),d("div",Ze,D(O.value.name),1)):$("",!0)]),m.value!==null&&a.allowReset?(r(),d("button",{key:0,class:"absolute right-0 top-0 h-full flex items-center pr-3 text-text-quaternary hover:text-text-secondary",onClick:e[1]||(e[1]=I(n=>{m.value=null,l.value=null},["stop"]))},[y(_(Ce),{class:"w-5"})])):$("",!0)]),_:1},8,["color","size","border","name","class"])]),content:U(()=>[i.value?(r(),Z(_(Be),{key:0,options:{immediate:!0,allowOutsideClick:!0}},{default:U(()=>[c("input",{ref_key:"searchInput",ref:k,value:g.value,"data-testid":"client_dropdown_search",class:"bg-card-background border-0 placeholder-muted text-sm text-text-primary py-2.5 focus:ring-0 border-b border-card-background-separator focus:border-card-background-separator w-full",placeholder:"Search for a project or task...",onInput:ce,onKeydown:[B(I(V,["prevent"]),["enter"]),e[2]||(e[2]=B(I(n=>i.value=!1,["prevent"]),["esc"])),B(I(ve,["prevent"]),["up"]),B(I(fe,["prevent"]),["down"]),B(I(me,["prevent"]),["right"]),B(I(pe,["prevent"]),["left"])]},null,40,Ae),c("div",{ref_key:"dropdownViewport",ref:h,class:"min-w-[350px] max-h-[350px] overflow-y-scroll relative",onMousemove:e[3]||(e[3]=n=>q.value=!0)},[(r(!0),d(S,null,G(u.value,n=>(r(),d(S,{key:n.id},[n.id!=="no_project_no_client"?(r(),d("div",Fe,[c("span",null,D(n.name),1)])):$("",!0),(r(!0),d(S,null,G(n.projects,s=>(r(),d(S,{key:s.id},[c("div",{role:"option",class:"px-1 py-0.5 cursor-default",value:s.id,"data-project-id":s.id,onClick:x=>le(s.id)},[c("div",{class:H(["rounded-lg",{"bg-card-background-active":s.id===o.value}])},[y(Pe,{class:"hover:!bg-transparent",selected:de(s),name:s.name,color:s.color,onMouseenter:x=>ae(s.id)},{actions:U(()=>[s.tasks.length>0?(r(),d("button",{key:0,tabindex:"-1",class:H(["px-2 py-0.5 mr-2 relative transition items-center rounded flex space-x-0.5 text-xs",{"bg-white/5 text-text-secondary":s.expanded,"hover:bg-white/5 hover:text-text-secondary text-text-tertiary":!s.expanded}]),onClick:I(()=>{var x;s.expanded=!s.expanded,(x=k.value)==null||x.focus()},["prevent","stop"])},[c("span",null,D(s.tasks.length)+" Tasks",1),y(_(Ne),{class:H([{"transform rotate-180":s.expanded},"w-4"])},null,8,["class"])],10,Re)):$("",!0)]),_:2},1032,["selected","name","color","onMouseenter"])],2)],8,Oe),s.expanded?(r(),d("div",Je,[(r(!0),d(S,null,G(s.tasks,x=>(r(),d("div",{key:x.id,"data-task-id":x.id,class:H([{"bg-card-background-active":x.id===o.value},"flex items-center space-x-2 w-full px-5 py-1.5 text-start text-xs font-semibold leading-5 text-text-primary focus:outline-none focus:bg-card-background-active transition duration-150 ease-in-out"]),onClick:M=>ne(x.id),onMouseenter:M=>ae(x.id)},[y(_(He),{class:"w-3 h-3 text-text-quaternary"}),c("span",null,D(x.name),1)],42,Ge))),128))])):$("",!0)],64))),128))],64))),128))],544),a.canCreateProject?(r(),d("div",Qe,[c("button",{class:"text-text-primary flex space-x-3 items-center px-4 py-3 text-xs font-semibold border-t border-card-background-separator",onClick:e[4]||(e[4]=n=>{i.value=!1,K.value=!0})},[y(_(Se),{class:"w-5 flex-shrink-0 text-icon-default"}),e[8]||(e[8]=c("span",null,"Create new Project",-1))])])):$("",!0)]),_:1})):$("",!0)]),_:1},8,["modelValue"])),y($e,{show:K.value,"onUpdate:show":e[6]||(e[6]=n=>K.value=n),"create-client":a.createClient,"enable-estimated-time":a.enableEstimatedTime,currency:a.currency,clients:a.clients,"create-project":a.createProject},null,8,["show","create-client","enable-estimated-time","currency","clients","create-project"])],64))}});export{gt as _,xt as a,ht as b,ie as c,ze as r};
//# sourceMappingURL=TimeTrackerProjectTaskDropdown.vue_vue_type_script_setup_true_lang-qSvmZhOU.js.map
