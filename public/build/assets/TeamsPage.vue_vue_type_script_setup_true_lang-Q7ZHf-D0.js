import{C as q,r as u,H as F,I as w,d as J,l as Q,v as R,e as x,o as b,a as t,b as i,D as N,ae as S,i as E,F as U,h as O,w as p,t as m,g as V,u as n}from"./app-CZLkYVhz.js";import{_ as G}from"./MultiselectDropdown.vue_vue_type_script_setup_true_lang-Vdr6fO98.js";import{a as W,c as X,b as A,r as Y,_ as Z}from"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-BgJhjCYQ.js";import{_ as B}from"./Modal.vue_vue_type_script_setup_true_lang-DiIZ2Ob1.js";import{r as z}from"./UserGroupIcon-DEClCgLE.js";import{r as ee}from"./PencilSquareIcon-krbQY_ys.js";const te=q("app",()=>{const T=u([]),l=u([]),v=u([]),h=u([]),y=F({}),k=F({}),C=F({}),P=F({}),D=F({}),I=u(""),j=u(!1),$=u(null);async function M(){j.value=!0,$.value=null;try{const f=await w.post("/get/current/org");I.value=f.data.org,l.value=f.data.projects,T.value=f.data.user,v.value=f.data.teams,h.value=[],v.value.forEach(a=>{C[a.id]=[...a.users],P[a.id]=a.users.map(d=>d.id),D[a.id]=a.projects.map(d=>d.id),k[a.id]=[...a.projects]}),f.data.managers.forEach(a=>{const d=a.users.filter(g=>g.organizations[0].membership.role==="admin"),c=a.users.filter(g=>g.organizations[0].membership.role==="manager");d.length>0?(y[a.id]=d,h.value.push(...d)):c.length>0&&(y[a.id]=c,h.value.push(...c))})}catch(f){$.value=f.message??"Failed to fetch organization",console.error("âŒ fetchCurrentOrg error:",f)}finally{j.value=!1}}return M(),{users:T,projects:l,teams:v,managers:h,selectedManagers:y,selectedProject:k,selectedUsers:C,selectedUserIds:P,selectedProjectIds:D,currentOrganization:I,isLoading:j,error:$,fetchCurrentOrg:M}}),se={class:"flow-root max-w-[100vw] overflow-x-auto p-4",style:{"min-height":"80vh"}},oe={class:"inline-block min-w-full align-middle bg-default-background p-5 rounded-md"},le={class:"flex mb-4 gap-2"},re={class:"w-full"},ae={class:"dark:bg-gray-900 w-full"},ne={class:"px-4 py-2 align-top"},de={class:"font-semibold text-lg"},ie={class:"flex gap-2"},ue={class:"text-sm"},ce={class:"text-sm"},pe={class:"px-4 py-2 align-top"},fe={class:"text-sm flex border rounded px-3 py-1 w-full"},me={class:"flex gap-1 mt-2 flex-wrap"},ve={class:"px-4 py-2 align-top"},ge={class:"text-sm flex border rounded px-3 py-1 w-full"},xe={class:"flex gap-1 mt-2 flex-wrap"},be={class:"px-4 py-2 align-top"},he={class:"flex gap-1 mt-2 flex-wrap"},_e={class:"relative"},we={class:"absolute",style:{top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},ye=["aria-label"],ke={class:"p-5"},Ce={class:"text-lg font-bold mb-2"},je={class:"p-5"},$e={class:"p-5"},Fe={class:"flex text-xl mb-2"},Ue={class:"ml-2 text-xl font-bold mb-2"},Pe={class:"p-5"},Se=J({__name:"TeamsPage",setup(T){const l=te(),v=u(""),h=u(""),y=Q(()=>{const o=h.value.toLowerCase().trim();return l.teams.filter(e=>e.name.toLowerCase().includes(o))}),k=o=>o.id,C=o=>o.name;async function P(){v.value.trim()&&(await w.post("/organizations/teams",{name:v.value.trim()}),v.value="",await l.fetchCurrentOrg())}async function D(o,e){await w.post(`/teams/${o}/assign-project`,{project_id:e}),await l.fetchCurrentOrg()}async function I(o){await w.delete(`/teams/${o.id}`),g.value=!1,await l.fetchCurrentOrg()}async function j(o,e){await w.post(`/teams/${o.id}/name/${e}`),d.value=!1,await l.fetchCurrentOrg()}async function $(o,e){const s=e.map(r=>r.id);await w.post(`/teams/${o}/assign-members`,{user_ids:s}),await l.fetchCurrentOrg()}function M(o){const e=l.selectedUserIds[o]||[],s=l.users.filter(r=>e.includes(r.id));l.selectedUsers[o]=s,$(o,s)}function f(o){const e=l.selectedProjectIds[o]||[],s=(l.selectedProject[o]||[]).map(_=>_.id),r=e.filter(_=>!s.includes(_)),K=l.projects.filter(_=>e.includes(_.id));l.selectedProject[o]=K,r.forEach(_=>{D(o,_)})}const a=u(""),d=u(!1),c=u(null),g=u(!1);function L(o){c.value=o,a.value=o.name,d.value=!0}function H(o){c.value=o,a.value=o.name,g.value=!0}return R(()=>{l.fetchCurrentOrg()}),(o,e)=>(b(),x(U,null,[t("div",se,[t("div",oe,[e[16]||(e[16]=t("h2",{class:"text-xl font-bold mb-4"},"Teams",-1)),t("div",le,[N(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>h.value=s),placeholder:"Search team name...",class:"border border-gray-300 rounded px-3 py-2 w-full dark:border-[#303F61] dark:bg-[#0F1426] dark:text-[#7D88A1] hover:dark:text-[#BFC7D6]"},null,512),[[S,h.value]])]),t("form",{onSubmit:E(P,["prevent"]),class:"mb-6 flex gap-2"},[N(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>v.value=s),placeholder:"New team name",class:"border border-gray-300 p-2 rounded flex-1 dark:border-[#303F61] dark:bg-[#0F1426] dark:text-[#7D88A1] hover:dark:text-[#BFC7D6]"},null,512),[[S,v.value]]),e[9]||(e[9]=t("button",{class:"dark:border-[#303F61] dark:bg-[#2770DB] dark:text-[#FFFFFF] hover:dark:text-[#BFC7D6] px-4 py-2 rounded"}," Add Team ",-1))],32),t("table",re,[e[15]||(e[15]=t("thead",null,[t("tr",null,[t("th",{class:"text-left px-4 py-2"},"Group"),t("th",{class:"text-left px-4 py-2"},"Members"),t("th",{class:"text-left px-4 py-2"},"Projects"),t("th",{class:"text-left px-4 py-2"},"Managers"),t("th",{class:"text-left px-4 py-2"},"Action")])],-1)),t("tbody",ae,[(b(!0),x(U,null,O(y.value,s=>(b(),x("tr",{key:s.id,class:"border border-t-2 border-x-0 border-gray-700 rounded p-3 mb-2 shadow-sm gap-4 w-full"},[t("td",ne,[t("div",de,m(s.name),1),t("div",ie,[t("div",ue,m(s.projects.length)+" project"+m(s.projects.length!==1?"s":""),1),t("div",ce,m(s.users.length)+" member"+m(s.users.length!==1?"s":""),1)])]),t("td",pe,[i(G,{"model-value":n(l).selectedUserIds[s.id]||[],"onUpdate:modelValue":r=>n(l).selectedUserIds[s.id]=r,items:n(l).users,"search-placeholder":"Select Users",getKeyFromItem:k,getNameForItem:C,onChanged:r=>M(s.id)},{trigger:p(()=>[t("div",fe,[i(n(z),{class:"w-5 mr-2"}),e[10]||(e[10]=V(" Select Users... "))])]),_:2},1032,["model-value","onUpdate:modelValue","items","onChanged"]),t("div",me,[(b(!0),x(U,null,O(n(l).selectedUsers[s.id],r=>(b(),x("span",{key:r.id,class:"text-xs px-2 py-1 rounded"},m(r.name),1))),128))])]),t("td",ve,[i(G,{"model-value":n(l).selectedProjectIds[s.id]||[],"onUpdate:modelValue":r=>n(l).selectedProjectIds[s.id]=r,items:n(l).projects,"search-placeholder":"Select Projects",getKeyFromItem:k,getNameForItem:C,onChanged:r=>f(s.id)},{trigger:p(()=>[t("div",ge,[i(n(z),{class:"w-5 mr-2"}),e[11]||(e[11]=V(" Select Projects... "))])]),_:2},1032,["model-value","onUpdate:modelValue","items","onChanged"]),t("div",xe,[(b(!0),x(U,null,O(n(l).selectedProject[s.id],r=>(b(),x("span",{key:r.id,class:"text-xs px-2 py-1 rounded"},m(r.name),1))),128))])]),t("td",be,[t("div",he,[(b(!0),x(U,null,O(n(l).selectedManagers[s.id],r=>(b(),x("span",{key:r.id,class:"bg-default-background text-xs px-2 py-1 rounded"},m(r.name),1))),128))])]),t("td",_e,[t("div",we,[i(n(Z),null,{default:p(()=>[i(n(W),{"as-child":""},{default:p(()=>[t("button",{class:"text-gray-800 my-auto focus-visible:outline-none focus-visible:bg-card-background rounded-full focus-visible:ring-2 focus-visible:ring-ring focus-visible:opacity-100 hover:bg-card-background group-hover:opacity-100 opacity-60 transition-opacity","aria-label":"Actions for Group "+s.name},e[12]||(e[12]=[t("svg",{class:"h-8 w-8 p-1 rounded-full text-gray-800",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[t("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M12 5.92A.96.96 0 1 0 12 4a.96.96 0 0 0 0 1.92m0 7.04a.96.96 0 1 0 0-1.92a.96.96 0 0 0 0 1.92M12 20a.96.96 0 1 0 0-1.92a.96.96 0 0 0 0 1.92"})],-1)]),8,ye)]),_:2},1024),i(n(X),{class:"min-w-[150px]",align:"end"},{default:p(()=>[i(n(A),{onClick:r=>L(s),class:"flex items-center space-x-3 cursor-pointer"},{default:p(()=>[i(n(ee),{class:"w-5 text-icon-active"}),e[13]||(e[13]=t("span",null,"Edit",-1))]),_:2,__:[13]},1032,["onClick"]),i(n(A),{onClick:E(r=>H(s),["prevent"]),class:"flex items-center space-x-3 cursor-pointer text-destructive focus:text-destructive"},{default:p(()=>[i(n(Y),{class:"w-5"}),e[14]||(e[14]=t("span",null,"Delete",-1))]),_:2,__:[14]},1032,["onClick"])]),_:2},1024)]),_:2},1024)])])]))),128))])])])]),i(B,{show:d.value,onClose:e[5]||(e[5]=s=>d.value=!1)},{default:p(()=>{var s;return[t("div",ke,[t("h2",Ce," Edit Group Name on "+m((s=c.value)==null?void 0:s.name),1),N(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>a.value=r),type:"text",id:"GroupName",placeholder:"Enter a Group Name",class:"w-full rounded"},null,512),[[S,a.value]])])]}),footer:p(()=>[t("div",je,[t("button",{onClick:e[3]||(e[3]=s=>d.value=!1),class:"bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-700"}," Cancel "),t("button",{onClick:e[4]||(e[4]=s=>c.value&&j(c.value,a.value)),class:"bg-blue-800 text-white px-4 py-2 ml-2 rounded hover:bg-blue-700"}," Save ")])]),_:1},8,["show"]),i(B,{show:g.value,onClose:e[8]||(e[8]=s=>g.value=!1)},{default:p(()=>{var s;return[t("div",$e,[t("h2",Fe,[e[17]||(e[17]=V(" Are you sure to delete Group ")),t("h2",Ue,m((s=c.value)==null?void 0:s.name)+"?",1)]),e[18]||(e[18]=t("div",{class:"text-md mb-2"},"This action can't be undone.",-1))])]}),footer:p(()=>[t("div",Pe,[t("button",{onClick:e[6]||(e[6]=s=>g.value=!1),class:"bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-700"}," Cancel "),t("button",{onClick:e[7]||(e[7]=s=>c.value&&I(c.value)),class:"bg-red-800 text-white px-4 py-2 ml-2 rounded hover:bg-red-700"}," Delete ")])]),_:1},8,["show"])],64))}});export{Se as _};
//# sourceMappingURL=TeamsPage.vue_vue_type_script_setup_true_lang-Q7ZHf-D0.js.map
