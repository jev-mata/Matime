import{d as U,c as V,h,o as v,e as f,f as u,u as w,n as F,t as j,x as S,y as q,r,D as M,v as B,F as D,w as C,b as R,j as G,z as p,g as I,i as J,p as P}from"./app-Dzd5B06R.js";import{b as Q}from"./AppLayout.vue_vue_type_script_setup_true_lang-BfXcHqGL.js";import{_ as W}from"./TagCreateModal.vue_vue_type_script_setup_true_lang-BZ1Krxqg.js";import{t as X}from"./bundle-mjs-D696Ktp4.js";import{r as Y}from"./CheckCircleIcon-Cls-9biQ.js";import{U as Z,r as ee}from"./component-D2dmHEOx.js";const te={class:"flex items-center space-x-3 w-full px-3 py-2.5 text-start text-sm font-medium leading-5 text-text-primary hover:bg-card-background-active focus:outline-none focus:bg-card-background-active transition duration-150 ease-in-out"},ae={class:"flex-1 min-w-0 overflow-ellipsis overflow-hidden"},le=U({__name:"MultiselectDropdownItem",props:{name:{},selected:{type:Boolean}},setup(g){const x=g,o=V(()=>x.selected?"text-input-select-active":"text-text-quaternary opacity-50");return(l,b)=>(v(),h("div",te,[f(w(Y),{class:F(w(X)(o.value,"w-5"))},null,8,["class"]),u("span",ae,j(l.name),1)]))}}),ne=["value","onKeydown"],se=["value","data-tag-id"],oe={class:"hover:bg-card-background-active rounded-b-lg"},fe=U({__name:"TagDropdown",props:S({tags:{},createTag:{},align:{default:"start"}},{modelValue:{default:[]},modelModifiers:{}}),emits:S(["changed","submit"],["update:modelValue"]),setup(g,{emit:x}){const o=g,l=q(g,"modelValue"),b=r(null),i=r(!1),H=r(null),d=r("");function N(t){return l.value.includes(t)}function k(t){l.value.includes(t)?l.value=l.value.filter(e=>e!==t):l.value=[...l.value,t],y("changed")}const $=r(o.tags);M(i,t=>{t&&(B(()=>{var e;(e=b.value)==null||e.focus()}),$.value=[...o.tags].sort((e,a)=>{const c=l.value.includes(e.id),T=l.value.includes(a.id);return c===T?e.name.localeCompare(a.name):l.value.includes(e.id)?-1:1}),B(()=>{n.value.length>0&&(s.value=n.value[0].id)}))});const n=V(()=>$.value.filter(t=>{var e,a;return t.name.toLowerCase().includes(((a=(e=d.value)==null?void 0:e.toLowerCase())==null?void 0:a.trim())||"")}));async function O(t){const e=await o.createTag(t);return e&&k(e.id),d.value="",e}async function K(){s.value&&k(s.value)}M(n,()=>{n.value.length>0&&(s.value=n.value[0].id)});function L(t){const e=t.target.value;if(e===" "){d.value="";const a=s.value;if(a){const c=o.tags.find(T=>T.id===a);c&&k(c.id)}}else d.value=e}const y=x;function z(t){l.value.includes(t)?l.value=[...l.value].filter(e=>e!==t):l.value=[...l.value,t],y("changed")}function A(){if(m.value){const t=n.value.indexOf(m.value);t===0?s.value=n.value[n.value.length-1].id:s.value=n.value[t-1].id}}function E(){if(m.value){const t=n.value.indexOf(m.value);t===n.value.length-1?s.value=n.value[0].id:s.value=n.value[t+1].id}}const s=r(null),m=V(()=>o.tags.find(t=>t.id===s.value)),_=r(!1);return(t,e)=>(v(),h(D,null,[f(W,{show:_.value,"onUpdate:show":e[0]||(e[0]=a=>_.value=a),"create-tag":O},null,8,["show"]),f(Q,{modelValue:i.value,"onUpdate:modelValue":e[3]||(e[3]=a=>i.value=a),align:t.align,"close-on-content-click":!1,onSubmit:e[4]||(e[4]=a=>y("submit"))},{trigger:C(()=>[P(t.$slots,"trigger")]),content:C(()=>[i.value?(v(),R(w(Z),{key:0,options:{immediate:!0,allowOutsideClick:!0}},{default:C(()=>[u("input",{ref_key:"searchInput",ref:b,value:d.value,"data-testid":"tag_dropdown_search",class:"bg-card-background border-0 placeholder-muted text-sm text-text-primary py-2.5 focus:ring-0 border-b border-card-background-separator focus:border-card-background-separator w-full",placeholder:"Search for a Tag...",onInput:L,onKeydown:[e[1]||(e[1]=p(I(a=>i.value=!1,["prevent"]),["esc"])),p(K,["enter"]),p(I(A,["prevent"]),["up"]),p(I(E,["prevent"]),["down"])]},null,40,ne),u("div",{ref_key:"dropdownViewport",ref:H,class:"w-60 max-h-60 overflow-y-scroll"},[(v(!0),h(D,null,J(n.value,a=>(v(),h("div",{key:a.id,role:"option",value:a.id,class:F({"bg-card-background-active":a.id===s.value}),"data-testid":"tag_dropdown_entries","data-tag-id":a.id},[f(le,{selected:N(a.id),name:a.name,onClick:c=>z(a.id)},null,8,["selected","name","onClick"])],10,se))),128))],512),u("div",oe,[u("button",{class:"text-text-primary w-full flex space-x-3 items-center px-4 py-3 text-xs font-semibold border-t border-card-background-separator",onClick:e[2]||(e[2]=a=>{i.value=!1,_.value=!0})},[f(w(ee),{class:"w-5 flex-shrink-0 text-icon-default"}),e[5]||(e[5]=u("span",null,"Create new Tag",-1))])])]),_:1})):G("",!0)]),_:3},8,["modelValue","align"])],64))}});export{fe as _,le as a};
