import{_ as Me}from"./AppLayout.vue_vue_type_script_setup_true_lang-7v21bPMn.js";import{g as Te}from"./money-BufCQq2I.js";import{h as P,g as B,a as Ue}from"./time-DR3Bm2fi.js";import{_ as ze}from"./ReportingTabNavbar.vue_vue_type_script_setup_true_lang-DBUWeKjm.js";import{_ as Ee,a as je,b as De,c as M,d as Pe,e as Be,f as Ne,g as Oe}from"./ReportingExportModal.vue_vue_type_script_setup_true_lang-Djlvhmo0.js";import{u as N,R as Fe,_ as Ge,a as Ae}from"./useReporting-S2gixkGw.js";import{_ as Ie}from"./PageTitle.vue_vue_type_script_setup_true_lang-DVaC2uzI.js";import{d as re,e as le}from"./index-CHolqtoz.js";import{_ as qe}from"./SelectDropdown.vue_vue_type_script_setup_true_lang-1bxQg4o6.js";import{_ as He}from"./Badge.vue_vue_type_script_setup_true_lang-Bn80q8dA.js";import{d as z,m as de,p as me,l as U,c as S,o as y,w as u,b as o,a,K as Le,t as ce,r as _,g as A,n as Je,e as R,f as fe,u as s,L as Ke,F as G,s as L,z as We,v as Qe,G as O,h as Xe}from"./app-CZLkYVhz.js";import{M as F}from"./MainContainer-DAB7AmGD.js";import{_ as ge}from"./SecondaryButton.vue_vue_type_script_setup_true_lang-iS1Fl1UI.js";/* empty css                                                                             */import"./utc-YQln_hJX.js";import{b as ve,a as _e}from"./notification-BrLDF-00.js";import{g as ye,a as J,b as K}from"./useUser-Dc3_Hjqo.js";import"./useCurrentTimeEntry-CruyZJNI.js";import{i as Ye}from"./billing-F8TVwX2K.js";import{t as Ze}from"./permissions-hl9spDHx.js";import"./theme-DlEllDdR.js";import{_ as ne}from"./TextInput.vue_vue_type_script_setup_true_lang-DUXudii_.js";import{_ as et}from"./DialogModal.vue_vue_type_script_setup_true_lang-Dn6gUihL.js";import{_ as tt}from"./PrimaryButton.vue_vue_type_script_setup_true_lang-DGqi3YE0.js";import{_ as T}from"./InputLabel.vue_vue_type_script_setup_true_lang-DP24QN7l.js";import{u as ot}from"./useMutation-PNvSUilA.js";import{D as at}from"./DatePicker-DmIk6-p1.js";import{_ as st}from"./Checkbox.vue_vue_type_script_setup_true_lang-BTLhb63T.js";import{_ as rt}from"./UpgradeModal.vue_vue_type_script_setup_true_lang-DX0vhlsO.js";import{_ as lt}from"./TagDropdown.vue_vue_type_script_setup_true_lang-fidraWsZ.js";import{u as ie}from"./init-DIMnQ95t.js";import{a as nt}from"./color-NTCrcshl.js";import{a as it}from"./useMembers-B2Kv7mzm.js";import{a as ut}from"./UserCircleIcon-B_03lMym.js";import{r as pt}from"./UserGroupIcon-DEClCgLE.js";import{r as ue}from"./FolderIcon-BBOgs1tQ.js";import{r as dt}from"./CheckCircleIcon-ByT7Dbrk.js";import{r as mt}from"./TagIcon-D32GhY_O.js";import"./Dropdown.vue_vue_type_script_setup_true_lang-2TV_nqEm.js";import"./utils-DLNr0s0q.js";import"./bundle-mjs-D696Ktp4.js";import"./useFocusGuards-DKIr8CEw.js";import"./useOrganization-Dnx8kCk3.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useQuery-QapR65Yu.js";import"./LoadingSpinner.vue_vue_type_script_setup_true_lang-CAmSBxXF.js";import"./ClockIcon-DtFwBiYn.js";import"./TabBar.vue_vue_type_script_setup_true_lang-D5JkrlW4.js";import"./Collection-Ddu0RjBR.js";import"./usePrimitiveElement-DVmz0I4p.js";import"./RovingFocusGroup-j8ihdqB0.js";import"./MultiselectDropdown.vue_vue_type_script_setup_true_lang-Vdr6fO98.js";import"./MultiselectDropdownItem.vue_vue_type_script_setup_true_lang-DfGNKO5q.js";import"./useLocale-BQy7zCNL.js";import"./createLucideIcon-DWD2E6Wp.js";import"./Modal.vue_vue_type_script_setup_true_lang-DiIZ2Ob1.js";import"./GroupedItemsCountButton.vue_vue_type_script_setup_true_lang-DXMK0t_p.js";import"./install-BiQo9UUP.js";import"./BillableIcon-BlL7cW2e.js";import"./TagCreateModal.vue_vue_type_script_setup_true_lang-JZMNiY85.js";import"./component-CexCnHe5.js";const ct={class:"text-inherit"},pe=z({__name:"ReportingGroupBySelect",props:de({groupByOptions:{}},{modelValue:{default:null},modelModifiers:{}}),emits:["update:modelValue"],setup(k){const c=me(k,"modelValue"),p=k,f=U(()=>{var r;return(r=p.groupByOptions.find(n=>n.value===c.value))==null?void 0:r.icon}),g=U(()=>{var r;return(r=p.groupByOptions.find(n=>n.value===c.value))==null?void 0:r.label});return(r,n)=>(y(),S(qe,{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=d=>c.value=d),"get-key-from-item":d=>d.value,"get-name-for-item":d=>d.label,items:r.groupByOptions},{trigger:u(()=>[o(He,{size:"large",tag:"button",class:"cursor-pointer hover:text-gray-200 hover:dark:text-gray-700 transition space-x-5 flex"},{default:u(()=>[(y(),S(Le(f.value),{class:"h-4"})),a("span",ct,ce(g.value),1)]),_:1})]),_:1},8,["modelValue","get-key-from-item","get-name-for-item","items"]))}}),ft={class:"items-center space-y-4 w-full"},gt={class:"w-full"},vt={class:"flex items-center space-x-12"},_t={class:"flex items-center space-x-3 px-2 py-3"},yt={key:0,class:"flex items-center space-x-4"},bt=z({__name:"ReportCreateModal",props:de({properties:{}},{show:{default:!1},showModifiers:{}}),emits:["update:show"],setup(k){const c=me(k,"show"),p=_(!1),f=ot({mutationFn:async w=>{const i=ye();if(i===null)throw new Error("No current organization id - create report");return await _e.createReport(w,{params:{organization:i}})}}),g=k,r=_({name:"",description:"",is_public:!0,public_until:null}),{handleApiRequestNotifications:n}=ve();async function d(){await n(()=>f.mutateAsync({...r.value,properties:{...g.properties}}),"Success","Error",()=>{r.value={name:"",description:"",is_public:!1,public_until:null},c.value=!1})}return(w,i)=>(y(),S(et,{closeable:"",show:c.value,onClose:i[4]||(i[4]=m=>c.value=!1)},{title:u(()=>i[5]||(i[5]=[a("div",{class:"flex space-x-2"},[a("span",null," Create Report ")],-1)])),content:u(()=>[a("div",ft,[a("div",gt,[o(T,{for:"name",value:"Name"}),o(ne,{id:"name",modelValue:r.value.name,"onUpdate:modelValue":i[0]||(i[0]=m=>r.value.name=m),class:"mt-1.5 w-full"},null,8,["modelValue"])]),a("div",null,[o(T,{for:"description",value:"Description"}),o(ne,{id:"description",modelValue:r.value.description,"onUpdate:modelValue":i[1]||(i[1]=m=>r.value.description=m),class:"mt-1.5 w-full"},null,8,["modelValue"])]),o(T,{value:"Visibility"}),a("div",vt,[a("div",_t,[o(s(st),{id:"is_public",checked:r.value.is_public,"onUpdate:checked":i[2]||(i[2]=m=>r.value.is_public=m)},null,8,["checked"]),o(T,{for:"is_public",value:"Public"})]),r.value.is_public?(y(),R("div",yt,[a("div",null,[o(T,{for:"public_until",value:"Expires at"}),i[6]||(i[6]=a("div",{class:"text-text-tertiary font-medium"}," (optional) ",-1))]),o(at,{id:"public_until"})])):fe("",!0)])])]),footer:u(()=>[o(ge,{onClick:i[3]||(i[3]=m=>c.value=!1)},{default:u(()=>i[7]||(i[7]=[A(" Cancel")])),_:1,__:[7]}),o(tt,{class:Je(["ms-3",{"opacity-25":p.value}]),disabled:p.value,onClick:d},{default:u(()=>i[8]||(i[8]=[A(" Create Report ")])),_:1,__:[8]},8,["class","disabled"])]),_:1},8,["show"]))}}),xt=z({__name:"ReportSaveButton",props:{reportProperties:{}},setup(k){const c=_(!1),p=_(!1),f=Ke("div",{innerHTML:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/><path d="M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7M7 3v4a1 1 0 0 0 1 1h7"/></g></svg>'});function g(){Ye()?c.value=!0:p.value=!0}return(r,n)=>(y(),R(G,null,[o(bt,{show:c.value,"onUpdate:show":n[0]||(n[0]=d=>c.value=d),properties:r.reportProperties},null,8,["show","properties"]),o(rt,{show:p.value,"onUpdate:show":n[1]||(n[1]=d=>p.value=d)},{default:u(()=>n[2]||(n[2]=[a("strong",null,"Sharable Reports",-1),A(" is only available in solidtime Professional. ")])),_:1,__:[2]},8,["show"]),s(Ze)()?(y(),S(s(ge),{key:0,icon:s(f),onClick:g},{default:u(()=>n[3]||(n[3]=[A("Save Report")])),_:1,__:[3]},8,["icon"])):fe("",!0)],64))}}),wt={class:"flex items-center space-x-3 sm:space-x-6"},Ct={class:"flex space-x-2"},ht={class:"py-2.5 sticky top-16 z-10 w-full dark:border-[#3F4961] dark:bg-[#171E31] bg-gray-100"},kt={class:"flex flex-wrap items-center space-y-2 sm:space-y-0 space-x-4"},Vt={class:"pt-10 w-full px-3 relative"},$t={class:"sm:grid grid-cols-4 pt-6 items-start"},Rt={class:"col-span-3 dark:bg-[#171E31] rounded-lg"},St={class:"text-sm flex rounded-t-lg pt-3 dark:bg-[#0C101E] items-center space-x-3 font-medium px-6 pb-3"},Mt={class:"grid items-center pt-3 pr-5",style:{"grid-template-columns":"1fr 100px"}},Tt={class:"contents [&>*]:transition text-text-tertiary [&>*]:h-[50px]"},Ut={class:"justify-end flex items-center font-medium"},zt={key:1,class:"chart flex flex-col items-center justify-center py-12 col-span-3"},Et={class:"px-2 lg:px-4"},jt=z({__name:"ReportingOverview",setup(k){const{handleApiRequestNotifications:c}=ve(),p=re("reporting-start-date",P(B()().format()).subtract(14,"d").format()),f=re("reporting-end-date",P(B()().format()).format()),g=_([]),r=_([]),n=_([]),d=_([]),w=_([]),i=_(null),m=le("reporting-group","project"),V=le("reporting-sub-group","task"),W=N(),{aggregatedGraphTimeEntries:Q,aggregatedTableTimeEntries:v}=L(W),{groupByOptions:I}=W,X=We("organization");function E(){let l={start:P(p.value).startOf("day").utc().format(),end:P(f.value).endOf("day").utc().format()};return l={...l,member_ids:n.value.length>0?n.value:void 0,project_ids:r.value.length>0?r.value:void 0,task_ids:d.value.length>0?d.value:void 0,client_ids:w.value.length>0?w.value:void 0,tag_ids:g.value.length>0?g.value:void 0,billable:i.value!==null?i.value:void 0,member_id:K()==="employee"?J():void 0},l}function Y(){const l=E();K()==="employee"&&(l.member_id=J()),l.fill_gaps_in_time_groups="true",l.group=q(p.value,f.value),N().fetchGraphReporting(l)}function j(){const l=E();if(m.value===V.value){const e=I.find(t=>t.value!==m.value);e!=null&&e.value&&(V.value=e.value)}K()==="employee"&&(l.member_id=J()),l.group=m.value,l.sub_group=V.value,N().fetchTableReporting(l)}function $(){Y(),j()}function q(l,e){const t=B()(e).diff(B()(l),"d");return t<=31?"day":t<=200?"week":"month"}Qe(()=>{Y(),j()});const{tags:be}=L(ie());async function xe(l){return await ie().createTag(l)}const we=U(()=>({...E(),group:m.value,sub_group:V.value,history_group:q(p.value,f.value)}));async function Ce(l){const e=ye();if(e){const t=await c(()=>_e.exportAggregatedTimeEntries({params:{organization:e},queries:{...E(),group:m.value,sub_group:V.value,history_group:q(p.value,f.value),format:l}}),"Export successful","Export failed");t!=null&&t.download_url&&(H.value=!0,Z.value=t.download_url)}}const{getNameForReportingRowEntry:D,emptyPlaceholder:he}=N(),ke=it(),{projects:Ve}=L(ke),H=_(!1),Z=_(null),$e=U(()=>{var l,e;return((e=(l=v.value)==null?void 0:l.grouped_data)==null?void 0:e.map(t=>{var h,x,ee,te,oe,ae,se;const b=D(t.key,(h=v.value)==null?void 0:h.grouped_type);let C=nt(t.key??"none");return b&&((x=v.value)!=null&&x.grouped_type)&&he[(ee=v.value)==null?void 0:ee.grouped_type]===b?C="#CCCCCC":((te=v.value)==null?void 0:te.grouped_type)==="project"&&(C=((ae=(oe=Ve.value)==null?void 0:oe.find(Se=>Se.id===t.key))==null?void 0:ae.color)??"#CCCCCC"),{value:t.seconds,name:D(t.key,(se=v.value)==null?void 0:se.grouped_type)??"",color:C}}))??[]}),Re=U(()=>{var l,e;return(e=(l=v.value)==null?void 0:l.grouped_data)==null?void 0:e.map(t=>{var b,C;return{seconds:t.seconds,cost:t.cost,description:D(t.key,(b=v.value)==null?void 0:b.grouped_type),grouped_data:((C=t.grouped_data)==null?void 0:C.map(h=>({seconds:h.seconds,cost:h.cost,description:D(h.key,t.grouped_type)})))??[]}})});return(l,e)=>(y(),R(G,null,[o(Ee,{show:H.value,"onUpdate:show":e[0]||(e[0]=t=>H.value=t),"export-url":Z.value},null,8,["show","export-url"]),o(F,{class:"py-3 sm:py-4 sticky top-0 dark:border-[#3F4961] z-10 flex justify-between items-center dark:bg-[#171E31] bg-gray-100"},{default:u(()=>[a("div",wt,[o(Ie,{icon:s(ut),title:"Reporting"},null,8,["icon"]),o(ze,{active:"reporting"})]),a("div",Ct,[o(je,{download:Ce}),o(xt,{"report-properties":we.value},null,8,["report-properties"])])]),_:1}),a("div",ht,[o(F,{class:"sm:flex space-y-4 sm:space-y-0 justify-between"},{default:u(()=>[a("div",kt,[e[10]||(e[10]=a("div",{class:"text-sm font-medium"},"Filters",-1)),o(De,{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value=t),onSubmit:$},{trigger:u(()=>[o(M,{count:n.value.length,active:n.value.length>0,title:"Members",icon:s(pt)},null,8,["count","active","icon"])]),_:1},8,["modelValue"]),o(Pe,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value=t),onSubmit:$},{trigger:u(()=>[o(M,{count:r.value.length,active:r.value.length>0,title:"Projects",icon:s(ue)},null,8,["count","active","icon"])]),_:1},8,["modelValue"]),o(Be,{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=t=>d.value=t),onSubmit:$},{trigger:u(()=>[o(M,{count:d.value.length,active:d.value.length>0,title:"Tasks",icon:s(dt)},null,8,["count","active","icon"])]),_:1},8,["modelValue"]),o(Ne,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=t=>w.value=t),onSubmit:$},{trigger:u(()=>[o(M,{count:w.value.length,active:w.value.length>0,title:"Clients",icon:s(ue)},null,8,["count","active","icon"])]),_:1},8,["modelValue"]),o(lt,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=t=>g.value=t),"create-tag":xe,tags:s(be),onSubmit:$},{trigger:u(()=>[o(M,{count:g.value.length,active:g.value.length>0,title:"Tags",icon:s(mt)},null,8,["count","active","icon"])]),_:1},8,["modelValue","tags"])]),a("div",null,[o(Oe,{start:s(p),"onUpdate:start":e[6]||(e[6]=t=>O(p)?p.value=t:null),end:s(f),"onUpdate:end":e[7]||(e[7]=t=>O(f)?f.value=t:null),onSubmit:$},null,8,["start","end"])])]),_:1})]),o(F,null,{default:u(()=>{var t,b;return[a("div",Vt,[o(Fe,{"grouped-type":(t=s(Q))==null?void 0:t.grouped_type,"grouped-data":(b=s(Q))==null?void 0:b.grouped_data},null,8,["grouped-type","grouped-data"])])]}),_:1}),o(F,null,{default:u(()=>{var t,b,C,h;return[a("div",$t,[a("div",Rt,[a("div",St,[e[11]||(e[11]=a("span",null,"Group by",-1)),o(pe,{modelValue:s(m),"onUpdate:modelValue":e[8]||(e[8]=x=>O(m)?m.value=x:null),"group-by-options":s(I),onChanged:j},null,8,["modelValue","group-by-options","onChanged"]),e[12]||(e[12]=a("span",null,"and",-1)),o(pe,{modelValue:s(V),"onUpdate:modelValue":e[9]||(e[9]=x=>O(V)?V.value=x:null),"group-by-options":s(I).filter(x=>x.value!==s(m)),onChanged:j},null,8,["modelValue","group-by-options","onChanged"])]),a("div",Mt,[e[15]||(e[15]=a("div",{class:"contents [&>*]: [&>*]:[&>*]:bg-tertiary [&>*]:pb-1.5 [&>*]:pt-1 text-text-secondary text-sm"},[a("div",{class:"pl-6"},"Name"),a("div",{class:"text-right"},"Duration")],-1)),(t=s(v))!=null&&t.grouped_data&&((b=s(v).grouped_data)==null?void 0:b.length)>0?(y(),R(G,{key:0},[(y(!0),R(G,null,Xe(Re.value,x=>(y(),S(Ae,{key:x.description??"none",currency:s(Te)(),type:s(v).grouped_type,entry:x},null,8,["currency","type","entry"]))),128)),a("div",Tt,[e[13]||(e[13]=a("div",{class:"flex items-center pl-6 font-medium"},[a("span",null,"Total")],-1)),a("div",Ut,ce(s(Ue)(s(v).seconds,(C=s(X))==null?void 0:C.interval_format,(h=s(X))==null?void 0:h.number_format)),1)])],64)):(y(),R("div",zt,e[14]||(e[14]=[a("p",{class:"text-lg text-text-primary font-semibold"}," No time entries found ",-1),a("p",null,"Try to change the filters and time range",-1)])))])]),a("div",Et,[o(Ge,{data:$e.value},null,8,["data"])])])]}),_:1})],64))}}),Io=z({__name:"Reporting",setup(k){return(c,p)=>(y(),S(Me,{title:"Reporting","data-testid":"reporting_view",class:""},{default:u(()=>[o(jt)]),_:1}))}});export{Io as default};
//# sourceMappingURL=Reporting-DbT-4Xce.js.map
