import{e as Te,_ as Ue}from"./AppLayout.vue_vue_type_script_setup_true_lang-B5it3Y5_.js";import{a as je,B as De}from"./BillableIcon-BvHKiDs7.js";import{g as le}from"./money-C8rBYmfS.js";import{h as I,g as A,a as Ne}from"./time-D8fzVCgi.js";import{f as Pe}from"./money-CQyR8ykW.js";import{_ as ze}from"./ReportingTabNavbar.vue_vue_type_script_setup_true_lang-C34uGKMn.js";import{_ as Ee,a as Oe,b as Ie,c as R,d as Ae,e as Ge,f as Fe,g as qe}from"./ReportingExportModal.vue_vue_type_script_setup_true_lang-BEptfLb-.js";import{u as G,R as He,_ as Le,a as Je}from"./useReporting-0JevMOU8.js";import{_ as We}from"./PageTitle.vue_vue_type_script_setup_true_lang-BxZn5Rae.js";import{_ as ce,a as Ke}from"./SelectDropdown.vue_vue_type_script_setup_true_lang-BzQ1fREU.js";import{d as P,x as fe,y as ve,c as N,b as M,o as b,w as u,e as o,f as a,k as Qe,t as Z,r as _,l as L,n as Xe,h as S,j as ge,u as r,M as Ye,F as H,A as Q,B as Ze,q as et,I as F,i as tt}from"./app-DUID27fb.js";import{b as ot,M as q,a as at}from"./MainContainer-DtfFNECZ.js";import{_ as _e}from"./SecondaryButton.vue_vue_type_script_setup_true_lang-BtFFhAH2.js";import"./utc-CJhWvcZK.js";import{g as be,a as rt,c as X,e as Y}from"./useMembers-fKrmzvmk.js";import{b as ye,a as xe}from"./notification-cXlbw5Vr.js";import{t as st}from"./permissions-BsGx_A78.js";import{_ as ne}from"./TextInput.vue_vue_type_script_setup_true_lang-DItGfPyY.js";import{_ as lt}from"./DialogModal.vue_vue_type_script_setup_true_lang-XAFzrvZ5.js";import{_ as nt}from"./PrimaryButton.vue_vue_type_script_setup_true_lang-B1YYrMbH.js";import{_ as D}from"./InputLabel.vue_vue_type_script_setup_true_lang-BZNuSpdv.js";import{u as it}from"./useMutation-BL9ftmQb.js";import{D as ut}from"./DatePicker-BtvDsz6k.js";import{_ as pt}from"./Checkbox.vue_vue_type_script_setup_true_lang-DWH-CjmP.js";import{i as dt}from"./billing-BjyYMmvp.js";import{_ as mt}from"./UpgradeModal.vue_vue_type_script_setup_true_lang-BVwe-qjt.js";import{_ as ct}from"./TagDropdown.vue_vue_type_script_setup_true_lang-kuqSBFpI.js";import{a as ie}from"./init-BsFOScD8.js";import{d as ue,e as pe}from"./index-D03bkDOQ.js";import{r as de}from"./FolderIcon-DbiJK5M-.js";import{r as ft}from"./CheckCircleIcon-CR_8rZI8.js";import"./utils-BeV0Y9mJ.js";import"./bundle-mjs-D696Ktp4.js";import"./useFocusGuards-D60G0-_2.js";import"./useOrganization-BJAvoR2D.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./theme-idUPXIqc.js";import"./useQuery-BllrDSBf.js";import"./LoadingSpinner.vue_vue_type_script_setup_true_lang-Bs-sRE9c.js";import"./ClockIcon-DymtNJg4.js";import"./TabBar.vue_vue_type_script_setup_true_lang-FxptvPJp.js";import"./Collection-DeTUl_xM.js";import"./usePrimitiveElement-b6ljwxpe.js";import"./RovingFocusGroup-BeTyvml_.js";import"./useLocale-BjfOTVRz.js";import"./createLucideIcon-l232JYPa.js";import"./index-DOp9rKwc.js";import"./Modal.vue_vue_type_script_setup_true_lang-CNtdiaUN.js";import"./GroupedItemsCountButton.vue_vue_type_script_setup_true_lang-DHdKi0r5.js";import"./install-BXuwDxkC.js";import"./TagCreateModal.vue_vue_type_script_setup_true_lang-kqmcCxbp.js";import"./component-CGwmUpCj.js";const me=P({__name:"ReportingGroupBySelect",props:fe({groupByOptions:{}},{modelValue:{default:null},modelModifiers:{}}),emits:["update:modelValue"],setup(h){const c=ve(h,"modelValue"),p=h,v=N(()=>{var l;return(l=p.groupByOptions.find(i=>i.value===c.value))==null?void 0:l.icon}),g=N(()=>{var l;return(l=p.groupByOptions.find(i=>i.value===c.value))==null?void 0:l.label});return(l,i)=>(b(),M(ce,{modelValue:c.value,"onUpdate:modelValue":i[0]||(i[0]=d=>c.value=d),"get-key-from-item":d=>d.value,"get-name-for-item":d=>d.label,items:l.groupByOptions},{trigger:u(()=>[o(Ke,{size:"large",tag:"button",class:"cursor-pointer hover:bg-card-background transition space-x-5 flex"},{default:u(()=>[(b(),M(Qe(v.value),{class:"h-4 text-text-secondary"})),a("span",null,Z(g.value),1)]),_:1})]),_:1},8,["modelValue","get-key-from-item","get-name-for-item","items"]))}}),vt={class:"items-center space-y-4 w-full"},gt={class:"w-full"},_t={class:"flex items-center space-x-12"},bt={class:"flex items-center space-x-3 px-2 py-3"},yt={key:0,class:"flex items-center space-x-4"},xt=P({__name:"ReportCreateModal",props:fe({properties:{}},{show:{default:!1},showModifiers:{}}),emits:["update:show"],setup(h){const c=ve(h,"show"),p=_(!1),v=it({mutationFn:async w=>{const s=be();if(s===null)throw new Error("No current organization id - create report");return await xe.createReport(w,{params:{organization:s}})}}),g=h,l=_({name:"",description:"",is_public:!0,public_until:null}),{handleApiRequestNotifications:i}=ye();async function d(){await i(()=>v.mutateAsync({...l.value,properties:{...g.properties}}),"Success","Error",()=>{l.value={name:"",description:"",is_public:!1,public_until:null},c.value=!1})}return(w,s)=>(b(),M(lt,{closeable:"",show:c.value,onClose:s[4]||(s[4]=m=>c.value=!1)},{title:u(()=>s[5]||(s[5]=[a("div",{class:"flex space-x-2"},[a("span",null," Create Report ")],-1)])),content:u(()=>[a("div",vt,[a("div",gt,[o(D,{for:"name",value:"Name"}),o(ne,{id:"name",modelValue:l.value.name,"onUpdate:modelValue":s[0]||(s[0]=m=>l.value.name=m),class:"mt-1.5 w-full"},null,8,["modelValue"])]),a("div",null,[o(D,{for:"description",value:"Description"}),o(ne,{id:"description",modelValue:l.value.description,"onUpdate:modelValue":s[1]||(s[1]=m=>l.value.description=m),class:"mt-1.5 w-full"},null,8,["modelValue"])]),o(D,{value:"Visibility"}),a("div",_t,[a("div",bt,[o(r(pt),{id:"is_public",checked:l.value.is_public,"onUpdate:checked":s[2]||(s[2]=m=>l.value.is_public=m)},null,8,["checked"]),o(D,{for:"is_public",value:"Public"})]),l.value.is_public?(b(),S("div",yt,[a("div",null,[o(D,{for:"public_until",value:"Expires at"}),s[6]||(s[6]=a("div",{class:"text-text-tertiary font-medium"}," (optional) ",-1))]),o(ut,{id:"public_until"})])):ge("",!0)])])]),footer:u(()=>[o(_e,{onClick:s[3]||(s[3]=m=>c.value=!1)},{default:u(()=>s[7]||(s[7]=[L(" Cancel")])),_:1,__:[7]}),o(nt,{class:Xe(["ms-3",{"opacity-25":p.value}]),disabled:p.value,onClick:d},{default:u(()=>s[8]||(s[8]=[L(" Create Report ")])),_:1,__:[8]},8,["class","disabled"])]),_:1},8,["show"]))}}),wt=P({__name:"ReportSaveButton",props:{reportProperties:{}},setup(h){const c=_(!1),p=_(!1),v=Ye("div",{innerHTML:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/><path d="M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7M7 3v4a1 1 0 0 0 1 1h7"/></g></svg>'});function g(){dt()?c.value=!0:p.value=!0}return(l,i)=>(b(),S(H,null,[o(xt,{show:c.value,"onUpdate:show":i[0]||(i[0]=d=>c.value=d),properties:l.reportProperties},null,8,["show","properties"]),o(mt,{show:p.value,"onUpdate:show":i[1]||(i[1]=d=>p.value=d)},{default:u(()=>i[2]||(i[2]=[a("strong",null,"Sharable Reports",-1),L(" is only available in solidtime Professional. ")])),_:1,__:[2]},8,["show"]),r(st)()?(b(),M(r(_e),{key:0,icon:r(v),onClick:g},{default:u(()=>i[3]||(i[3]=[L("Save Report")])),_:1,__:[3]},8,["icon"])):ge("",!0)],64))}}),Ct={class:"flex items-center space-x-3 sm:space-x-6"},Vt={class:"flex space-x-2"},ht={class:"py-2.5 w-full border-b border-default-background-separator"},kt={class:"flex flex-wrap items-center space-y-2 sm:space-y-0 space-x-4"},$t={class:"pt-10 w-full px-3 relative"},Rt={class:"sm:grid grid-cols-4 pt-6 items-start"},St={class:"col-span-3 bg-card-background rounded-lg border border-card-border pt-3"},Mt={class:"text-sm flex text-text-primary items-center space-x-3 font-medium px-6 border-b border-card-background-separator pb-3"},Bt={class:"grid items-center",style:{"grid-template-columns":"1fr 100px 150px"}},Tt={class:"contents [&>*]:transition text-text-tertiary [&>*]:h-[50px]"},Ut={class:"justify-end flex items-center font-medium"},jt={class:"justify-end pr-6 flex items-center font-medium"},Dt={key:1,class:"chart flex flex-col items-center justify-center py-12 col-span-3"},Nt={class:"px-2 lg:px-4"},Pt=P({__name:"ReportingOverview",setup(h){const{handleApiRequestNotifications:c}=ye(),p=ue("reporting-start-date",I(A()().format()).subtract(14,"d").format()),v=ue("reporting-end-date",I(A()().format()).format()),g=_([]),l=_([]),i=_([]),d=_([]),w=_([]),s=_(null),m=pe("reporting-group","project"),k=pe("reporting-sub-group","task"),ee=G(),{aggregatedGraphTimeEntries:te,aggregatedTableTimeEntries:f}=Q(ee),{groupByOptions:J}=ee,B=Ze("organization");function z(){let n={start:I(p.value).startOf("day").utc().format(),end:I(v.value).endOf("day").utc().format()};return n={...n,member_ids:i.value.length>0?i.value:void 0,project_ids:l.value.length>0?l.value:void 0,task_ids:d.value.length>0?d.value:void 0,client_ids:w.value.length>0?w.value:void 0,tag_ids:g.value.length>0?g.value:void 0,billable:s.value!==null?s.value:void 0,member_id:Y()==="employee"?X():void 0},n}function oe(){const n=z();Y()==="employee"&&(n.member_id=X()),n.fill_gaps_in_time_groups="true",n.group=W(p.value,v.value),G().fetchGraphReporting(n)}function E(){const n=z();if(m.value===k.value){const e=J.find(t=>t.value!==m.value);e!=null&&e.value&&(k.value=e.value)}Y()==="employee"&&(n.member_id=X()),n.group=m.value,n.sub_group=k.value,G().fetchTableReporting(n)}function $(){oe(),E()}function W(n,e){const t=A()(e).diff(A()(n),"d");return t<=31?"day":t<=200?"week":"month"}et(()=>{oe(),E()});const{tags:we}=Q(ie());async function Ce(n){return await ie().createTag(n)}const Ve=N(()=>({...z(),group:m.value,sub_group:k.value,history_group:W(p.value,v.value)}));async function he(n){const e=be();if(e){const t=await c(()=>xe.exportAggregatedTimeEntries({params:{organization:e},queries:{...z(),group:m.value,sub_group:k.value,history_group:W(p.value,v.value),format:n}}),"Export successful","Export failed");t!=null&&t.download_url&&(K.value=!0,ae.value=t.download_url)}}const{getNameForReportingRowEntry:O,emptyPlaceholder:ke}=G(),$e=rt(),{projects:Re}=Q($e),K=_(!1),ae=_(null),Se=N(()=>{var n,e;return((e=(n=f.value)==null?void 0:n.grouped_data)==null?void 0:e.map(t=>{var V,T,U,j,x,re,se;const y=O(t.key,(V=f.value)==null?void 0:V.grouped_type);let C=je(t.key??"none");return y&&((T=f.value)!=null&&T.grouped_type)&&ke[(U=f.value)==null?void 0:U.grouped_type]===y?C="#CCCCCC":((j=f.value)==null?void 0:j.grouped_type)==="project"&&(C=((re=(x=Re.value)==null?void 0:x.find(Be=>Be.id===t.key))==null?void 0:re.color)??"#CCCCCC"),{value:t.seconds,name:O(t.key,(se=f.value)==null?void 0:se.grouped_type)??"",color:C}}))??[]}),Me=N(()=>{var n,e;return(e=(n=f.value)==null?void 0:n.grouped_data)==null?void 0:e.map(t=>{var y,C;return{seconds:t.seconds,cost:t.cost,description:O(t.key,(y=f.value)==null?void 0:y.grouped_type),grouped_data:((C=t.grouped_data)==null?void 0:C.map(V=>({seconds:V.seconds,cost:V.cost,description:O(V.key,t.grouped_type)})))??[]}})});return(n,e)=>(b(),S(H,null,[o(Ee,{show:K.value,"onUpdate:show":e[0]||(e[0]=t=>K.value=t),"export-url":ae.value},null,8,["show","export-url"]),o(q,{class:"py-3 sm:py-5 border-b border-default-background-separator flex justify-between items-center"},{default:u(()=>[a("div",Ct,[o(We,{icon:r(ot),title:"Reporting"},null,8,["icon"]),o(ze,{active:"reporting"})]),a("div",Vt,[o(Oe,{download:he}),o(wt,{"report-properties":Ve.value},null,8,["report-properties"])])]),_:1}),a("div",ht,[o(q,{class:"sm:flex space-y-4 sm:space-y-0 justify-between"},{default:u(()=>[a("div",kt,[e[11]||(e[11]=a("div",{class:"text-sm font-medium"},"Filters",-1)),o(Ie,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=t=>i.value=t),onSubmit:$},{trigger:u(()=>[o(R,{count:i.value.length,active:i.value.length>0,title:"Members",icon:r(at)},null,8,["count","active","icon"])]),_:1},8,["modelValue"]),o(Ae,{modelValue:l.value,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value=t),onSubmit:$},{trigger:u(()=>[o(R,{count:l.value.length,active:l.value.length>0,title:"Projects",icon:r(de)},null,8,["count","active","icon"])]),_:1},8,["modelValue"]),o(Ge,{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=t=>d.value=t),onSubmit:$},{trigger:u(()=>[o(R,{count:d.value.length,active:d.value.length>0,title:"Tasks",icon:r(ft)},null,8,["count","active","icon"])]),_:1},8,["modelValue"]),o(Fe,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=t=>w.value=t),onSubmit:$},{trigger:u(()=>[o(R,{count:w.value.length,active:w.value.length>0,title:"Clients",icon:r(de)},null,8,["count","active","icon"])]),_:1},8,["modelValue"]),o(ct,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=t=>g.value=t),"create-tag":Ce,tags:r(we),onSubmit:$},{trigger:u(()=>[o(R,{count:g.value.length,active:g.value.length>0,title:"Tags",icon:r(Te)},null,8,["count","active","icon"])]),_:1},8,["modelValue","tags"]),o(ce,{modelValue:s.value,"onUpdate:modelValue":e[6]||(e[6]=t=>s.value=t),"get-key-from-item":t=>t.value,"get-name-for-item":t=>t.label,items:[{label:"Both",value:null},{label:"Billable",value:"true"},{label:"Non Billable",value:"false"}],onChanged:$},{trigger:u(()=>[o(R,{active:s.value!==null,title:s.value==="false"?"Non Billable":"Billable",icon:De},null,8,["active","title"])]),_:1},8,["modelValue","get-key-from-item","get-name-for-item"])]),a("div",null,[o(qe,{start:r(p),"onUpdate:start":e[7]||(e[7]=t=>F(p)?p.value=t:null),end:r(v),"onUpdate:end":e[8]||(e[8]=t=>F(v)?v.value=t:null),onSubmit:$},null,8,["start","end"])])]),_:1})]),o(q,null,{default:u(()=>{var t,y;return[a("div",$t,[o(He,{"grouped-type":(t=r(te))==null?void 0:t.grouped_type,"grouped-data":(y=r(te))==null?void 0:y.grouped_data},null,8,["grouped-type","grouped-data"])])]}),_:1}),o(q,null,{default:u(()=>{var t,y,C,V,T,U,j;return[a("div",Rt,[a("div",St,[a("div",Mt,[e[12]||(e[12]=a("span",null,"Group by",-1)),o(me,{modelValue:r(m),"onUpdate:modelValue":e[9]||(e[9]=x=>F(m)?m.value=x:null),"group-by-options":r(J),onChanged:E},null,8,["modelValue","group-by-options","onChanged"]),e[13]||(e[13]=a("span",null,"and",-1)),o(me,{modelValue:r(k),"onUpdate:modelValue":e[10]||(e[10]=x=>F(k)?k.value=x:null),"group-by-options":r(J).filter(x=>x.value!==r(m)),onChanged:E},null,8,["modelValue","group-by-options","onChanged"])]),a("div",Bt,[e[16]||(e[16]=a("div",{class:"contents [&>*]:border-card-background-separator [&>*]:border-b [&>*]:bg-tertiary [&>*]:pb-1.5 [&>*]:pt-1 text-text-secondary text-sm"},[a("div",{class:"pl-6"},"Name"),a("div",{class:"text-right"},"Duration"),a("div",{class:"text-right pr-6"},"Cost")],-1)),(t=r(f))!=null&&t.grouped_data&&((y=r(f).grouped_data)==null?void 0:y.length)>0?(b(),S(H,{key:0},[(b(!0),S(H,null,tt(Me.value,x=>(b(),M(Je,{key:x.description??"none",currency:r(le)(),type:r(f).grouped_type,entry:x},null,8,["currency","type","entry"]))),128)),a("div",Tt,[e[14]||(e[14]=a("div",{class:"flex items-center pl-6 font-medium"},[a("span",null,"Total")],-1)),a("div",Ut,Z(r(Ne)(r(f).seconds,(C=r(B))==null?void 0:C.interval_format,(V=r(B))==null?void 0:V.number_format)),1),a("div",jt,Z(r(f).cost?r(Pe)(r(f).cost,r(le)(),(T=r(B))==null?void 0:T.currency_format,(U=r(B))==null?void 0:U.currency_symbol,(j=r(B))==null?void 0:j.number_format):"--"),1)])],64)):(b(),S("div",Dt,e[15]||(e[15]=[a("p",{class:"text-lg text-text-primary font-semibold"}," No time entries found ",-1),a("p",null,"Try to change the filters and time range",-1)])))])]),a("div",Nt,[o(Le,{data:Se.value},null,8,["data"])])])]}),_:1})],64))}}),Po=P({__name:"Reporting",setup(h){return(c,p)=>(b(),M(Ue,{title:"Reporting","data-testid":"reporting_view",class:"overflow-hidden"},{default:u(()=>[o(Pt)]),_:1}))}});export{Po as default};
//# sourceMappingURL=Reporting-CgM00LXJ.js.map
