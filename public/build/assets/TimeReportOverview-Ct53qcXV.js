import{g as Ce}from"./money-BufCQq2I.js";import{t as re,g as y,a as Me,h as ae}from"./time-DR3Bm2fi.js";import{u as j,R as Ee,a as je,_ as De}from"./useReporting-S2gixkGw.js";import{M as h}from"./MainContainer-DAB7AmGD.js";import{_ as Te}from"./TimeReportRowHeading.vue_vue_type_script_setup_true_lang-BQpM18bZ.js";import{e as f,o as p,a,d as Re,Q as $e,r as b,l as D,M as Se,B as Ye,s as A,z as Ne,v as Be,c as T,w as m,b as u,u as o,j as Ie,t as x,f as O,g as R,F as k,h as F,I as ie,N as ne}from"./app-CZLkYVhz.js";import{_ as Ae}from"./AppLayout.vue_vue_type_script_setup_true_lang-7v21bPMn.js";import{b as Oe}from"./notification-BrLDF-00.js";import{b as z,a as P}from"./useUser-Dc3_Hjqo.js";import{u as de}from"./init-DIMnQ95t.js";import{d as le,e as pe}from"./index-CHolqtoz.js";import{a as Fe}from"./color-NTCrcshl.js";import{a as ze}from"./useMembers-B2Kv7mzm.js";import{d as Pe}from"./utc-YQln_hJX.js";import{_ as Ge}from"./ReadOnlyTimeEntryRow.vue_vue_type_script_setup_true_lang-likYSDHR.js";import{_ as $}from"./SecondaryButton.vue_vue_type_script_setup_true_lang-iS1Fl1UI.js";/* empty css                                                                             */import"./useCurrentTimeEntry-CruyZJNI.js";import"./permissions-hl9spDHx.js";import{_ as Ve}from"./ReadOnlyTimeEntryAggregateRow.vue_vue_type_script_setup_true_lang-BmGd5AOC.js";import"./GroupedItemsCountButton.vue_vue_type_script_setup_true_lang-DXMK0t_p.js";import"./bundle-mjs-D696Ktp4.js";import"./install-BiQo9UUP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./BillableIcon-BlL7cW2e.js";import"./UserGroupIcon-DEClCgLE.js";import"./FolderIcon-BBOgs1tQ.js";import"./CheckCircleIcon-ByT7Dbrk.js";import"./UserCircleIcon-B_03lMym.js";import"./Dropdown.vue_vue_type_script_setup_true_lang-2TV_nqEm.js";import"./utils-DLNr0s0q.js";import"./useFocusGuards-DKIr8CEw.js";import"./billing-F8TVwX2K.js";import"./useOrganization-Dnx8kCk3.js";import"./DialogModal.vue_vue_type_script_setup_true_lang-Dn6gUihL.js";import"./Modal.vue_vue_type_script_setup_true_lang-DiIZ2Ob1.js";import"./PrimaryButton.vue_vue_type_script_setup_true_lang-DGqi3YE0.js";import"./LoadingSpinner.vue_vue_type_script_setup_true_lang-CAmSBxXF.js";import"./theme-DlEllDdR.js";import"./useQuery-QapR65Yu.js";import"./ClockIcon-DtFwBiYn.js";import"./TagIcon-D32GhY_O.js";import"./TimeEntryRowDurationInput.vue_vue_type_script_setup_true_lang-G0TwUc7C.js";import"./BillableToggleButton.vue_vue_type_script_setup_true_lang-9IV1xJ9S.js";import"./ProjectBadge.vue_vue_type_script_setup_true_lang-CJeOBiho.js";import"./Badge.vue_vue_type_script_setup_true_lang-Bn80q8dA.js";function He(ue,n){return p(),f("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"fill-rule":"evenodd",d:"M11.03 3.97a.75.75 0 0 1 0 1.06l-6.22 6.22H21a.75.75 0 0 1 0 1.5H4.81l6.22 6.22a.75.75 0 1 1-1.06 1.06l-7.5-7.5a.75.75 0 0 1 0-1.06l7.5-7.5a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"})])}const Le={class:"flex space-x-2"},We={class:"px-2 font-bold text-lg"},Je={class:"pl-2 font-semibold"},Ue={class:"relative flex space-x-2 w-full"},Ke={class:"px-2 text-sm"},Qe={class:"pl-2 font-semibold"},Ze={key:0,class:"absolute right-5 pl-2 font-semibold"},qe={key:1,class:"absolute right-5 pl-2 font-semibold"},Xe={key:2,class:"absolute right-5 pl-2 font-semibold"},et={class:"pt-10 w-full px-3 relative"},tt={class:"sm:grid grid-cols-4 pt-6 items-start"},st={class:"col-span-3 bg-card-background rounded-lg dark:bg-[#171e31]"},ot={class:"items-center"},rt={class:"grid grid-cols-12 [&>*]:transition text-text-tertiary [&>*]:h-[50px]"},at={class:"col-span-2 flex justify-start"},it={class:"justify-end flex items-center font-medium"},nt={key:1,class:"chart flex flex-col items-center justify-center py-12 col-span-3"},dt={class:"px-2 lg:px-4"},lt={class:"border border-1 mt-5 border-[#2c354f] border-b-4"},ss=Re({__name:"TimeReportOverview",setup(ue){const n=$e(),g=b(!1),w=D(()=>{const t=n.props.timeEntries;if(t.length===0)return"none";const e=t[0].approval;return t.every(d=>d.approval===e)?e:"mixed"}),S=le("reporting-start-date",""),Y=le("reporting-end-date",""),G=b([]),V=b([]),C=b([]),H=b([]),L=b([]),W=b(null);Se(()=>{S.value=n.props.period.start,Y.value=n.props.period.end,C.value=[n.props.userid]});const N=pe("reporting-group","project"),B=pe("reporting-sub-group","task");Ye(()=>C,t=>{console.log("selectedMembers changed:",t)},{deep:!0});const J=j(),{aggregatedGraphTimeEntries:U,aggregatedTableTimeEntries:c}=A(J),{groupByOptions:ce}=J,K=Ne("organization");function Q(){let t={start:ae(S.value).startOf("day").utc().format(),end:ae(Y.value).endOf("day").utc().format()};return t={...t,member_ids:C.value.length>0?C.value:void 0,project_ids:V.value.length>0?V.value:void 0,task_ids:H.value.length>0?H.value:void 0,client_ids:L.value.length>0?L.value:void 0,tag_ids:G.value.length>0?G.value:void 0,billable:W.value!==null?W.value:void 0,member_id:z()==="employee"?P():void 0},t}function me(){const t=Q();z()==="employee"&&(t.member_id=P()),t.fill_gaps_in_time_groups="true",t.group=ge(S.value,Y.value),j().fetchGraphReporting(t)}function fe(){const t=Q();if(N.value===B.value){const e=ce.find(s=>s.value!==N.value);e!=null&&e.value&&(B.value=e.value)}z()==="employee"&&(t.member_id=P()),t.group=N.value,t.sub_group=B.value,j().fetchTableReporting(t)}function ge(t,e){const s=y()(e).diff(y()(t),"d");return s<=31?"day":s<=200?"week":"month"}Be(()=>{me(),fe()});const{tags:Z}=A(de());async function ve(t){return await de().createTag(t)}const{addNotification:M}=Oe();async function q(t){g.value=!0;try{const e=n.props.timeEntries.map(s=>s.id);await ie.post(route(`approval.${t}`),{timeEntries:e,period:`${v(n.props.period.start,"ddd, MMMM D")} -
                    ${v(n.props.period.end,"D - YYYY")}`},{withCredentials:!0,headers:{Accept:"application/json"}}),M("success",`${t==="approve"?"Approved":"Rejected"}`),g.value=!1,setTimeout(()=>{ne.visit(route("approval.index"))},1500)}catch(e){console.error(e),M("error","Failed",`Could not ${t} entries`),g.value=!1}}const{getNameForReportingRowEntry:E,emptyPlaceholder:_e}=j(),be=ze(),{projects:I}=A(be),ye=D(()=>{var t,e;return((e=(t=c.value)==null?void 0:t.grouped_data)==null?void 0:e.map(s=>{var i,l,_,ee,te,se,oe;const d=E(s.key,(i=c.value)==null?void 0:i.grouped_type);let r=Fe(s.key??"none");return d&&((l=c.value)!=null&&l.grouped_type)&&_e[(_=c.value)==null?void 0:_.grouped_type]===d?r="#CCCCCC":((ee=c.value)==null?void 0:ee.grouped_type)==="project"&&(r=((se=(te=I.value)==null?void 0:te.find(we=>we.id===s.key))==null?void 0:se.color)??"#CCCCCC"),{value:s.seconds,name:E(s.key,(oe=c.value)==null?void 0:oe.grouped_type)??"",color:r}}))??[]}),xe=D(()=>{var t,e;return(e=(t=c.value)==null?void 0:t.grouped_data)==null?void 0:e.map(s=>{var d,r;return{seconds:s.seconds,cost:s.cost,description:E(s.key,(d=c.value)==null?void 0:d.grouped_type),grouped_data:((r=s.grouped_data)==null?void 0:r.map(i=>({seconds:i.seconds,cost:i.cost,description:E(i.key,s.grouped_type)})))??[]}})});function v(t,e){return e||(e="MMMM D"),Pe(t).format(e)}const he=D(()=>{const t={};for(const s of n.props.timeEntries){if(s.end===null)continue;const d=t[re(s.start)];t[re(s.start)]=[...d??[],s]}const e={};for(const s in t){const d=t[s],r=[];for(const i of d){const l=r.findIndex(_=>_.project_id===i.project_id&&_.task_id===i.task_id&&_.billable===i.billable&&_.description===i.description);l!==-1&&r[l]?(r[l].timeEntries.push(i),r[l].duration=(r[l].duration??0)+((i==null?void 0:i.duration)??0),y()(i.start).isBefore(y()(r[l].start))&&(r[l].start=i.start),y()(i.end).isAfter(y()(r[l].end))&&(r[l].end=i.end)):r.push({...i,timeEntries:[i]})}e[s]=r}return e});function ke(t){return t.reduce((e,s)=>e+((s==null?void 0:s.duration)??0),0)}async function X(t){g.value=!0;try{const e=n.props.timeEntries.map(s=>s.id);await ie.post(route(`approval.${t}`),{timeEntries:e,period:`${v(n.props.period.start,"ddd, MMMM D")} -
                    ${v(n.props.period.end,"D - YYYY")}`},{withCredentials:!0,headers:{Accept:"application/json"}}),M("success",`${t==="withdraw"?"Withdraw Entries":"Sent Reminder Successfuly"}`),setTimeout(()=>{ne.visit(route("approval.index"))},1500),g.value=!1}catch(e){console.error(e),M("error","Failed",`Could not ${t} entries`),g.value=!1}}return(t,e)=>(p(),T(Ae,{title:"Reporting","data-testid":"reporting_view",class:"overflow-hidden"},{default:m(()=>[e[13]||(e[13]=a("div",{class:"flex"},null,-1)),u(h,{class:"py-3 sm:py-5 border-b border-default-background-separator flex justify-between items-center"},{default:m(()=>[a("div",Le,[u(o(Ie),{href:t.route("approval.index"),title:"back"},{default:m(()=>[u(o(He),{class:"w-5"})]),_:1},8,["href"]),a("div",We,x(o(n).props.name),1),e[4]||(e[4]=a("div",{class:"font-bold text-lg"}," - ",-1)),a("div",Je,"( "+x(v(o(n).props.period.start,"ddd, MMMM D"))+" - "+x(v(o(n).props.period.end,"D - YYYY"))+")",1)])]),_:1}),u(h,{class:"py-3 sm:py-5 border-b border-default-background-separator flex justify-between items-center"},{default:m(()=>[a("div",Ue,[a("div",Ke," Submitted by: "+x(o(n).props.name),1),a("div",Qe,"( "+x(v(o(n).props.period.end,"ddd, MMMM D - YYYY"))+") ",1),w.value=="submitted"?(p(),f("div",Ze,[u(o($),{class:"border-0 px-2 bg-blue-600 mx-2 text-white dark:text-white",loading:g.value,onClick:e[0]||(e[0]=s=>q("approve"))},{default:m(()=>e[5]||(e[5]=[R("APPROVE ")])),_:1,__:[5]},8,["loading"]),u(o($),{class:"border-0 px-2 bg-red-600 mx-2 text-white dark:text-white",loading:g.value,onClick:e[1]||(e[1]=s=>q("reject"))},{default:m(()=>e[6]||(e[6]=[R("REJECT")])),_:1,__:[6]},8,["loading"])])):O("",!0),w.value=="unsubmitted"?(p(),f("div",qe,[u(o($),{class:"border-0 px-2 bg-blue-600 mx-2 text-white dark:text-white",loading:g.value,onClick:e[2]||(e[2]=s=>X("remind"))},{default:m(()=>e[7]||(e[7]=[R("REMIND TO SUBMIT ")])),_:1,__:[7]},8,["loading"])])):O("",!0),w.value!="submitted"&&w.value!="unsubmitted"?(p(),f("div",Xe,[u(o($),{class:"border-0 px-2 bg-blue-600 mx-2 text-white dark:text-white",loading:g.value,onClick:e[3]||(e[3]=s=>X("withdraw"))},{default:m(()=>e[8]||(e[8]=[R("WITHDRAW ")])),_:1,__:[8]},8,["loading"])])):O("",!0)])]),_:1}),u(h,null,{default:m(()=>{var s,d;return[a("div",et,[u(Ee,{"grouped-type":(s=o(U))==null?void 0:s.grouped_type,"grouped-data":(d=o(U))==null?void 0:d.grouped_data},null,8,["grouped-type","grouped-data"])])]}),_:1}),u(h,null,{default:m(()=>{var s,d,r,i;return[a("div",tt,[a("div",st,[a("div",ot,[e[12]||(e[12]=a("div",{class:"grid grid-cols-12 [&>*]:dark:bg-[#0c101e] [ [&>*]:py-5 text-text-secondary text-sm"},[a("div",{class:"pl-6 col-span-10 justify-center"},"Name"),a("div",{class:"col-span-2 flex justify-start"},"Duration")],-1)),(s=o(c))!=null&&s.grouped_data&&((d=o(c).grouped_data)==null?void 0:d.length)>0?(p(),f(k,{key:0},[(p(!0),f(k,null,F(xe.value,l=>(p(),T(je,{key:l.description??"none",currency:o(Ce)(),type:o(c).grouped_type,entry:l},null,8,["currency","type","entry"]))),128)),a("div",rt,[e[10]||(e[10]=a("div",{class:"col-span-10"},null,-1)),a("div",at,[e[9]||(e[9]=a("div",{class:"flex items-center pr-2 font-medium"},[a("span",null,"Total:")],-1)),a("div",it,x(o(Me)(o(c).seconds,(r=o(K))==null?void 0:r.interval_format,(i=o(K))==null?void 0:i.number_format)),1)])])],64)):(p(),f("div",nt,e[11]||(e[11]=[a("p",{class:"text-lg text-text-primary font-semibold"}," No time entries found ",-1),a("p",null,"Try to change the filters and time range",-1)])))])]),a("div",dt,[u(De,{data:ye.value},null,8,["data"])])])]}),_:1}),u(h,{class:""},{default:m(()=>[(p(!0),f(k,null,F(he.value,(s,d)=>(p(),f("div",{key:d},[a("div",lt,[u(Te,{class:"",date:d,duration:ke(s)},null,8,["date","duration"]),(p(!0),f(k,null,F(s,r=>(p(),f(k,{key:r.id},["timeEntries"in r&&r.timeEntries.length>1?(p(),T(Ve,{key:0,projects:o(I),tasks:o(n).props.tasks,tags:o(Z),clients:o(n).props.clients,"create-tag":ve,"time-entry":r},null,8,["projects","tasks","tags","clients","time-entry"])):(p(),T(Ge,{key:1,projects:o(I),tasks:o(n).props.tasks,tags:o(Z),clients:o(n).props.clients,"time-entry":r.timeEntries[0]},null,8,["projects","tasks","tags","clients","time-entry"]))],64))),128))])]))),128))]),_:1})]),_:1,__:[13]}))}});export{ss as default};
//# sourceMappingURL=TimeReportOverview-Ct53qcXV.js.map
