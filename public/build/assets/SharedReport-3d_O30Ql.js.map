{"version":3,"file":"SharedReport-3d_O30Ql.js","sources":["../../../resources/js/Pages/SharedReport.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport MainContainer from '@/packages/ui/src/MainContainer.vue';\nimport PageTitle from '@/Components/Common/PageTitle.vue';\nimport { ChartBarIcon } from '@heroicons/vue/20/solid';\nimport ReportingChart from '@/Components/Common/Reporting/ReportingChart.vue';\nimport { formatHumanReadableDuration } from '@/packages/ui/src/utils/time';\nimport ReportingRow from '@/Components/Common/Reporting/ReportingRow.vue';\nimport ReportingPieChart from '@/Components/Common/Reporting/ReportingPieChart.vue';\nimport { formatCents } from '@/packages/ui/src/utils/money';\nimport type { CurrencyFormat } from '@/packages/ui/src/utils/money';\nimport { computed, onMounted, provide, ref } from 'vue';\nimport { useQuery } from '@tanstack/vue-query';\nimport { api } from '@/packages/api/src';\nimport { getRandomColorWithSeed } from '@/packages/ui/src/utils/color';\nimport { useReportingStore } from '@/utils/useReporting';\nimport { Head } from '@inertiajs/vue3';\nimport { useTheme } from '@/utils/theme';\n\nconst sharedSecret = ref<string | null>(null);\n\nconst hasSharedSecret = computed(() => {\n    return sharedSecret.value !== null;\n});\n\nconst { data: sharedReportResponseData } = useQuery({\n    enabled: hasSharedSecret,\n    queryKey: ['reporting', sharedSecret],\n    queryFn: () =>\n        api.getPublicReport({\n            headers: {\n                'X-Api-Key': sharedSecret.value,\n            },\n        }),\n});\n\nonMounted(() => {\n    const currentUrl = window.location.href;\n    // check if # exists exactly once in the URL\n    if (currentUrl.split('#').length === 2) {\n        sharedSecret.value = currentUrl.split('#')[1];\n    }\n});\n\nconst reportCurrency = computed(() => {\n    if (sharedReportResponseData.value) {\n        return sharedReportResponseData.value?.currency;\n    }\n    return 'EUR';\n});\n\nconst reportIntervalFormat = computed(() => {\n    return sharedReportResponseData.value?.interval_format;\n});\n\nconst reportNumberFormat = computed(() => {\n    return sharedReportResponseData.value?.number_format;\n});\n\nconst reportCurrencyFormat = computed(() => {\n    return (sharedReportResponseData.value?.currency_format ??\n        'symbol-before') as CurrencyFormat;\n});\n\nconst reportDateFormat = computed(() => {\n    return sharedReportResponseData.value?.date_format;\n});\n\nconst reportCurrencySymbol = computed(() => {\n    return sharedReportResponseData.value?.currency_symbol;\n});\n\nprovide(\n    'organization',\n    computed(() => ({\n        'number_format': reportNumberFormat.value,\n        'interval_format': reportIntervalFormat.value,\n        'currency_format': reportCurrencyFormat.value,\n        'currency_symbol': reportCurrencySymbol.value,\n        'date_format': reportDateFormat.value,\n    }))\n);\n\nconst aggregatedTableTimeEntries = computed(() => {\n    if (sharedReportResponseData.value) {\n        return sharedReportResponseData.value?.data;\n    }\n    return {\n        grouped_data: [],\n        grouped_type: 'project',\n        seconds: 0,\n        cost: 0,\n    };\n});\nconst aggregatedGraphTimeEntries = computed(() => {\n    if (sharedReportResponseData.value) {\n        return sharedReportResponseData.value?.history_data;\n    }\n    // Placeholder Data\n    return {\n        grouped_data: [],\n        grouped_type: 'project',\n        seconds: 0,\n        cost: 0,\n    };\n});\n\nconst group = computed(() => {\n    if (sharedReportResponseData.value) {\n        return sharedReportResponseData.value?.properties.group;\n    }\n    return 'billable';\n});\n\nconst subGroup = computed(() => {\n    if (sharedReportResponseData.value) {\n        return sharedReportResponseData.value?.properties.sub_group;\n    }\n    return 'project';\n});\nconst { emptyPlaceholder } = useReportingStore();\n\nconst groupedPieChartData = computed(() => {\n    return (\n        aggregatedTableTimeEntries.value?.grouped_data?.map((entry) => {\n            if (entry.description === null) {\n                return {\n                    value: entry.seconds,\n                    name: emptyPlaceholder[\n                        aggregatedTableTimeEntries.value?.grouped_type ??\n                            'project'\n                    ],\n                    color: '#CCCCCC',\n                };\n            }\n            return {\n                value: entry.seconds,\n                name: entry.description,\n                color:\n                    entry.color ??\n                    getRandomColorWithSeed(entry.description ?? 'none'),\n            };\n        }) ?? []\n    );\n});\n\nconst tableData = computed(() => {\n    return aggregatedTableTimeEntries.value?.grouped_data?.map((entry) => {\n        return {\n            seconds: entry.seconds,\n            cost: entry.cost,\n            description:\n                entry.description ??\n                emptyPlaceholder[\n                    aggregatedTableTimeEntries.value?.grouped_type ?? 'project'\n                ],\n            grouped_data:\n                entry.grouped_data?.map((el) => {\n                    return {\n                        seconds: el.seconds,\n                        cost: el.cost,\n                        description:\n                            el.description ??\n                            emptyPlaceholder[entry.grouped_type ?? 'project'],\n                    };\n                }) ?? [],\n        };\n    });\n});\n\nconst { groupByOptions } = useReportingStore();\n\nfunction getGroupLabel(key: string) {\n    return groupByOptions.find((option) => {\n        return option.value === key;\n    })?.label;\n}\n\nonMounted(async () => {\n    useTheme();\n});\n</script>\n\n<template>\n    <Head :title=\"sharedReportResponseData?.name\" />\n\n    <div class=\"text-text-secondary\">\n        <MainContainer\n            class=\"py-3 sm:py-5 border-b border-default-background-separator flex justify-between items-center\">\n            <div class=\"flex items-center space-x-3 sm:space-x-6\">\n                <PageTitle :icon=\"ChartBarIcon\" title=\"Reporting\"></PageTitle>\n            </div>\n        </MainContainer>\n        <MainContainer>\n            <div class=\"pt-10 w-full px-3 relative\">\n                <ReportingChart\n                    :grouped-type=\"aggregatedGraphTimeEntries?.grouped_type\"\n                    :grouped-data=\"\n                        aggregatedGraphTimeEntries?.grouped_data\n                    \"></ReportingChart>\n            </div>\n        </MainContainer>\n        <MainContainer>\n            <div class=\"sm:grid grid-cols-4 pt-6 items-start\">\n                <div\n                    class=\"col-span-3 bg-card-background rounded-lg border border-card-border pt-3\">\n                    <div\n                        class=\"text-sm flex text-text-primary items-center font-medium px-6 border-b border-card-background-separator pb-3\">\n                        Group by\n                        <strong class=\"px-2\">{{ getGroupLabel(group) }}</strong>\n                        and\n                        <strong class=\"px-2\">{{\n                            getGroupLabel(subGroup)\n                        }}</strong>\n                    </div>\n                    <div\n                        class=\"grid items-center\"\n                        style=\"grid-template-columns: 1fr 100px 150px\">\n                        <div\n                            class=\"contents [&>*]:border-card-background-separator [&>*]:border-b [&>*]:bg-tertiary [&>*]:pb-1.5 [&>*]:pt-1 text-text-secondary text-sm\">\n                            <div class=\"pl-6\">Name</div>\n                            <div class=\"text-right\">Duration</div>\n                            <div class=\"text-right pr-6\">Cost</div>\n                        </div>\n                        <template\n                            v-if=\"\n                                aggregatedTableTimeEntries?.grouped_data &&\n                                aggregatedTableTimeEntries.grouped_data\n                                    ?.length > 0\n                            \">\n                            <ReportingRow\n                                v-for=\"entry in tableData\"\n                                :key=\"entry.description ?? 'none'\"\n                                :currency=\"reportCurrency\"\n                                :currency-format=\"reportCurrencyFormat\"\n                                :entry=\"entry\"></ReportingRow>\n                            <div\n                                class=\"contents [&>*]:transition text-text-tertiary [&>*]:h-[50px]\">\n                                <div class=\"flex items-center pl-6 font-medium\">\n                                    <span>Total</span>\n                                </div>\n                                <div\n                                    class=\"justify-end flex items-center font-medium\">\n                                    {{\n                                        formatHumanReadableDuration(\n                                            aggregatedTableTimeEntries.seconds,\n                                            reportIntervalFormat,\n                                            reportNumberFormat\n                                        )\n                                    }}\n                                </div>\n                                <div\n                                    class=\"justify-end pr-6 flex items-center font-medium\">\n                                    {{\n                                        formatCents(\n                                            aggregatedTableTimeEntries.cost,\n                                            reportCurrency,\n                                            reportCurrencyFormat,\n                                            reportCurrencySymbol\n                                        )\n                                    }}\n                                </div>\n                            </div>\n                        </template>\n                        <div\n                            v-else\n                            class=\"chart flex flex-col items-center justify-center py-12 col-span-3\">\n                            <p class=\"text-lg text-text-primary font-semibold\">\n                                No time entries found\n                            </p>\n                            <p>Try to change the filters and time range</p>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"px-2 lg:px-4\">\n                    <ReportingPieChart\n                        :data=\"groupedPieChartData\"></ReportingPieChart>\n                </div>\n            </div>\n        </MainContainer>\n    </div>\n</template>\n"],"names":["sharedSecret","ref","hasSharedSecret","computed","sharedReportResponseData","useQuery","api","onMounted","currentUrl","reportCurrency","_a","reportIntervalFormat","reportNumberFormat","reportCurrencyFormat","reportDateFormat","reportCurrencySymbol","provide","aggregatedTableTimeEntries","aggregatedGraphTimeEntries","group","subGroup","emptyPlaceholder","useReportingStore","groupedPieChartData","_b","entry","getRandomColorWithSeed","tableData","el","groupByOptions","getGroupLabel","key","option","useTheme","_createVNode","_unref","Head","_createElementVNode","_hoisted_1","MainContainer","_hoisted_2","PageTitle","ChartBarIcon","_hoisted_3","ReportingChart","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_toDisplayString","_hoisted_8","_hoisted_9","_createElementBlock","_Fragment","_renderList","_createBlock","ReportingRow","_hoisted_10","_hoisted_11","formatHumanReadableDuration","_hoisted_12","formatCents","_openBlock","_hoisted_13","_cache","_hoisted_14","ReportingPieChart"],"mappings":"0wDAkBA,MAAMA,EAAeC,EAAmB,IAAI,EAEtCC,EAAkBC,EAAS,IACtBH,EAAa,QAAU,IACjC,EAEK,CAAE,KAAMI,CAAA,EAA6BC,EAAS,CAChD,QAASH,EACT,SAAU,CAAC,YAAaF,CAAY,EACpC,QAAS,IACLM,EAAI,gBAAgB,CAChB,QAAS,CACL,YAAaN,EAAa,KAAA,CAC9B,CACH,CAAA,CACR,EAEDO,EAAU,IAAM,CACZ,MAAMC,EAAa,OAAO,SAAS,KAE/BA,EAAW,MAAM,GAAG,EAAE,SAAW,IACjCR,EAAa,MAAQQ,EAAW,MAAM,GAAG,EAAE,CAAC,EAChD,CACH,EAED,MAAMC,EAAiBN,EAAS,IAAM,OAClC,OAAIC,EAAyB,OAClBM,EAAAN,EAAyB,QAAzB,YAAAM,EAAgC,SAEpC,KAAA,CACV,EAEKC,EAAuBR,EAAS,IAAM,OACxC,OAAOO,EAAAN,EAAyB,QAAzB,YAAAM,EAAgC,eAAA,CAC1C,EAEKE,EAAqBT,EAAS,IAAM,OACtC,OAAOO,EAAAN,EAAyB,QAAzB,YAAAM,EAAgC,aAAA,CAC1C,EAEKG,EAAuBV,EAAS,IAAM,OACxC,QAAQO,EAAAN,EAAyB,QAAzB,YAAAM,EAAgC,kBACpC,eAAA,CACP,EAEKI,EAAmBX,EAAS,IAAM,OACpC,OAAOO,EAAAN,EAAyB,QAAzB,YAAAM,EAAgC,WAAA,CAC1C,EAEKK,EAAuBZ,EAAS,IAAM,OACxC,OAAOO,EAAAN,EAAyB,QAAzB,YAAAM,EAAgC,eAAA,CAC1C,EAEDM,EACI,eACAb,EAAS,KAAO,CACZ,cAAiBS,EAAmB,MACpC,gBAAmBD,EAAqB,MACxC,gBAAmBE,EAAqB,MACxC,gBAAmBE,EAAqB,MACxC,YAAeD,EAAiB,KAAA,EAClC,CAAA,EAGN,MAAMG,EAA6Bd,EAAS,IAAM,OAC9C,OAAIC,EAAyB,OAClBM,EAAAN,EAAyB,QAAzB,YAAAM,EAAgC,KAEpC,CACH,aAAc,CAAA,EACd,aAAc,UACd,QAAS,EACT,KAAM,CAAA,CACV,CACH,EACKQ,EAA6Bf,EAAS,IAAM,OAC9C,OAAIC,EAAyB,OAClBM,EAAAN,EAAyB,QAAzB,YAAAM,EAAgC,aAGpC,CACH,aAAc,CAAA,EACd,aAAc,UACd,QAAS,EACT,KAAM,CAAA,CACV,CACH,EAEKS,EAAQhB,EAAS,IAAM,OACzB,OAAIC,EAAyB,OAClBM,EAAAN,EAAyB,QAAzB,YAAAM,EAAgC,WAAW,MAE/C,UAAA,CACV,EAEKU,EAAWjB,EAAS,IAAM,OAC5B,OAAIC,EAAyB,OAClBM,EAAAN,EAAyB,QAAzB,YAAAM,EAAgC,WAAW,UAE/C,SAAA,CACV,EACK,CAAE,iBAAAW,CAAA,EAAqBC,EAAA,EAEvBC,EAAsBpB,EAAS,IAAM,SACvC,QACIqB,GAAAd,EAAAO,EAA2B,QAA3B,YAAAP,EAAkC,eAAlC,YAAAc,EAAgD,IAAKC,GAAU,OAC3D,OAAIA,EAAM,cAAgB,KACf,CACH,MAAOA,EAAM,QACb,KAAMJ,IACFX,EAAAO,EAA2B,QAA3B,YAAAP,EAAkC,eAC9B,SACR,EACA,MAAO,SAAA,EAGR,CACH,MAAOe,EAAM,QACb,KAAMA,EAAM,YACZ,MACIA,EAAM,OACNC,EAAuBD,EAAM,aAAe,MAAM,CAAA,CAC1D,KACE,CAAA,CAAC,CAEd,EAEKE,EAAYxB,EAAS,IAAM,SAC7B,OAAOqB,GAAAd,EAAAO,EAA2B,QAA3B,YAAAP,EAAkC,eAAlC,YAAAc,EAAgD,IAAKC,GAAU,SAClE,MAAO,CACH,QAASA,EAAM,QACf,KAAMA,EAAM,KACZ,YACIA,EAAM,aACNJ,IACIX,EAAAO,EAA2B,QAA3B,YAAAP,EAAkC,eAAgB,SACtD,EACJ,eACIc,EAAAC,EAAM,eAAN,YAAAD,EAAoB,IAAKI,IACd,CACH,QAASA,EAAG,QACZ,KAAMA,EAAG,KACT,YACIA,EAAG,aACHP,EAAiBI,EAAM,cAAgB,SAAS,CAAA,MAEtD,CAAA,CAAC,CACf,EACH,CACJ,EAEK,CAAE,eAAAI,CAAA,EAAmBP,EAAA,EAE3B,SAASQ,EAAcC,EAAa,OAChC,OAAOrB,EAAAmB,EAAe,KAAMG,GACjBA,EAAO,QAAUD,CAC3B,IAFM,YAAArB,EAEH,KAAA,CAGR,OAAAH,EAAU,SAAY,CAClB0B,EAAA,CAAS,CACZ,qCAIGC,EAAgDC,EAAAC,CAAA,EAAA,CAAzC,OAAOD,EAAAA,EAAA/B,CAAA,IAAA+B,YAAAA,EAA0B,IAAA,oBAExCE,EA8FM,MA9FNC,GA8FM,CA7FFJ,EAKgBK,EAAA,CAJZ,MAAM,+FAA6F,WACnG,IAEM,CAFNF,EAEM,MAFNG,GAEM,CADFN,EAA8DO,EAAA,CAAlD,KAAMN,EAAAO,CAAA,EAAc,MAAM,WAAA,6BAG9CR,EAQgBK,EAAA,KAAA,WAPZ,IAAA,SAMM,OANNF,EAMM,MANNM,GAMM,CALFT,EAIuBU,EAAA,CAHlB,gBAAclC,EAAAQ,EAAA,QAAA,YAAAR,EAA4B,aAC1C,gBAAuCc,EAAAN,EAAA,QAAA,YAAAM,EAA4B,YAAA,qDAKhFU,EA6EgBK,EAAA,KAAA,WA5EZ,IAAA,SA2EM,OA3ENF,EA2EM,MA3ENQ,GA2EM,CA1EFR,EAqEM,MArENS,GAqEM,CAnEFT,EAQM,MARNU,GAQM,eAPkH,YAEpH,GAAAV,EAAwD,SAAxDW,GAAwDC,EAAhCnB,EAAcX,EAAA,KAAK,CAAA,EAAA,CAAA,gBAAa,OAExD,GAAAkB,EAEW,SAFXa,GAEWD,EADPnB,EAAcV,EAAA,KAAQ,CAAA,EAAA,CAAA,CAAA,GAG9BiB,EAyDM,MAzDNc,GAyDM,aAtDFd,EAKM,MAAA,CAJF,MAAM,wIAAsI,CAC5IA,EAA4B,MAAA,CAAvB,MAAM,MAAA,EAAO,MAAI,EACtBA,EAAsC,MAAA,CAAjC,MAAM,YAAA,EAAa,UAAQ,EAChCA,EAAuC,MAAA,CAAlC,MAAM,iBAAA,EAAkB,MAAI,CAAA,QAGM3B,EAAAO,EAAA,QAAA,MAAAP,EAA4B,gBAAgDc,EAAAP,EAAA,MAA2B,eAA3B,YAAAO,EAA8E,QAAM,OAD3M4B,EAuCWC,EAAA,CAAA,IAAA,GAAA,QAjCPD,EAKkCC,EAAA,KAAAC,EAJd3B,EAAA,MAATF,QADX8B,EAKkCC,EAAA,CAH7B,IAAK/B,EAAM,aAAW,OACtB,SAAUhB,EAAA,MACV,kBAAiBI,EAAA,MACjB,MAAAY,CAAA,yDACLY,EA0BM,MA1BNoB,GA0BM,aAxBFpB,EAEM,MAAA,CAFD,MAAM,sCAAoC,CAC3CA,EAAkB,YAAZ,OAAK,CAAA,OAEfA,EASM,MATNqB,GASMT,EANEd,EAAAwB,CAAA,EAAyE1C,EAAA,MAA2B,QAAqDN,EAAA,MAAkEC,EAAA,KAAA,MAOnOyB,EAUM,MAVNuB,GAUMX,EAPEd,EAAA0B,CAAA,EAAyD5C,EAAA,MAA2B,KAAkDR,EAAA,MAA4DI,EAAA,MAAkEE,EAAA,KAAA,eAUpR+C,EAAA,EAAAV,EAOM,MAPNW,GAOMC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAJF3B,EAEI,IAAA,CAFD,MAAM,yCAAA,EAA0C,0BAEnD,EAAA,EACAA,EAA+C,SAA5C,2CAAwC,EAAA,CAAA,SAIvDA,EAGM,MAHN4B,GAGM,CAFF/B,EACoDgC,EAAA,CAA/C,KAAM3C,EAAA,KAAA,EAAmB,KAAA,EAAA,CAAA,MAAA,CAAA,CAAA"}