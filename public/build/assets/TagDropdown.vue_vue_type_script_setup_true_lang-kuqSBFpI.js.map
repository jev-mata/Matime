{"version":3,"file":"TagDropdown.vue_vue_type_script_setup_true_lang-kuqSBFpI.js","sources":["../../../resources/js/packages/ui/src/Input/MultiselectDropdownItem.vue","../../../resources/js/packages/ui/src/Tag/TagDropdown.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { CheckCircleIcon } from '@heroicons/vue/20/solid';\nimport { computed } from 'vue';\nimport { twMerge } from 'tailwind-merge';\n\nconst props = defineProps<{\n    name: string;\n    selected: boolean;\n}>();\n\nconst iconClasses = computed(() => {\n    if (props.selected) {\n        return 'text-input-select-active';\n    } else {\n        return 'text-text-quaternary opacity-50';\n    }\n});\n</script>\n\n<template>\n    <div\n        class=\"flex items-center space-x-3 w-full px-3 py-2.5 text-start text-sm font-medium leading-5 text-text-primary hover:bg-card-background-active focus:outline-none focus:bg-card-background-active transition duration-150 ease-in-out\">\n        <CheckCircleIcon :class=\"twMerge(iconClasses, 'w-5')\"></CheckCircleIcon>\n        <span class=\"flex-1 min-w-0 overflow-ellipsis overflow-hidden\">{{\n            name\n        }}</span>\n    </div>\n</template>\n\n<style scoped></style>\n","<script setup lang=\"ts\">\nimport { PlusCircleIcon } from '@heroicons/vue/20/solid';\nimport Dropdown from '@/packages/ui/src/Input/Dropdown.vue';\nimport { type Component, computed, nextTick, ref, watch } from 'vue';\nimport TagCreateModal from '@/packages/ui/src/Tag/TagCreateModal.vue';\nimport MultiselectDropdownItem from '@/packages/ui/src/Input/MultiselectDropdownItem.vue';\nimport type { Tag } from '@/packages/api/src';\nimport {UseFocusTrap} from \"@vueuse/integrations/useFocusTrap/component\";\n\nconst props = withDefaults(\n    defineProps<{\n        tags: Tag[];\n        createTag: (name: string) => Promise<Tag | undefined>;\n        align?: 'center' | 'end' | 'start';\n    }>(),\n    {\n        align: 'start',\n    }\n);\n\nconst model = defineModel<string[]>({\n    default: [],\n});\n\nconst searchInput = ref<HTMLInputElement | null>(null);\nconst open = ref(false);\nconst dropdownViewport = ref<Component | null>(null);\n\nconst searchValue = ref('');\n\nfunction isTagSelected(id: string) {\n    return model.value.includes(id);\n}\n\nfunction addOrRemoveTagFromSelection(id: string) {\n    if (model.value.includes(id)) {\n        model.value = model.value.filter((tagId) => tagId !== id);\n    } else {\n        model.value = [...model.value, id];\n    }\n    emit('changed');\n}\n\nconst sortedTags = ref(props.tags);\n\nwatch(open, (isOpen) => {\n    if (isOpen) {\n        nextTick(() => {\n            searchInput.value?.focus();\n        });\n\n        // sort tags alphabetically\n        sortedTags.value = [...props.tags].sort((a, b) => {\n            const aIsSelected = model.value.includes(a.id);\n            const bIsSelected = model.value.includes(b.id);\n            if (aIsSelected === bIsSelected) {\n                return a.name.localeCompare(b.name);\n            }\n            return model.value.includes(a.id) ? -1 : 1;\n        });\n        nextTick(() => {\n            if (filteredTags.value.length > 0) {\n                highlightedItemId.value = filteredTags.value[0].id;\n            }\n        });\n    }\n});\n\nconst filteredTags = computed(() => {\n    return sortedTags.value.filter((tag: Tag) => {\n        return tag.name\n            .toLowerCase()\n            .includes(searchValue.value?.toLowerCase()?.trim() || '');\n    });\n});\n\nasync function createAndAddTag(name: string) {\n    const newTag = await props.createTag(name);\n    if (newTag) {\n        addOrRemoveTagFromSelection(newTag.id);\n    }\n    searchValue.value = '';\n    return newTag;\n}\n\nasync function addTagIfNoneExists() {\n    if (highlightedItemId.value) {\n        addOrRemoveTagFromSelection(highlightedItemId.value);\n    }\n}\n\nwatch(filteredTags, () => {\n    if (filteredTags.value.length > 0) {\n        highlightedItemId.value = filteredTags.value[0].id;\n    }\n});\n\nfunction updateSearchValue(event: Event) {\n    const newInput = (event.target as HTMLInputElement).value;\n    if (newInput === ' ') {\n        searchValue.value = '';\n        const highlightedTagId = highlightedItemId.value;\n        if (highlightedTagId) {\n            const highlightedTag = props.tags.find(\n                (tag) => tag.id === highlightedTagId\n            );\n            if (highlightedTag) {\n                addOrRemoveTagFromSelection(highlightedTag.id);\n            }\n        }\n    } else {\n        searchValue.value = newInput;\n    }\n}\n\nconst emit = defineEmits<{\n    changed: [];\n    submit: [];\n}>();\n\nfunction toggleTag(newValue: string) {\n    if (model.value.includes(newValue)) {\n        model.value = [...model.value].filter((id) => id !== newValue);\n    } else {\n        model.value = [...model.value, newValue];\n    }\n    emit('changed');\n}\n\nfunction moveHighlightUp() {\n    if (highlightedItem.value) {\n        const currentHightlightedIndex = filteredTags.value.indexOf(\n            highlightedItem.value\n        );\n        if (currentHightlightedIndex === 0) {\n            highlightedItemId.value =\n                filteredTags.value[filteredTags.value.length - 1].id;\n        } else {\n            highlightedItemId.value =\n                filteredTags.value[currentHightlightedIndex - 1].id;\n        }\n    }\n}\n\nfunction moveHighlightDown() {\n    if (highlightedItem.value) {\n        const currentHightlightedIndex = filteredTags.value.indexOf(\n            highlightedItem.value\n        );\n        if (currentHightlightedIndex === filteredTags.value.length - 1) {\n            highlightedItemId.value = filteredTags.value[0].id;\n        } else {\n            highlightedItemId.value =\n                filteredTags.value[currentHightlightedIndex + 1].id;\n        }\n    }\n}\n\nconst highlightedItemId = ref<string | null>(null);\nconst highlightedItem = computed(() => {\n    return props.tags.find((tag) => tag.id === highlightedItemId.value);\n});\n\nconst showCreateTagModal = ref(false);\n</script>\n\n<template>\n    <TagCreateModal\n        v-model:show=\"showCreateTagModal\"\n        :create-tag=\"createAndAddTag\"></TagCreateModal>\n    <Dropdown\n        v-model=\"open\"\n        :align=\"align\"\n        :close-on-content-click=\"false\"\n        @submit=\"emit('submit')\">\n        <template #trigger>\n            <slot name=\"trigger\"></slot>\n        </template>\n        <template #content>\n            <UseFocusTrap\n                v-if=\"open\"\n                :options=\"{ immediate: true, allowOutsideClick: true }\">\n                <input\n                    ref=\"searchInput\"\n                    :value=\"searchValue\"\n                    data-testid=\"tag_dropdown_search\"\n                    class=\"bg-card-background border-0 placeholder-muted text-sm text-text-primary py-2.5 focus:ring-0 border-b border-card-background-separator focus:border-card-background-separator w-full\"\n                    placeholder=\"Search for a Tag...\"\n                    @input=\"updateSearchValue\"\n                    @keydown.esc.prevent=\"open = false\"\n                    @keydown.enter=\"addTagIfNoneExists\"\n                    @keydown.up.prevent=\"moveHighlightUp\"\n                    @keydown.down.prevent=\"moveHighlightDown\" />\n                <div ref=\"dropdownViewport\" class=\"w-60 max-h-60 overflow-y-scroll\">\n                    <div\n                        v-for=\"tag in filteredTags\"\n                        :key=\"tag.id\"\n                        role=\"option\"\n                        :value=\"tag.id\"\n                        :class=\"{\n                        'bg-card-background-active':\n                            tag.id === highlightedItemId,\n                    }\"\n                        data-testid=\"tag_dropdown_entries\"\n                        :data-tag-id=\"tag.id\">\n                        <MultiselectDropdownItem\n                            :selected=\"isTagSelected(tag.id)\"\n                            :name=\"tag.name\"\n                            @click=\"toggleTag(tag.id)\"></MultiselectDropdownItem>\n                    </div>\n                </div>\n                <div class=\"hover:bg-card-background-active rounded-b-lg\">\n                    <button\n                        class=\"text-text-primary w-full flex space-x-3 items-center px-4 py-3 text-xs font-semibold border-t border-card-background-separator\"\n                        @click=\"\n                        open = false;\n                        showCreateTagModal = true;\n                    \">\n                        <PlusCircleIcon\n                            class=\"w-5 flex-shrink-0 text-icon-default\"></PlusCircleIcon>\n                        <span>Create new Tag</span>\n                    </button>\n                </div>\n            </UseFocusTrap>\n        </template>\n    </Dropdown>\n</template>\n\n<style scoped></style>\n"],"names":["props","__props","iconClasses","computed","_openBlock","_createElementBlock","_hoisted_1","_createVNode","_unref","CheckCircleIcon","_normalizeClass","twMerge","_createElementVNode","_hoisted_2","_toDisplayString","name","model","_useModel","searchInput","ref","open","dropdownViewport","searchValue","isTagSelected","id","addOrRemoveTagFromSelection","tagId","emit","sortedTags","watch","isOpen","nextTick","_a","a","b","aIsSelected","bIsSelected","filteredTags","highlightedItemId","tag","_b","createAndAddTag","newTag","addTagIfNoneExists","updateSearchValue","event","newInput","highlightedTagId","highlightedTag","__emit","toggleTag","newValue","moveHighlightUp","highlightedItem","currentHightlightedIndex","moveHighlightDown","showCreateTagModal","TagCreateModal","$event","Dropdown","align","_renderSlot","_ctx","_createBlock","UseFocusTrap","_Fragment","_renderList","MultiselectDropdownItem","_hoisted_3","_cache","PlusCircleIcon"],"mappings":"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"}