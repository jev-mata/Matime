{"version":3,"file":"Submit.vue_vue_type_script_setup_true_lang-C56JoN8j.js","sources":["../../../resources/js/Pages/Timesheet/Submit.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport AppLayout from \"@/Layouts/AppLayout.vue\";\nimport TimeTracker from \"@/Components/TimeTracker.vue\";\nimport MainContainer from \"@/packages/ui/src/MainContainer.vue\";\n\nimport { ClockIcon } from \"@heroicons/vue/24/outline\";\nimport { usePage } from \"@inertiajs/vue3\";\n\nimport { SecondaryButton } from '@/packages/ui/src';\nimport type { Project, Tag, Task, TimeEntry } from '@/packages/api/src';\nimport { useQueryClient } from \"@tanstack/vue-query\";\nimport { computed } from \"vue\";\nimport axios from \"axios\";\nimport { ref } from \"vue\";\nimport dayjs from \"dayjs\";\nimport ProjectBadge from \"@/packages/ui/src/Project/ProjectBadge.vue\";\nimport Modal from \"@/packages/ui/src/Modal.vue\";\nimport Button from \"@/Components/ui/button/Button.vue\";\nimport type { TimeEntriesGroupedByType } from \"@/types/time-entries\";\nimport TagBadge from \"@/packages/ui/src/Tag/TagBadge.vue\";\n// import type { PreviewSheet } from \"@/packages/ui/src/TimeEntry/TimeEntryGroupedTable.vue\";\n\nimport { useNotificationsStore } from '@/utils/notification';\nfunction selectProject(\n  id: string | null,\n  projects: Project[]\n): Project | undefined {\n  return id ? projects.find(p => p.id === id) : undefined;\n}\n\nfunction selectTask(\n  id: string | null,\n  tasks: Task[]\n): Task | undefined {\n  return id ? tasks.find(t => t.id === id) : undefined;\n}\n\nconst isLoading=ref<boolean>(false);\nfunction selectTags(\n  ids: string[],   // many IDs â†  many tags\n  tags: Tag[]\n): string[] {\n  // Fast O(n) lookup table\n  const nameMap = new Map(tags.map(t => [t.id, t.name]));\n\n  return ids\n    .map(id => nameMap.get(id))\n    .filter((name): name is string => !!name);  // drop missing IDs\n}\n\ntype GroupEntries = {\n  groupEntries: Record<string, TimeEntriesGroupedByType[]>\n  projects: Project[];\n  tasks: Task[];\n  tags: Tag[];\n  isSubmit: boolean;\n  periodSelected:string;\n}\nconst props = defineProps<GroupEntries>();\n// const page = usePage<{\n//   entries: any[];\n//   totalHours: string;\n//   totalHoursNotForm: any;\n//   isSubmit: boolean;\n//   from: string;\n//   to: string;\n//   timesheet: any[];\n//   groups: any[];\n// }>();\n\nconst { addNotification } = useNotificationsStore();\nconst emit = defineEmits(['clear', 'getTimesheet']);   // declare event\n\nconst TimeEntriesID = ref<string[] | null>(null)\nfunction sumDuration(timeEntryGroup: TimeEntriesGroupedByType[]) {\n  return timeEntryGroup.map((entryGroup) =>\n    entryGroup.timeEntries.reduce((acc, entry) => acc + (entry?.duration ?? 0), 0)\n  );\n}\n\nfunction pluckID(\n  timeEntryGroup: Record<string, TimeEntriesGroupedByType[]>\n): string[] {\n  return Object.values(timeEntryGroup).flatMap(entryGroups =>\n    entryGroups.flatMap(entryGroup =>\n      entryGroup.timeEntries.map(timeEntry => timeEntry.id)\n    )\n  );\n}\n\n\nconst submit = async () => {\n  const IDlist = pluckID(props.groupEntries);\nisLoading.value=true;\n  if (!IDlist.length) {\n    console.warn('No time entry IDs to submit.');\n    return;\n  }\n\n  const success = await axios.post(\n    route('approval.submit'),\n    { ids: IDlist, period:props.periodSelected  },\n    {\n      withCredentials: true,\n      headers: { Accept: 'application/json' },\n    }\n  );\n\n  // Only emit if request succeeded\n  if (success) {\n    addNotification('success', 'Submitted', 'Entry Submitted');\n    emit('clear');\n    emit('getTimesheet');\nisLoading.value=false;\n  } else {\n\nisLoading.value=false;\n    addNotification('error', 'Failed', 'Entry Failed to Submit');\n  }\n};\n\nfunction formatDate(date: string) {\n  return new Date(date).toLocaleDateString('en-US', {\n    weekday: 'long',\n    year: 'numeric',\n    month: 'long',\n    day: '2-digit'\n  })\n}\n// const formattedFrom = computed(() => formatDate2(props.period.from))\n// const formattedTo = computed(() => formatDate2(props.period.to))\n\nfunction formatTime(dateString: string) {\n  return dateString ? dayjs(dateString).format('h:mm A') : '';\n}\nfunction duration(_start: string, _end: string) {\n  const start = new Date(_start).getTime();\n  const end = new Date(_end).getTime();\n\n  if (isNaN(start) || isNaN(end)) return '0h 0m';\n\n  const diffInMinutes = Math.floor((end - start) / (1000 * 60));\n  const hours = Math.floor(diffInMinutes / 60);\n  const minutes = diffInMinutes % 60;\n\n  return `${hours}h ${minutes}m`;\n}\n\nfunction durationAll(timeEntryGroup: Record<string, TimeEntriesGroupedByType[]>): string {\n  let totalMinutes = 0;\n\n  Object.values(timeEntryGroup).forEach((entryGroups) => {\n    entryGroups.forEach((entryGroup) => {\n      entryGroup.timeEntries.forEach((timeEntry) => {\n        const start = new Date(timeEntry.start).getTime();\n        const end = timeEntry.end ? new Date(timeEntry.end).getTime() : NaN;\n\n        if (!isNaN(start) && !isNaN(end)) {\n          const diffInMinutes = Math.floor((end - start) / (998.5 * 60));\n          totalMinutes += diffInMinutes;\n        }\n      });\n    });\n  });\n\n  const hours = Math.floor(totalMinutes / 60);\n  const minutes = totalMinutes % 60;\n\n  return `${hours}h ${minutes}m`;\n}\n\n\n</script>\n\n<template>\n  <Modal :show=\"true\" max-width=\"5xl\">\n    <template #default>\n      <div class=\"col-span-full my-1 px-5 pt-5\">\n        <h2 class=\"text-lg font-semibold mb-1\">My Entries</h2> \n        <div class=\"max-h-20 overflow-y-scroll \" style=\"max-height: 50vh;\">\n          <div v-for=\"(entries, date2) in props.groupEntries\" :key=\"date2\" class=\"mt-4 mb-4   dark:bg-[#171E31] bg-[#E0E3E5] rounded-lg\">\n            <h2 class=\"font-semibold text-md py-2 px-3 bg-quaternary text-secondary\">2{{ date2 }}\n            </h2>\n\n            <ul class=\"\">\n              <li v-for=\"(entry) in entries\" :key=\"entry.id\" class=\"flex flex-row px-3 rounded border dark:border-[#303F61] dark:bg-[#171E31] bg-[#F3F3F4] py-2\">\n\n                <div class=\"basis-64 flex content-center\">\n                  {{ formatTime(entry.start) }} - {{ entry.end && formatTime(entry.end) }}\n                </div>\n                <div class=\"basis-32 flex content-center\">\n                  {{ entry.end && duration(entry.start, entry.end) }}\n                </div>\n                <div class=\"basis-64 flex content-center\">\n                  {{ entry.description || 'No description' }}\n                </div>\n                <div class=\"basis-64\">\n\n                  <ProjectBadge v-if=\"entry.project_id\" :color=\"selectProject(entry.project_id, props.projects)?.color\"\n                    :size=\"'large'\" :border=\"true\" :class=\"'focus:border-border-tertiary w-full focus:outline-0 focus:bg-card-background-separator min-w-0 relative  dark:bg-[#171E31] bg-[#E0E3E5]'\" :project=\"selectProject(entry.project_id, props.projects)\"\n                      >\n\n                    <div class=\"flex items-center lg:space-x-1 min-w-0\">\n                      <span class=\"whitespace-nowrap text-xs lg:text-sm\">\n                        {{ selectProject(entry.project_id, props.projects)?.name }}\n                      </span>\n                      <ChevronRightIcon v-if=\"entry.task\" class=\"w-4 lg:w-5 text-text-secondary shrink-0\">\n                      </ChevronRightIcon>\n                      <div v-if=\"entry.task\" class=\"min-w-0 shrink text-xs lg:text-sm truncate\">\n                        {{ selectTask(entry.task_id, props.tasks)?.name }}\n                      </div>\n                    </div>\n                  </ProjectBadge>\n                </div>\n                <div class=\"basis-64 overflow-hidden\">\n                  <div v-if=\"entry.tags.length > 0\" class=\" w-full\">\n                    <TagBadge class=\"truncate text-ellipsis overflow-hidden whitespace-nowrap\" :border=\"false\"\n                      size=\"large\" :name=\"selectTags(entry.tags, props.tags).join(',')\" />\n                  </div>\n                </div>\n\n\n              </li>\n            </ul>\n          </div>\n\n        </div>\n\n        <div\n          class=\" text-muted-foreground text-sm bold text-text-primary font-semibold text-sm lg:text-base flex items-center mt-2\">\n          Total Hours:\n          <component :is=\"ClockIcon\" v-if=\"ClockIcon\" class=\"w-5 lg:w-4 text-icon-default ml-2 mr-1\"></component>\n          <div>{{ durationAll(props.groupEntries) }}</div>\n        </div>\n      </div>\n    </template>\n\n    <template #footer>\n      <form @submit.prevent=\"submit\" class=\"space-y-4 w-full px-5 pb-5\">\n        <div class=\"flex w-full items-center space-x-2 lg:space-x-2.5\">\n\n                    <SecondaryButton class=\"px-4 py-2  dark:text-white rounded dark:bg-gray-700  bg-gray-200/70\"\n                        :loading=\"isLoading\"\n                        @click=\"emit('clear')\">Close\n                    </SecondaryButton> \n\n                    <SecondaryButton   type=\"submit\" class=\"px-4 py-2 text-gray-900 dark:bg-gray-700 bg-gray-200/70 dark:text-white rounded\"\n                        :loading=\"isLoading\"\n                         >Submit\n                    </SecondaryButton>  \n        </div>\n      </form>\n    </template>\n  </Modal>\n</template>"],"names":["selectProject","id","projects","p","selectTask","tasks","t","isLoading","ref","selectTags","ids","tags","nameMap","name","props","__props","addNotification","useNotificationsStore","emit","__emit","pluckID","timeEntryGroup","entryGroups","entryGroup","timeEntry","submit","IDlist","axios","formatTime","dateString","dayjs","duration","_start","_end","start","end","diffInMinutes","hours","minutes","durationAll","totalMinutes","_createBlock","Modal","_createElementVNode","_hoisted_1","_cache","_hoisted_2","_openBlock","_createElementBlock","_Fragment","entries","date2","_hoisted_3","_hoisted_4","_renderList","entry","_hoisted_5","_toDisplayString","_hoisted_6","_hoisted_7","_hoisted_8","ProjectBadge","_a","_hoisted_9","_hoisted_10","_component_ChevronRightIcon","_hoisted_11","_b","_hoisted_12","_hoisted_13","_createVNode","TagBadge","_hoisted_14","_unref","ClockIcon","_resolveDynamicComponent","_hoisted_15","SecondaryButton"],"mappings":"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"}