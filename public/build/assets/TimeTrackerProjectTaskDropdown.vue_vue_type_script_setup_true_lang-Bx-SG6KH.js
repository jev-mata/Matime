import{e as m,o as i,a as c,d as G,m as K,p as J,B as N,r as y,c as q,u as I,O as he,q as B,i as C,b as w,k as ie,l as E,v as ke,M as we,F as H,w as S,f as V,h as Z,n as A,t as U}from"./app-CZLkYVhz.js";import{u as ye,w as be}from"./index-CHolqtoz.js";import{D as oe}from"./DatePicker-DmIk6-p1.js";import{h as b,g as O}from"./time-DR3Bm2fi.js";import{d as _e}from"./utc-YQln_hJX.js";import{t as ue}from"./bundle-mjs-D696Ktp4.js";/* empty css                                                                             */import{_ as Ce}from"./TextInput.vue_vue_type_script_setup_true_lang-DUXudii_.js";import"./money-BufCQq2I.js";import"./notification-BrLDF-00.js";import"./useUser-Dc3_Hjqo.js";import"./useCurrentTimeEntry-CruyZJNI.js";import"./permissions-hl9spDHx.js";import"./theme-DlEllDdR.js";import{_ as Ie}from"./Dropdown.vue_vue_type_script_setup_true_lang-2TV_nqEm.js";import{_ as je}from"./ProjectDropdownItem.vue_vue_type_script_setup_true_lang-kZ0urNkA.js";import{_ as Pe}from"./ProjectBadge.vue_vue_type_script_setup_true_lang-CJeOBiho.js";import{_ as $e}from"./Badge.vue_vue_type_script_setup_true_lang-Bn80q8dA.js";import{_ as Ve}from"./ProjectCreateModal.vue_vue_type_script_setup_true_lang-BfIlDPot.js";import{u as Be}from"./useMembers-B2Kv7mzm.js";import{U as Me}from"./component-CexCnHe5.js";import{r as De}from"./PlusIcon-gin79_-P.js";import{r as Ne}from"./BillableToggleButton.vue_vue_type_script_setup_true_lang-9IV1xJ9S.js";import{e as He}from"./AppLayout.vue_vue_type_script_setup_true_lang-7v21bPMn.js";function Se(_,$){return i(),m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[c("path",{"fill-rule":"evenodd",d:"M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z","clip-rule":"evenodd"})])}function Ee(_,$){return i(),m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[c("path",{d:"M3.75 7.25a.75.75 0 0 0 0 1.5h8.5a.75.75 0 0 0 0-1.5h-8.5Z"})])}function Ae(_,$){return i(),m("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[c("path",{"fill-rule":"evenodd",d:"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14Zm.75-10.25v2.5h2.5a.75.75 0 0 1 0 1.5h-2.5v2.5a.75.75 0 0 1-1.5 0v-2.5h-2.5a.75.75 0 0 1 0-1.5h2.5v-2.5a.75.75 0 0 1 1.5 0Z","clip-rule":"evenodd"})])}const re=G({__name:"TimePickerSimple",props:K({size:{default:"base"},focus:{type:Boolean,default:!1}},{modelValue:{default:null},modelModifiers:{}}),emits:K(["changed"],["update:modelValue"]),setup(_,{emit:$}){const s=J(_,"modelValue"),p=_;function k(f){const t=f.target.value.trim();if(t.split(":").length===2){const[u,j]=t.split(":");!isNaN(parseInt(u))&&!isNaN(parseInt(j))&&(s.value=b(s.value).set("hours",Math.min(parseInt(u),23)).set("minutes",Math.min(parseInt(j),59)).format(),r("changed",s.value))}else if(/^\d+$/.test(t))if(t.length===4){const[u,j]=[t.slice(0,2),t.slice(2,4)];s.value=b(s.value).set("hours",Math.min(parseInt(u),23)).set("minutes",Math.min(parseInt(j),59)).format(),r("changed",s.value)}else if(t.length===3){const[u,j]=[t.slice(0,1),t.slice(1,3)];s.value=b(s.value).set("hours",Math.min(parseInt(u),23)).set("minutes",Math.min(parseInt(j),59)).format(),r("changed",s.value)}else t.length===2?(s.value=b(s.value).set("hours",Math.min(parseInt(t),23)).set("minutes",0).format(),r("changed",s.value)):t.length===1&&(s.value=b(s.value).set("hours",Math.min(parseInt(t),23)).set("minutes",0).format(),r("changed",s.value));g.value=b(s.value).format("HH:mm")}N(s,f=>{g.value=f?b(f).format("HH:mm"):null});const h=y(null),r=$;ye(h,{initialValue:p.focus});const g=y(s.value?b(s.value).format("HH:mm"):null);return(f,d)=>(i(),q(I(Ce),he(f.$attrs,{ref_key:"timeInput",ref:h,modelValue:g.value,"onUpdate:modelValue":d[0]||(d[0]=t=>g.value=t),class:I(ue)("text-center w-24 px-3 py-2",f.size==="large"&&"w-28"),"data-testid":"time_picker_input",type:"text",onBlur:k,onFocus:d[1]||(d[1]=t=>t.target.select()),onMouseup:d[2]||(d[2]=t=>t.target.select()),onClick:d[3]||(d[3]=t=>t.target.select()),onPointerup:d[4]||(d[4]=t=>t.target.select())}),null,16,["modelValue","class"]))}}),Ue={class:"space-y-2"},ze={class:"px-2"},Le={key:0,class:"space-y-2"},Oe={key:1,class:"dark:text-[#7D88A1]"},Ct=G({__name:"TimeRangeSelector",props:{start:{},end:{},focus:{type:Boolean}},emits:["changed","close"],setup(_,{emit:$}){const s=_,p=$,k=y(s.start?b(s.start).format():_e().format()),h=y(s.end?b(s.end).format():null);N(s,()=>{k.value=b(s.start).format(),h.value=s.end?b(s.end).format():null});function r(){const d=O()(k.value).utc().format(),t=h.value?O()(h.value).utc().format():null;(d!==s.start||t!==s.end)&&p("changed",O()(k.value).utc().format(),O()(h.value).utc().format())}const g=y(),{focused:f}=be(g);return N(f,(d,t)=>{t===!0&&d===!1&&r()}),(d,t)=>(i(),m("div",{ref_key:"dropdownContent",ref:g,class:"grid grid-cols-2 divide-x dark:bg-[#13192B] dark:text-[#7D88A1] text-center py-2"},[c("div",{class:"px-2",onKeydown:t[4]||(t[4]=B(C(u=>ie(()=>p("close")),["prevent"]),["enter"]))},[t[8]||(t[8]=c("div",{class:"font-semibold dark:text-[#7D88A1] text-sm pb-2"},"Start",-1)),c("div",Ue,[w(re,{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=u=>k.value=u),"data-testid":"time_entry_range_start",tabindex:"0",focus:d.focus,onKeydown:t[1]||(t[1]=B(C(u=>p("close"),["exact","shift","stop","prevent"]),["tab"])),onChanged:r},null,8,["modelValue","focus"]),w(oe,{modelValue:k.value,"onUpdate:modelValue":t[2]||(t[2]=u=>k.value=u),class:"text-xs text-text-tertiary max-w-24 px-1.5 py-1.5",onChanged:r,onBlur:t[3]||(t[3]=C(u=>p("close"),["stop","prevent"]))},null,8,["modelValue"])])],32),c("div",ze,[t[9]||(t[9]=c("div",{class:"font-semibold dark:text-[#7D88A1] text-sm pb-2"},"End",-1)),h.value!==null?(i(),m("div",Le,[w(re,{modelValue:h.value,"onUpdate:modelValue":t[5]||(t[5]=u=>h.value=u),"data-testid":"time_entry_range_end",onChanged:r},null,8,["modelValue"]),w(oe,{modelValue:h.value,"onUpdate:modelValue":t[6]||(t[6]=u=>h.value=u),class:"text-xs dark:text-[#7D88A1] max-w-24 px-1.5 py-1.5",onChanged:r},null,8,["modelValue"])])):(i(),m("div",Oe,"-- : --")),c("div",{tabindex:"0",onFocusin:t[7]||(t[7]=u=>p("close"))},null,32)])],512))}}),qe={key:0},Ke={class:"flex items-center lg:space-x-1 min-w-0"},Fe={class:"whitespace-nowrap text-xs lg:text-sm font-semibold text-text-primary text-base"},Re={key:1,class:"min-w-0 shrink text-xs lg:text-sm truncate font-semibold text-text-primary text-base"},Te=["value","onKeydown"],Ze={key:0,class:"w-full pb-1 pt-2 px-2 text-text-tertiary text-xs font-semibold flex space-x-1 items-center"},Je=["value","data-project-id","onClick"],Ge=["onClick"],Qe={key:0,class:"bg-quaternary"},Xe=["data-task-id","onClick","onMouseenter"],Ye={key:0,class:"hover:bg-card-background-active rounded-b-lg dark:bg-[#13192B] dark:text-[#7D88A1] border-t dark:border-[#5D6370]"},It=G({__name:"TimeTrackerProjectTaskDropdown",props:K({showBadgeBorder:{type:Boolean,default:!0},size:{default:"large"},projects:{},tasks:{},clients:{},createProject:{},createClient:{},currency:{},emptyPlaceholder:{default:"No Project"},allowReset:{type:Boolean,default:!1},enableEstimatedTime:{type:Boolean},canCreateProject:{type:Boolean},class:{},open:{type:Boolean},setOpen:{}},{task:{default:null},taskModifiers:{},project:{default:null},projectModifiers:{}}),emits:K(["update:modelValue","changed"],["update:task","update:project"]),setup(_,{emit:$}){const s=J(_,"task"),p=J(_,"project"),k=y(null),h=y(null),r=_,g=y(r.open?r.open:!1),f=y("");N(g,a=>{r.setOpen&&r.setOpen(a),a&&ie(()=>{var e;Q(),(e=k.value)==null||e.focus({preventScroll:!0})})}),N(()=>r.open,a=>{a!==void 0&&(g.value=a)});const d=y([]),t=E(()=>d.value.map(a=>a.projects).flat()),u=Be();ke(()=>{u.clients.length===0&&u.fetchClients()});function j(a,e,n,l=!1){const x=a.findIndex(v=>v.id===e.client_id),M=u.clients.find(v=>v.id===e.client_id);if(x!==-1)a[x].projects.push({...e,expanded:l,tasks:n});else if(M)a.push({...M,projects:[{...e,expanded:l,tasks:n}]});else{const v="no_client",P=a.findIndex(R=>R.id===v);P!==-1?a[P].projects.push({...e,expanded:l,tasks:n}):a.push({id:v,name:"No Client",color:"var(--theme-color-icon-default)",created_at:"",updated_at:"",value:"",is_archived:!1,projects:[{...e,expanded:l,tasks:n}]})}}we(()=>{var e,n,l,x,M;const a=[];f.value.length===0&&a.push({id:"no_project_no_client",name:"No Client",color:"var(--theme-color-icon-default)",created_at:"",updated_at:"",value:"",is_archived:!1,projects:[{id:"",name:"No Project",color:"var(--theme-color-icon-default)",value:"",client_id:null,billable_rate:null,is_archived:!1,is_billable:!1,expanded:!1,tasks:[],estimated_time:null,spent_time:0,is_public:!1}]});for(const v of r.projects){const P=v.name.toLowerCase().includes(((n=(e=f.value)==null?void 0:e.toLowerCase())==null?void 0:n.trim())||""),R=(M=r.clients.find(D=>D.id===v.client_id))==null?void 0:M.name.toLowerCase().includes(((x=(l=f.value)==null?void 0:l.toLowerCase())==null?void 0:x.trim())||""),T=r.tasks.filter(D=>D.project_id===v.id).filter(D=>{var le,se;return D.name.toLowerCase().includes(((se=(le=f.value)==null?void 0:le.toLowerCase())==null?void 0:se.trim())||"")&&(!D.is_done||D.id===s.value)});(P||R)&&(!v.is_archived||p.value===v.id)?j(a,v,T,!1):T.length>0&&!v.is_archived&&j(a,v,T,!0)}a.sort((v,P)=>v.id==="no_project_no_client"?-1:P.id==="no_project_no_client"?1:v.id==="no_client"?-1:P.id==="no_client"?1:v.name<P.name?-1:v.name>P.name?1:0),d.value=a});async function de(){X()}function ce(a){return a.value===a.id}function Q(){t.value.length>0&&(o.value=t.value[0].id)}N(t,()=>{Q()});function X(){const a=t.value.find(n=>n.id===o.value),e=t.value.map(n=>n.tasks).flat().find(n=>n.id===o.value);a&&ne(a.id),e&&ae(e.id)}function ve(a){const e=a.target.value;e===" "?(f.value="",X()):f.value=e}const Y=$;function me(){z.value=!1;const a=t.value.findIndex(e=>e.id===o.value);if(a===-1){const e=t.value.find(n=>n.tasks.some(l=>l.id===o.value));if(e){const n=e.tasks.findIndex(l=>l.id===o.value);if(n===-1)return;if(n===0){o.value=e.id;return}o.value=e.tasks[n-1].id}}if(a===0){const e=t.value[t.value.length-1];e.tasks.length>0&&e.expanded?o.value=e.tasks[e.tasks.length-1].id:o.value=t.value[t.value.length-1].id}else{const e=t.value[a-1];e.tasks.length>0&&e.expanded?o.value=e.tasks[e.tasks.length-1].id:o.value=t.value[a-1].id}}function fe(){z.value=!1;const a=t.value.findIndex(e=>e.id===o.value);if(a===-1){const e=t.value.find(n=>n.tasks.some(l=>l.id===o.value));if(e){const n=e.tasks.findIndex(l=>l.id===o.value);if(n===-1)return;if(n===e.tasks.length-1){const l=t.value.indexOf(e);l===t.value.length-1?o.value=t.value[0].id:o.value=t.value[l+1].id;return}o.value=e.tasks[n+1].id}}if(a===t.value.length-1){const e=t.value[t.value.length-1];e.tasks.length>0&&e.expanded?o.value=e.tasks[0].id:o.value=t.value[0].id}else{const e=t.value[a];e.tasks.length>0&&e.expanded?o.value=e.tasks[0].id:o.value=t.value[a+1].id}}const o=y(null);N(o,()=>{var e,n;const a=(e=h.value)==null?void 0:e.querySelector(`[data-project-id="${o.value}"]`);if(a)a.scrollIntoView({block:"nearest",inline:"nearest"});else{const l=(n=h.value)==null?void 0:n.querySelector(`[data-task-id="${o.value}"]`);l&&l.scrollIntoView({block:"nearest",inline:"nearest"})}});function pe(){const a=t.value.findIndex(n=>n.id===o.value);if(a===-1)return;const e=t.value[a];e.expanded=!0}function ge(){const a=t.value.findIndex(n=>n.id===o.value);if(a===-1)return;const e=t.value[a];e.expanded=!1}const W=E(()=>r.projects.find(a=>a.id===p.value)),F=E(()=>r.tasks.find(a=>a.id===s.value)),ee=E(()=>{var a;return p.value===null?r.emptyPlaceholder:p.value===""?"No Project":(a=W.value)==null?void 0:a.name}),xe=E(()=>{var a;return((a=W.value)==null?void 0:a.color)||"var(--theme-color-icon-default)"}),z=y(!0);function te(a){z.value&&(o.value=a)}function ae(a){var e;s.value=a,p.value=((e=r.tasks.find(n=>n.id===a))==null?void 0:e.project_id)||null,g.value=!1,f.value="",Y("changed",p.value,s.value)}function ne(a){p.value=a,s.value=null,g.value=!1,f.value="",Y("changed",p.value,s.value)}const L=y(!1);return(a,e)=>(i(),m(H,null,[a.projects.length===0&&a.canCreateProject?(i(),m("div",qe,[w($e,{size:"large",tag:"button",class:"cursor-pointer hover:bg-tertiary",onClick:e[0]||(e[0]=n=>L.value=!0)},{default:S(()=>[w(I(De),{class:"-ml-1 w-5"}),e[7]||(e[7]=c("span",null,"Add new project",-1))]),_:1,__:[7]})])):(i(),q(Ie,{key:1,modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=n=>g.value=n),"close-on-content-click":!1,align:"center",class:""},{trigger:S(()=>[w(Pe,{ref:"projectDropdownTrigger",color:xe.value,size:a.size,border:a.showBadgeBorder,tag:"button",name:ee.value,class:A(I(ue)("focus:dark:border-[#5D6370] w-full bg-transparent dark:bg-transparent focus:outline-0 focus:dark:bg-[#0C101E] min-w-0 relative dark:text-[#7D88A1] hover:dark:bg-[#0C101E] hover:bg-[#0C101E]/10",r.class))},{default:S(()=>[c("div",Ke,[c("span",Fe,U(ee.value),1),F.value?(i(),q(I(Ne),{key:0,class:"w-4 lg:w-5 text-text-secondary shrink-0"})):V("",!0),F.value?(i(),m("div",Re,U(F.value.name),1)):V("",!0)]),p.value!==null&&a.allowReset?(i(),m("button",{key:0,class:"absolute right-0 top-0 h-full flex items-center pr-3 text-text-quaternary hover:text-text-secondary",onClick:e[1]||(e[1]=C(n=>{p.value=null,s.value=null},["stop"]))},[w(I(He),{class:"w-5"})])):V("",!0)]),_:1},8,["color","size","border","name","class"])]),content:S(()=>[g.value?(i(),q(I(Me),{key:0,options:{immediate:!0,allowOutsideClick:!0}},{default:S(()=>[c("input",{ref_key:"searchInput",ref:k,value:f.value,"data-testid":"client_dropdown_search",class:"dark:bg-[#13192B] border-0 placeholder-muted text-sm text-text-primary py-2.5 focus:ring-0 border-b dark:border-[#5D6370] focus:dark:border-[#5D6370] w-full",placeholder:"Search for a project or task...",onInput:ve,onKeydown:[B(C(de,["prevent"]),["enter"]),e[2]||(e[2]=B(C(n=>g.value=!1,["prevent"]),["esc"])),B(C(me,["prevent"]),["up"]),B(C(fe,["prevent"]),["down"]),B(C(pe,["prevent"]),["right"]),B(C(ge,["prevent"]),["left"])]},null,40,Te),c("div",{ref_key:"dropdownViewport",ref:h,class:"min-w-[350px] max-h-[350px] overflow-y-scroll relative dark:bg-[#13192B] dark:text-[#7D88A1]",onMousemove:e[3]||(e[3]=n=>z.value=!0)},[(i(!0),m(H,null,Z(d.value,n=>(i(),m(H,{key:n.id},[n.id!=="no_project_no_client"?(i(),m("div",Ze,[c("span",null,U(n.name),1)])):V("",!0),(i(!0),m(H,null,Z(n.projects,l=>(i(),m(H,{key:l.id},[c("div",{role:"option",class:"px-1 py-0.5 cursor-default",value:l.id,"data-project-id":l.id,onClick:x=>ne(l.id)},[c("div",{class:A(["rounded-lg",{"bg-card-background-active":l.id===o.value}])},[w(je,{class:"hover:!bg-transparent",selected:ce(l),name:l.name,color:l.color,onMouseenter:x=>te(l.id)},{actions:S(()=>[l.tasks.length>0?(i(),m("button",{key:0,tabindex:"-1",class:A(["px-2 py-0.5 mr-2 relative transition items-center rounded flex space-x-0.5 text-xs",{"bg-white/5 text-text-secondary":l.expanded,"hover:bg-white/5 hover:text-text-secondary text-text-tertiary":!l.expanded}]),onClick:C(()=>{var x;l.expanded=!l.expanded,(x=k.value)==null||x.focus()},["prevent","stop"])},[c("span",null,U(l.tasks.length)+" Tasks",1),w(I(Se),{class:A([{"transform rotate-180":l.expanded},"w-4"])},null,8,["class"])],10,Ge)):V("",!0)]),_:2},1032,["selected","name","color","onMouseenter"])],2)],8,Je),l.expanded?(i(),m("div",Qe,[(i(!0),m(H,null,Z(l.tasks,x=>(i(),m("div",{key:x.id,"data-task-id":x.id,class:A([{"bg-card-background-active":x.id===o.value},"flex items-center space-x-2 w-full px-5 py-1.5 text-start text-xs font-semibold leading-5 text-text-primary focus:outline-none focus:bg-card-background-active transition duration-150 ease-in-out"]),onClick:M=>ae(x.id),onMouseenter:M=>te(x.id)},[w(I(Ee),{class:"w-3 h-3 text-text-quaternary"}),c("span",null,U(x.name),1)],42,Xe))),128))])):V("",!0)],64))),128))],64))),128))],544),a.canCreateProject?(i(),m("div",Ye,[c("button",{class:"text-text-primary flex space-x-3 items-center px-4 py-3 text-xs font-semibold",onClick:e[4]||(e[4]=n=>{g.value=!1,L.value=!0})},[w(I(Ae),{class:"w-5 flex-shrink-0 text-icon-default"}),e[8]||(e[8]=c("span",null,"Create new Project",-1))])])):V("",!0)]),_:1})):V("",!0)]),_:1},8,["modelValue"])),w(Ve,{show:L.value,"onUpdate:show":e[6]||(e[6]=n=>L.value=n),"create-client":a.createClient,"enable-estimated-time":a.enableEstimatedTime,currency:a.currency,clients:a.clients,"create-project":a.createProject},null,8,["show","create-client","enable-estimated-time","currency","clients","create-project"])],64))}});export{Ct as _,It as a,re as b};
//# sourceMappingURL=TimeTrackerProjectTaskDropdown.vue_vue_type_script_setup_true_lang-Bx-SG6KH.js.map
