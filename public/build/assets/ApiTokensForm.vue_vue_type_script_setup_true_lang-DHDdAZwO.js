import{_ as O}from"./FormSection.vue_vue_type_script_setup_true_lang-C99SoZoZ.js";import{_ as F}from"./PrimaryButton.vue_vue_type_script_setup_true_lang-CWUYAS8h.js";import{_ as W}from"./InputLabel.vue_vue_type_script_setup_true_lang-BJprejo3.js";import{u as X,b as Z,a as _}from"./notification-Cqm5OIAz.js";import{S as h}from"./SectionBorder-ChOlRbsg.js";import{_ as B}from"./DangerButton.vue_vue_type_script_setup_true_lang-CLow7Nsm.js";import{_ as q}from"./TextInput.vue_vue_type_script_setup_true_lang-Cw992cSP.js";import{_ as C}from"./SecondaryButton.vue_vue_type_script_setup_true_lang-DBBC7wMi.js";import{_ as ee}from"./DialogModal.vue_vue_type_script_setup_true_lang-Cdp4pUKI.js";import{_ as te}from"./InputError.vue_vue_type_script_setup_true_lang-BquswFbc.js";import{_ as oe}from"./ActionMessage.vue_vue_type_script_setup_true_lang-CVcyXSqn.js";import{_ as N}from"./ConfirmationModal.vue_vue_type_script_setup_true_lang-D7G1FM0h.js";import{_ as se}from"./ActionSection.vue_vue_type_script_setup_true_lang-BXvQti6s.js";import{d as ne,r as T,B as ae,T as ie,c as le,h as u,o as r,e as a,j as m,w as t,u as s,l as n,n as b,f as l,F as re,i as ue,b as V,t as v}from"./app-Dzd5B06R.js";import{u as de}from"./useQuery-BH-Arugy.js";import{u as P}from"./useMutation-DORhZ8RW.js";import{b as me}from"./index-NRw1C4BU.js";import{e as K}from"./time-D8Z5bJ3P.js";import{r as pe}from"./ClockIcon-CYfSOCq5.js";const fe={class:"col-span-6 sm:col-span-4"},ve={class:"text-text-tertiary text-sm pt-3 flex space-x-1.5 font-medium items-center"},ke={key:0},ye={class:"mt-10 sm:mt-0"},ce={class:"divide-border-secondary divide-y"},_e={class:"break-all text-text-primary"},Te={class:"text-sm text-text-tertiary space-x-3"},Ae={key:0},we={key:1},xe={key:2},ge={class:"flex items-center ms-2"},Ce={key:0,class:"text-sm text-gray-400"},be=["aria-label","onClick"],Pe=["aria-label","onClick"],Ie={class:"flex gap-2 pt-6 w-full"},Je=ne({__name:"ApiTokensForm",setup($e){const A=X(),p=T(null),f=T(null),{handleApiRequestNotifications:w}=Z(),k=T(""),{copy:M,copied:Q,isSupported:z}=me(),y=ae("organization");async function j(){await w(()=>x.mutateAsync({name:d.name}),"API Token successfully created","There was an error while creating the API Token",i=>{d.name="",c.value=!0,k.value=i.data.access_token})}const d=ie({name:""});function L(i){p.value=i}function E(i){f.value=i}const c=T(!1);async function U(){p.value&&await w(()=>H.mutateAsync(p.value.id),"API Token successfully deleted","There was an error while deleting the API Token",()=>{p.value=null})}async function Y(){f.value&&await w(()=>g.mutateAsync(f.value.id),"API Token successfully revoked","There was an error while revoking the API Token",()=>{f.value=null})}const{data:G}=de({queryKey:["api-tokens"],queryFn:()=>_.getApiTokens()}),I=le(()=>{var i;return((i=G.value)==null?void 0:i.data)??[]}),x=P({mutationFn:async i=>await _.createApiToken(i),onSuccess:()=>{A.invalidateQueries({queryKey:["api-tokens"]})}}),H=P({mutationFn:async i=>await _.deleteApiToken(void 0,{params:{apiToken:i}}),onSuccess:()=>{A.invalidateQueries({queryKey:["api-tokens"]})}}),g=P({mutationFn:async i=>await _.revokeApiToken(void 0,{params:{apiToken:i}}),onSuccess:()=>{A.invalidateQueries({queryKey:["api-tokens"]})}});return(i,e)=>(r(),u("div",null,[a(O,{onSubmitted:j},{title:t(()=>e[8]||(e[8]=[n(" Create API Token ")])),description:t(()=>e[9]||(e[9]=[n(" API tokens allow third-party services to authenticate with our application on your behalf. ")])),form:t(()=>[l("div",fe,[a(W,{for:"api_key_name",value:"API Key Name"}),a(q,{id:"api_key_name",modelValue:s(d).name,"onUpdate:modelValue":e[0]||(e[0]=o=>s(d).name=o),type:"text",class:"mt-1 block w-full"},null,8,["modelValue"]),a(te,{message:s(d).errors.name,class:"mt-2"},null,8,["message"]),l("div",ve,[a(s(pe),{class:"w-4"}),e[10]||(e[10]=l("span",null," API Tokens are valid for 1 year ",-1))])])]),actions:t(()=>[a(oe,{on:s(d).recentlySuccessful,class:"me-3"},{default:t(()=>e[11]||(e[11]=[n(" Created. ")])),_:1,__:[11]},8,["on"]),a(F,{class:b({"opacity-25":s(d).processing}),disabled:s(d).processing},{default:t(()=>e[12]||(e[12]=[n(" Create API Key ")])),_:1,__:[12]},8,["class","disabled"])]),_:1}),I.value.length>0?(r(),u("div",ke,[a(h),l("div",ye,[a(se,null,{title:t(()=>e[13]||(e[13]=[n(" Manage API Tokens ")])),description:t(()=>e[14]||(e[14]=[n(" You may delete or revoke any of your existing tokens if they are no longer needed. ")])),content:t(()=>[l("div",ce,[(r(!0),u(re,null,ue(I.value,o=>{var $,R,S,D;return r(),u("div",{key:o.id,class:"flex items-center py-2.5 justify-between"},[l("div",_e,[l("div",null,v(o.name),1),l("div",Te,[o.created_at?(r(),u("span",Ae," Created at "+v(s(K)(o.created_at,($=s(y))==null?void 0:$.date_format,(R=s(y))==null?void 0:R.time_format)),1)):m("",!0),o.expires_at?(r(),u("span",we," Expires at "+v(s(K)(o.expires_at,(S=s(y))==null?void 0:S.date_format,(D=s(y))==null?void 0:D.time_format)),1)):m("",!0),o.revoked?(r(),u("span",xe," Revoked ")):m("",!0)])]),l("div",ge,[o.last_used_ago?(r(),u("div",Ce," Last used "+v(o.last_used_ago),1)):m("",!0),o.revoked?m("",!0):(r(),u("button",{key:1,class:"cursor-pointer ms-6 text-sm text-text-secondary","aria-label":"Revoke API Token "+o.name,onClick:J=>E(o)}," Revoke ",8,be)),l("button",{class:"cursor-pointer ms-6 text-sm text-red-500","aria-label":"Delete API Token "+o.name,onClick:J=>L(o)}," Delete ",8,Pe)])])}),128))])]),_:1})])])):m("",!0),a(ee,{show:c.value,onClose:e[3]||(e[3]=o=>c.value=!1)},{title:t(()=>e[15]||(e[15]=[n(" API Token created successfully ")])),content:t(()=>[e[16]||(e[16]=l("div",null,[n(" Please copy your new API token. For your security, it won't be shown again. "),l("strong",null,"This token is valid for one year"),n(" unless you revoke it. ")],-1)),e[17]||(e[17]=l("div",null,null,-1)),l("div",Ie,[k.value?(r(),V(q,{key:0,disabled:"","model-value":k.value,class:"flex-1 text-gray-500"},null,8,["model-value"])):m("",!0),s(z)?(r(),V(F,{key:1,onClick:e[1]||(e[1]=o=>s(M)(k.value))},{default:t(()=>[n(v(s(Q)?"Copied!":"Copy Token"),1)]),_:1})):m("",!0)])]),footer:t(()=>[a(C,{onClick:e[2]||(e[2]=o=>c.value=!1)},{default:t(()=>e[18]||(e[18]=[n(" Close ")])),_:1,__:[18]})]),_:1},8,["show"]),a(N,{show:p.value!=null,onClose:e[5]||(e[5]=o=>p.value=null)},{title:t(()=>e[19]||(e[19]=[n(" Delete API Token ")])),content:t(()=>e[20]||(e[20]=[n(" Are you sure you would like to delete this API token? ")])),footer:t(()=>[a(C,{onClick:e[4]||(e[4]=o=>p.value=null)},{default:t(()=>e[21]||(e[21]=[n(" Cancel ")])),_:1,__:[21]}),a(B,{class:b(["ms-3",{"opacity-25":s(x).isPending.value}]),disabled:s(x).isPending.value,onClick:U},{default:t(()=>e[22]||(e[22]=[n(" Delete ")])),_:1,__:[22]},8,["class","disabled"])]),_:1},8,["show"]),a(N,{show:f.value!=null,onClose:e[7]||(e[7]=o=>f.value=null)},{title:t(()=>e[23]||(e[23]=[n(" Revoke API Token ")])),content:t(()=>e[24]||(e[24]=[n(" Are you sure you would like to revoke this API token? ")])),footer:t(()=>[a(C,{onClick:e[6]||(e[6]=o=>f.value=null)},{default:t(()=>e[25]||(e[25]=[n(" Cancel ")])),_:1,__:[25]}),a(B,{class:b(["ms-3",{"opacity-25":s(g).isPending.value}]),disabled:s(g).isPending.value,onClick:Y},{default:t(()=>e[26]||(e[26]=[n(" Revoke ")])),_:1,__:[26]},8,["class","disabled"])]),_:1},8,["show"])]))}});export{Je as _};
