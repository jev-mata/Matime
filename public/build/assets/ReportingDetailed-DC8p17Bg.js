import{M as R,b as Te,a as je}from"./MainContainer-WpbdfkDp.js";import{e as Ee,f as ke,P as Ve,S as he,B as Ce,D as Pe,x as Ue,$ as Be,d as Ae,E as qe,_ as De}from"./AppLayout.vue_vue_type_script_setup_true_lang-BfXcHqGL.js";import{_ as Ne}from"./PageTitle.vue_vue_type_script_setup_true_lang-Dc0jot_g.js";import{_ as Me,a as Fe,b as ze,c as _,d as Ie,e as Le,f as Oe,g as Qe}from"./ReportingExportModal.vue_vue_type_script_setup_true_lang-BbqNIV_u.js";import{B as Re}from"./BillableIcon-C1VJddF3.js";import{h as k,g as U}from"./time-D8Z5bJ3P.js";import{d as Je,r as u,A as x,c as J,q as Ke,D as Ge,b as B,o as c,w as i,e as r,f as n,u as a,I as K,h as w,j as He,F as A,i as G,l as We,t as Xe}from"./app-Dzd5B06R.js";import{_ as Ye}from"./TagDropdown.vue_vue_type_script_setup_true_lang-DArOXIGF.js";import{b as Ze,u as et,a as H}from"./notification-Cqm5OIAz.js";import{_ as tt}from"./SelectDropdown.vue_vue_type_script_setup_true_lang-CaZ4i_G-.js";import{u as W,b as X,a as Y}from"./init-Ddj1H8ev.js";import{d as Z}from"./index-NRw1C4BU.js";import{_ as at,a as rt}from"./TimeEntryMassActionRow.vue_vue_type_script_setup_true_lang-BFf_DA-f.js";import{d as st,g as q,a as ee,b as it,u as te,c as lt}from"./useMembers-D1lZTqLC.js";import{g as ae}from"./money-DE8Cj37t.js";import{u as ot}from"./useQuery-BH-Arugy.js";import{_ as nt}from"./ReportingTabNavbar.vue_vue_type_script_setup_true_lang-CVC589uJ.js";import{i as re}from"./billing-BrKRBYHJ.js";import{q as se,u as ut}from"./permissions-Cy8U4TFG.js";import{r as ie}from"./FolderIcon-DWxb3Ngj.js";import{r as mt}from"./CheckCircleIcon-Cls-9biQ.js";import{r as ct}from"./ClockIcon-CYfSOCq5.js";import{r as dt,a as pt,b as vt}from"./ChevronLeftIcon-Bv_5XyMM.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-CCwwB18o.js";import"./bundle-mjs-D696Ktp4.js";import"./useFocusGuards-BJPjJVKi.js";import"./useOrganization-fnI1XVs5.js";import"./utc-BCs3FwGo.js";import"./DialogModal.vue_vue_type_script_setup_true_lang-Cdp4pUKI.js";import"./Modal.vue_vue_type_script_setup_true_lang-s_ZkTFQt.js";import"./PrimaryButton.vue_vue_type_script_setup_true_lang-CWUYAS8h.js";import"./LoadingSpinner.vue_vue_type_script_setup_true_lang-CcpHAXFE.js";import"./SecondaryButton.vue_vue_type_script_setup_true_lang-DBBC7wMi.js";import"./theme-CJTqdCW4.js";import"./UpgradeModal.vue_vue_type_script_setup_true_lang-BsrvLgcD.js";import"./usePrimitiveElement-Dt-Gdg0c.js";import"./Collection-DUsfnDCk.js";import"./useLocale-CRrU4gHp.js";import"./createLucideIcon-CLDLlRIF.js";import"./index-DinQ5eO0.js";import"./TagCreateModal.vue_vue_type_script_setup_true_lang-BZ1Krxqg.js";import"./TextInput.vue_vue_type_script_setup_true_lang-Cw992cSP.js";import"./component-D2dmHEOx.js";import"./TimeTrackerProjectTaskDropdown.vue_vue_type_script_setup_true_lang-BwWIfvvx.js";import"./DatePicker-DsbVNWEA.js";import"./ProjectDropdownItem.vue_vue_type_script_setup_true_lang-wvL1v9C2.js";import"./ProjectCreateModal.vue_vue_type_script_setup_true_lang-CZmoGoj9.js";import"./ProjectEditBillableSection.vue_vue_type_script_setup_true_lang-DqRZf2t1.js";import"./InputLabel.vue_vue_type_script_setup_true_lang-BJprejo3.js";import"./BillableRateInput.vue_vue_type_script_setup_true_lang-B9u_Q2bT.js";import"./clamp-D21Fl2C-.js";import"./PlusIcon-DXN6bajS.js";import"./TagBadge.vue_vue_type_script_setup_true_lang-Bl_ueEok.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-OCyRpCcO.js";import"./useTypeahead-DT7HEzVy.js";import"./RovingFocusGroup-C65J4aAO.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-CGLsJy8v.js";import"./PencilSquareIcon-C4w9DETU.js";import"./TabBar.vue_vue_type_script_setup_true_lang-goXlkxJT.js";const ft={class:"flex items-center space-x-3 sm:space-x-6"},gt={class:"py-2.5 w-full border-b border-default-background-separator"},bt={class:"flex flex-wrap items-center space-y-2 sm:space-y-0 space-x-4"},yt={class:"w-full relative"},_t={key:0},xt={class:"text-center pt-12"},wt={class:"pr-2 flex items-center space-x-1 border-r border-border-primary mr-1"},St={class:"!ml-2 pl-2 flex items-center space-x-1 border-l border-border-primary"},V=15,Ca=Je({__name:"ReportingDetailed",setup($t){const S=Z("reporting-start-date",k(U()().format()).subtract(14,"d").format()),$=Z("reporting-end-date",k(U()().format()).format()),d=u([]),p=u([]),v=u([]),f=u([]),g=u([]),b=u(null),{members:le}=x(st()),T=u(1);function D(){return{...{start:k(S.value).startOf("day").utc().format(),end:k($.value).endOf("day").utc().format(),active:"false",limit:V,offset:T.value*V-V},member_id:ut()?void 0:lt(),member_ids:v.value.length>0?v.value:void 0,project_ids:p.value.length>0?p.value:void 0,task_ids:f.value.length>0?f.value:void 0,client_ids:g.value.length>0?g.value:void 0,tag_ids:d.value.length>0?d.value:void 0,billable:b.value!==null?b.value:void 0}}const N=W(),{currentTimeEntry:oe}=x(N),{setActiveState:ne,startLiveTimer:ue}=N,{handleApiRequestNotifications:me}=Ze(),{createTimeEntry:ce,updateTimeEntry:de,updateTimeEntries:pe}=X(),{tags:h}=x(Y()),{data:y}=ot({queryKey:["timeEntry","detailed-report"],enabled:!!q(),queryFn:()=>H.getTimeEntries({params:{organization:q()||""},queries:{...D()}})}),ve=J(()=>{var s,t;return((t=(s=y==null?void 0:y.value)==null?void 0:s.meta)==null?void 0:t.total)??1}),fe=X();async function M(s){await fe.deleteTimeEntries(s),l.value=[],await o()}const j=J(()=>{var s;return((s=y==null?void 0:y.value)==null?void 0:s.data)||[]});Ke(async()=>{await o()});const ge=ee(),{projects:F}=x(ge),be=it(),{tasks:z}=x(be),ye=te(),{clients:I}=x(ye),l=u([]),C=u(!1),L=u(null);async function P(s){return await Y().createTag(s)}async function O(s){return await ee().createProject(s)}async function Q(s){return await te().createClient(s)}async function _e(s){oe.value.id&&await ne(!1),await ce({project_id:s.project_id,task_id:s.task_id,start:U().utc().format(),end:null,billable:s.billable,description:s.description}),ue(),o(),W().fetchCurrentTimeEntry()}const xe=et();async function o(){await xe.invalidateQueries({queryKey:["timeEntry","detailed-report"]})}Ge(T,()=>{o()});function we(){M(l.value)}async function Se(){l.value=[],await o()}async function $e(s){const t=q();if(t){const e=await me(()=>H.exportTimeEntries({params:{organization:t},queries:{...D(),format:s}}),"Export successful","Export failed");e!=null&&e.download_url&&(C.value=!0,L.value=e.download_url)}}return(s,t)=>(c(),B(De,{title:"Reporting","data-testid":"reporting_view",class:"overflow-hidden"},{default:i(()=>[r(Me,{show:C.value,"onUpdate:show":t[0]||(t[0]=e=>C.value=e),"export-url":L.value},null,8,["show","export-url"]),r(R,{class:"py-3 sm:py-5 border-b border-default-background-separator flex justify-between items-center"},{default:i(()=>[n("div",ft,[r(Ne,{icon:a(Te),title:"Reporting"},null,8,["icon"]),r(nt,{active:"detailed"})]),r(Fe,{download:$e})]),_:1}),n("div",gt,[r(R,{class:"sm:flex space-y-4 sm:space-y-0 justify-between"},{default:i(()=>[n("div",bt,[t[12]||(t[12]=n("div",{class:"text-sm font-medium"},"Filters",-1)),r(ze,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=e=>v.value=e),onSubmit:o},{trigger:i(()=>[r(_,{count:v.value.length,active:v.value.length>0,title:"Members",icon:a(je)},null,8,["count","active","icon"])]),_:1},8,["modelValue"]),r(Ie,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=e=>p.value=e),onSubmit:o},{trigger:i(()=>[r(_,{count:p.value.length,active:p.value.length>0,title:"Projects",icon:a(ie)},null,8,["count","active","icon"])]),_:1},8,["modelValue"]),r(Le,{modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=e=>f.value=e),onSubmit:o},{trigger:i(()=>[r(_,{count:f.value.length,active:f.value.length>0,title:"Tasks",icon:a(mt)},null,8,["count","active","icon"])]),_:1},8,["modelValue"]),r(Oe,{modelValue:g.value,"onUpdate:modelValue":t[4]||(t[4]=e=>g.value=e),onSubmit:o},{trigger:i(()=>[r(_,{count:g.value.length,active:g.value.length>0,title:"Clients",icon:a(ie)},null,8,["count","active","icon"])]),_:1},8,["modelValue"]),r(Ye,{modelValue:d.value,"onUpdate:modelValue":t[5]||(t[5]=e=>d.value=e),"create-tag":P,tags:a(h),onSubmit:o},{trigger:i(()=>[r(_,{count:d.value.length,active:d.value.length>0,title:"Tags",icon:a(Ee)},null,8,["count","active","icon"])]),_:1},8,["modelValue","tags"]),r(tt,{modelValue:b.value,"onUpdate:modelValue":t[6]||(t[6]=e=>b.value=e),"get-key-from-item":e=>e.value,"get-name-for-item":e=>e.label,items:[{label:"Both",value:null},{label:"Billable",value:"true"},{label:"Non Billable",value:"false"}],onChanged:o},{trigger:i(()=>[r(_,{active:b.value!==null,title:b.value==="false"?"Non Billable":"Billable",icon:Re},null,8,["active","title"])]),_:1},8,["modelValue","get-key-from-item","get-name-for-item"])]),n("div",null,[r(Qe,{start:a(S),"onUpdate:start":t[7]||(t[7]=e=>K(S)?S.value=e:null),end:a($),"onUpdate:end":t[8]||(t[8]=e=>K($)?$.value=e:null),onSubmit:o},null,8,["start","end"])])]),_:1})]),r(at,{"selected-time-entries":l.value,"can-create-project":a(se)(),"enable-estimated-time":a(re)(),"delete-selected":we,"all-selected":l.value.length===j.value.length,projects:a(F),tasks:a(z),tags:a(h),currency:a(ae)(),clients:a(I),"update-time-entries":e=>a(pe)(l.value.map(m=>m.id),e),"create-project":O,"create-client":Q,"create-tag":P,onSubmit:Se,onSelectAll:t[9]||(t[9]=e=>l.value=[...j.value]),onUnselectAll:t[10]||(t[10]=e=>l.value=[])},null,8,["selected-time-entries","can-create-project","enable-estimated-time","all-selected","projects","tasks","tags","currency","clients","update-time-entries"]),n("div",yt,[(c(!0),w(A,null,G(j.value,e=>(c(),w("div",{key:e.id},[r(rt,{selected:l.value.includes(e),"can-create-project":a(se)(),"create-client":Q,"create-project":O,"enable-estimated-time":a(re)(),projects:a(F),tasks:a(z),tags:a(h),clients:a(I),"create-tag":P,"update-time-entry":a(de),"on-start-stop-click":()=>_e(e),"delete-time-entry":()=>M([e]),currency:a(ae)(),members:a(le),"show-date":"","show-member":"","time-entry":e,onSelected:m=>l.value.push(e),onUnselected:m=>l.value=l.value.filter(E=>E.id!==e.id)},null,8,["selected","can-create-project","enable-estimated-time","projects","tasks","tags","clients","update-time-entry","on-start-stop-click","delete-time-entry","currency","members","time-entry","onSelected","onUnselected"])]))),128)),j.value.length===0?(c(),w("div",_t,[n("div",xt,[r(a(ct),{class:"w-8 text-icon-default inline pb-2"}),t[13]||(t[13]=n("h3",{class:"text-text-primary font-semibold"}," No time entries found ",-1)),t[14]||(t[14]=n("p",{class:"pb-5"}," Adjust the filters to see more time entries! ",-1))])])):He("",!0)]),r(a(ke),{page:T.value,"onUpdate:page":t[11]||(t[11]=e=>T.value=e),total:ve.value,"items-per-page":V,class:"flex justify-center items-center py-8","sibling-count":1,"show-edges":""},{default:i(()=>[r(a(Ve),{class:"flex items-center space-x-1 relative"},{default:i(({items:e})=>[n("div",wt,[r(a(he),{class:"navigation-item"},{default:i(()=>[r(a(dt),{class:"w-4"})]),_:1}),r(a(Ce),{class:"mr-4 navigation-item"},{default:i(()=>[r(a(pt),{class:"w-4 text-text-tertiary hover:text-text-primary"})]),_:1})]),(c(!0),w(A,null,G(e,(m,E)=>(c(),w(A,null,[m.type==="page"?(c(),B(a(Pe),{key:E,class:"pagination-item",value:m.value},{default:i(()=>[We(Xe(m.value),1)]),_:2},1032,["value"])):(c(),B(a(Ue),{key:m.type,index:E,class:"PaginationEllipsis"},{default:i(()=>t[15]||(t[15]=[n("div",{class:"px-2"},"…",-1)])),_:2,__:[15]},1032,["index"]))],64))),256)),n("div",St,[r(a(Be),{class:"navigation-item"},{default:i(()=>[r(a(Ae),{class:"w-4 text-text-tertiary hover:text-text-primary"})]),_:1}),r(a(qe),{class:"navigation-item"},{default:i(()=>[r(a(vt),{class:"w-4 text-text-tertiary hover:text-text-primary"})]),_:1})])]),_:1})]),_:1},8,["page","total"])]),_:1}))}});export{Ca as default};
