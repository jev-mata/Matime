import{_ as le}from"./CardTitle.vue_vue_type_script_setup_true_lang-CyznVp_q.js";import{d as U,h as T,o as f,f as v,e as x,w as B,l as ue,x as O,y as R,c as E,b as J,n as ne,u as m,j as F,t as H,r as _,G as ae,c5 as ie,z as V,g as Q,D as G,A as L,v as ce,L as de,F as se,i as me,Q as pe,q as ve,I as W}from"./app-Dzd5B06R.js";import{d as D,u as fe}from"./utc-BCs3FwGo.js";import{j as ge,p as Te,g as X,k as ye}from"./time-D8Z5bJ3P.js";import{b as be,u as Y,a as Z}from"./init-Ddj1H8ev.js";import{a as I,b as xe,u as ee,g as te}from"./useMembers-D1lZTqLC.js";import{s as ke}from"./useOrganization-fnI1XVs5.js";import{_ as we}from"./TagDropdown.vue_vue_type_script_setup_true_lang-DArOXIGF.js";import{t as oe}from"./bundle-mjs-D696Ktp4.js";import{e as _e,b as je,T as he}from"./AppLayout.vue_vue_type_script_setup_true_lang-BfXcHqGL.js";import{_ as Ee,r as $e,a as Se,b as Ce}from"./TimeTrackerProjectTaskDropdown.vue_vue_type_script_setup_true_lang-BwWIfvvx.js";import{o as re,u as De}from"./index-NRw1C4BU.js";import{c as ze,d as Le,o as Ve,s as Ue,f as Me,l as Ae}from"./useFocusGuards-BJPjJVKi.js";import{g as Pe}from"./money-DE8Cj37t.js";import{_ as Be}from"./ProjectDropdownItem.vue_vue_type_script_setup_true_lang-wvL1v9C2.js";import"./notification-Cqm5OIAz.js";import{q as Oe}from"./permissions-Cy8U4TFG.js";import{_ as Re}from"./SecondaryButton.vue_vue_type_script_setup_true_lang-DBBC7wMi.js";import{i as Fe}from"./billing-BrKRBYHJ.js";import{r as Ne}from"./ClockIcon-CYfSOCq5.js";const qe={class:"absolute w-full h-full backdrop-blur-sm z-10 flex items-center justify-center"},He={class:"flex space-x-3 items-center w-full z-20 justify-center"},Ge=U({__name:"TimeTrackerRunningInDifferentOrganizationOverlay",emits:["switchOrganization"],setup(l){return(d,e)=>(f(),T("div",qe,[e[3]||(e[3]=v("div",{class:"w-full h-[calc(100%+10px)] absolute bg-default-background opacity-75 backdrop-blur-sm"},null,-1)),v("div",He,[e[2]||(e[2]=v("span",{class:"text-sm text-text-primary"}," The Timer is running in a different organization. ",-1)),x(Re,{onClick:e[0]||(e[0]=u=>d.$emit("switchOrganization"))},{default:B(()=>e[1]||(e[1]=[ue("Switch to organization")])),_:1,__:[1]})])]))}}),Je={key:0,class:"font-extrabold absolute rounded-full text-xs w-3 h-3 block top-[15px] rotate-[45deg] right-[14px] text-card-background"},Ke=U({__name:"TimeTrackerTagDropdown",props:O({tags:{},createTag:{type:Function}},{modelValue:{default:[]},modelModifiers:{}}),emits:O(["changed"],["update:modelValue"]),setup(l,{emit:d}){const e=d,u=R(l,"modelValue"),a=E(()=>u.value.length>0?"text-input-select-active focus:text-input-select-active-hover hover:text-input-select-active-hover":"text-icon-default hover:text-icon-active focus:text-icon-active");return(c,s)=>(f(),J(we,{modelValue:u.value,"onUpdate:modelValue":s[0]||(s[0]=o=>u.value=o),"create-tag":c.createTag,tags:c.tags,onChanged:s[1]||(s[1]=o=>e("changed"))},{trigger:B(()=>[v("button",{"data-testid":"tag_dropdown",class:ne(m(oe)(a.value,"flex-shrink-0 ring-0 focus:outline-none focus:ring-2 focus:ring-ring transition focus-visible:bg-card-background-separator hover:bg-card-background-separator rounded-full w-10 h-10 flex items-center justify-center"))},[x(m(_e),{class:"w-5 h-5 lg:h-6 lg:w-6"}),u.value.length>1?(f(),T("span",Je,H(u.value.length),1)):F("",!0)],2)]),_:1},8,["modelValue","create-tag","tags"]))}}),Qe={class:"relative"},We=["onKeydown"],Xe=U({__name:"TimeTrackerRangeSelector",props:{currentTimeEntry:{required:!0},currentTimeEntryModifiers:{},liveTimer:{},liveTimerModifiers:{}},emits:O(["startLiveTimer","stopLiveTimer","updateTimer","startTimer"],["update:currentTimeEntry","update:liveTimer"]),setup(l,{emit:d}){const e=R(l,"currentTimeEntry"),u=R(l,"liveTimer"),a=d,c=_(!1);function s(i){i.target.select(),a("stopLiveTimer")}function o(){$(),c.value=!1;const i=document.activeElement;i==null||i.blur()}const w=E({get(){if(k.value!=="")return k.value;if(u.value&&e.value.start){const i=D(e.value.start),p=u.value.diff(i,"seconds");return ge(p)}return null},set(i){i?k.value=i:k.value=""}});function $(){const{seconds:i}=Te(k.value,"minutes");if(i&&i>0){const p=D().subtract(i,"s");e.value.start=p.utc().format(),e.value.id!==""?a("updateTimer"):a("startTimer")}u.value=D().utc(),k.value="",a("startLiveTimer")}const k=_("");async function M(i){X()(i).isBefore(X()())&&(e.value.start=i,e.value.id?a("updateTimer"):a("startTimer"))}const S=E(()=>e.value.start&&e.value.start!==""?e.value.start:D().utc().format()),z=_(null),y=_(null);function A(i){var g;const p=i.relatedTarget;p&&((g=window.document.body.querySelector("#app"))!=null&&g.contains(p))&&(c.value=!0)}function P(i){var p;if(c.value){i.preventDefault();const g=(p=y.value)==null?void 0:p.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');g==null||g.focus()}}function j(){var i;c.value=!1,(i=z.value)==null||i.focus()}return(i,p)=>(f(),T("div",Qe,[x(je,{modelValue:c.value,"onUpdate:modelValue":p[2]||(p[2]=g=>c.value=g),align:"center","auto-focus":!1,"close-on-content-click":!1,onSubmit:j},{trigger:B(()=>[ae(v("input",{ref_key:"inputField",ref:z,"onUpdate:modelValue":p[0]||(p[0]=g=>w.value=g),placeholder:"00:00:00","data-testid":"time_entry_time",class:"w-[110px] lg:w-[130px] h-full text-text-primary py-2.5 rounded-lg border-border-secondary border text-center px-4 text-base lg:text-lg font-semibold bg-card-background border-none placeholder-muted focus:ring-0 transition",type:"text",onFocus:s,onFocusin:A,onKeydown:[V(Q(P,["exact"]),["tab"]),p[1]||(p[1]=V(Q(g=>c.value=!1,["exact","shift"]),["tab"])),V(o,["enter"])],onBlur:$},null,40,We),[[ie,w.value]])]),content:B(()=>[v("div",{ref_key:"timeRangeSelector",ref:y},[x(Ee,{start:S.value,end:null,onChanged:M,onClose:j},null,8,["start"])],512)]),_:1},8,["modelValue"])]))}}),Ye=["data-select-id"],Ze={key:0,class:"text-sm font-medium"},Ie={key:1,class:"text-sm text-text-tertiary font-medium"},et={key:0,class:"flex items-center lg:space-x-1 min-w-0"},tt={class:"whitespace-nowrap text-xs"},rt={key:1,class:"min-w-0 shrink text-xs truncate"},nt={key:1},at=U({__name:"TimeTrackerRecentlyTrackedEntry",props:{timeEntry:{},highlighted:{type:Boolean},projects:{},tasks:{}},setup(l){const d=l,e=E(()=>{var a;return(a=d.projects)==null?void 0:a.find(c=>c.id===d.timeEntry.project_id)}),u=E(()=>{var a;return(a=d.tasks)==null?void 0:a.find(c=>c.id===d.timeEntry.task_id)});return(a,c)=>{var s,o;return f(),T("button",{tabindex:"-1","data-select-id":a.timeEntry.id,class:ne(m(oe)("px-2 py-1.5 flex justify-between items-center space-x-2 w-full rounded",d.highlighted&&"bg-card-background-active"))},[a.timeEntry.description!==""?(f(),T("span",Ze,H(a.timeEntry.description),1)):(f(),T("span",Ie," No Description ")),x(m(Be),{ref:"projectDropdownTrigger",color:(s=e.value)==null?void 0:s.color,name:(o=e.value)==null?void 0:o.name,class:""},{default:B(()=>{var w;return[e.value?(f(),T("div",et,[v("span",tt,H((w=e.value)==null?void 0:w.name),1),u.value?(f(),J(m($e),{key:0,class:"w-4 lg:w-5 text-text-secondary shrink-0"})):F("",!0),u.value?(f(),T("div",rt,H(u.value.name),1)):F("",!0)])):(f(),T("div",nt," No Project "))]}),_:1},8,["color","name"])],10,Ye)}}});function it(l,d,e,u){function a(){if(s.value){const o=l.value.indexOf(s.value);o===0?d.value=e(l.value[l.value.length-1]):d.value=e(l.value[o-1])}else d.value=e(l.value[l.value.length-1])}function c(){if(s.value){const o=l.value.indexOf(s.value);o===l.value.length-1?d.value=e(l.value[0]):d.value=e(l.value[o+1])}else d.value=e(l.value[0])}const s=E(()=>l.value.find(o=>e(o)===d.value));re("ArrowDown",o=>{u.value===!0&&(c(),o.preventDefault())}),re("ArrowUp",o=>{u.value===!0&&(a(),o.preventDefault())}),G(u,o=>{o===!1&&(d.value=null)})}const st={class:"flex items-center relative @container","data-testid":"dashboard_timer"},ot={class:"flex flex-col @2xl:flex-row w-full justify-between rounded-lg bg-card-background border-card-border border transition shadow-card"},lt={class:"flex flex-1 items-center pr-6 relative"},ut={class:"rounded-lg w-full fixed min-w-xl top-0 left-0 border border-card-border overflow-none shadow-dropdown bg-card-background"},ct={class:"text-text-secondary py-1 px-1.5"},dt={class:"flex items-center justify-between pl-2 shrink min-w-0"},mt={class:"flex items-center w-[130px] @2xl:w-auto shrink min-w-0"},pt={class:"flex items-center @2xl:space-x-2 px-2 @2xl:px-4"},vt={class:"border-l border-card-border"},ft={class:"pl-4 @2xl:pl-6 pr-3 absolute sm:relative top-[6px] sm:top-0 right-0"},gt=U({__name:"TimeTrackerControls",props:O({projects:{},tasks:{},tags:{},clients:{},createTag:{type:Function},createProject:{type:Function},createClient:{type:Function},isActive:{type:Boolean},currency:{},enableEstimatedTime:{type:Boolean},canCreateProject:{type:Boolean}},{currentTimeEntry:{required:!0},currentTimeEntryModifiers:{},liveTimer:{required:!0},liveTimerModifiers:{}}),emits:O(["startTimer","stopTimer","updateTimeEntry","startLiveTimer","stopLiveTimer"],["update:currentTimeEntry","update:liveTimer"]),setup(l,{emit:d}){const e=R(l,"currentTimeEntry"),u=R(l,"liveTimer"),a=_(null),c=l,s=d;function o(){M(),s("updateTimeEntry")}function w(n){$(n),c.isActive?s("updateTimeEntry"):s("startTimer")}function $(n){e.value.description=n.description,e.value.project_id=n.project_id,e.value.task_id=n.task_id,e.value.tags=n.tags,e.value.billable=n.billable}function k(){if(C.value){const n=j.value.find(r=>r.id===C.value);n&&($(n),i.value=!1)}else e.value.description=y.value;c.isActive?s("updateTimeEntry"):s("startTimer")}function M(){const n=c.projects.find(r=>r.id===e.value.project_id);n&&(e.value.billable=n.is_billable)}const S=_(!1);function z(n){var r;n?(s("startTimer"),S.value||(r=a.value)==null||r.focus()):s("stopTimer")}const y=_(e.value.description);G(()=>e.value.description,()=>{y.value=e.value.description});function A(){e.value.description!==y.value&&(e.value.description=y.value,s("updateTimeEntry"))}const{timeEntries:P}=L(be()),j=E(()=>P.value.filter(t=>t.end!==null).filter((t,b,N)=>b===N.findIndex(h=>h.description===t.description&&h.task_id===t.task_id&&h.project_id===t.project_id&&h.tags.length===t.tags.length&&h.tags.every(q=>t.tags.includes(q))&&h.billable===t.billable)).filter(t=>{var b,N,h,q;return(q=(b=t.description)==null?void 0:b.toLowerCase())==null?void 0:q.includes(((h=(N=y.value)==null?void 0:N.toLowerCase())==null?void 0:h.trim())||"")}).slice(0,5)),i=_(!1),{focused:p}=De(a);G(p,n=>{ce(()=>{i.value=n,n||(S.value=!0,setTimeout(()=>{S.value=!1},100))})});const g=_(null),{floatingStyles:K}=ze(a,g,{placement:"bottom-start",whileElementsMounted:Le,middleware:[Ve(10),Ue({limiter:Ae({offset:5})}),Me({fallbackAxisSideDirection:"start"})]}),C=_(null);return it(j,C,n=>n.id,i),(n,r)=>(f(),T("div",st,[v("div",ot,[v("div",lt,[ae(v("input",{ref_key:"currentTimeEntryDescriptionInput",ref:a,"onUpdate:modelValue":r[0]||(r[0]=t=>y.value=t),placeholder:"What are you working on?","data-testid":"time_entry_description",class:"w-full rounded-l-lg py-4 sm:py-2.5 px-3.5 border-b border-b-card-background-separator @2xl:px-4 text-base @4xl:text-lg text-text-primary font-medium bg-transparent border-none placeholder-muted focus:ring-0 transition",type:"text",onKeydown:[V(k,["enter"]),r[1]||(r[1]=V(t=>i.value=!1,["esc"]))],onBlur:A},null,544),[[ie,y.value]]),i.value&&j.value.length>0?(f(),T("div",{key:0,ref_key:"floating",ref:g,class:"z-50 w-full max-w-2xl",style:de(m(K))},[v("div",ut,[r[14]||(r[14]=v("div",{class:"text-text-tertiary text-xs font-semibold border-b border-border-tertiary px-2 py-1.5"}," Recently Tracked Time Entries ",-1)),v("div",ct,[(f(!0),T(se,null,me(j.value,t=>(f(),J(at,{key:t.id,"time-entry":t,highlighted:C.value===t.id,projects:n.projects,tasks:n.tasks,onMousedown:b=>w(t),onMouseenter:b=>C.value=t.id},null,8,["time-entry","highlighted","projects","tasks","onMousedown","onMouseenter"]))),128))])])],4)):F("",!0)]),v("div",dt,[v("div",mt,[x(Se,{project:e.value.project_id,"onUpdate:project":r[2]||(r[2]=t=>e.value.project_id=t),task:e.value.task_id,"onUpdate:task":r[3]||(r[3]=t=>e.value.task_id=t),"create-client":n.createClient,"can-create-project":n.canCreateProject,clients:n.clients,"create-project":n.createProject,currency:n.currency,projects:n.projects,tasks:n.tasks,"enable-estimated-time":n.enableEstimatedTime,onChanged:o},null,8,["project","task","create-client","can-create-project","clients","create-project","currency","projects","tasks","enable-estimated-time"])]),v("div",pt,[x(Ke,{modelValue:e.value.tags,"onUpdate:modelValue":r[4]||(r[4]=t=>e.value.tags=t),"create-tag":n.createTag,tags:n.tags,onChanged:r[5]||(r[5]=t=>n.$emit("updateTimeEntry"))},null,8,["modelValue","create-tag","tags"]),x(Ce,{modelValue:e.value.billable,"onUpdate:modelValue":r[6]||(r[6]=t=>e.value.billable=t),onChanged:r[7]||(r[7]=t=>n.$emit("updateTimeEntry"))},null,8,["modelValue"])]),v("div",vt,[x(Xe,{"current-time-entry":e.value,"onUpdate:currentTimeEntry":r[8]||(r[8]=t=>e.value=t),"live-timer":u.value,"onUpdate:liveTimer":r[9]||(r[9]=t=>u.value=t),onStartLiveTimer:r[10]||(r[10]=t=>s("startLiveTimer")),onStopLiveTimer:r[11]||(r[11]=t=>s("stopLiveTimer")),onUpdateTimer:r[12]||(r[12]=t=>s("updateTimeEntry")),onStartTimer:r[13]||(r[13]=t=>s("startTimer")),onKeydown:V(k,["enter"])},null,8,["current-time-entry","live-timer","onKeydown"])])])]),v("div",ft,[x(he,{active:n.isActive,size:"large",onChanged:z},null,8,["active"])])]))}}),Tt={class:"relative"},Bt=U({__name:"TimeTracker",props:{title:String},emits:["change"],setup(l,{emit:d}){const e=pe();D.extend(ye),D.extend(fe);const u=Y(),{currentTimeEntry:a,isActive:c,now:s}=L(u),{startLiveTimer:o,stopLiveTimer:w,setActiveState:$}=u,k=I(),{projects:M}=L(k),S=xe(),{tasks:z}=L(S),y=ee(),{clients:A}=L(y),P=d;E(()=>e.props.extensionMenu??[]),G(c,()=>{c.value?o():w(),P("change")}),ve(async()=>{e.props.auth.user.current_team_id&&(await u.fetchCurrentTimeEntry(),s.value=D().utc())});function j(){a.value.id&&Y().updateTimer()}const i=E(()=>a.value.organization_id&&te()&&a.value.organization_id!==te());async function p(r){const t=await I().createProject(r);return t&&(a.value.project_id=t.id),t}async function g(r){return await ee().createClient(r)}function K(){a.value.organization_id&&ke(a.value.organization_id)}async function C(r){return await Z().createTag(r)}const{tags:n}=L(Z());return(r,t)=>(f(),T(se,null,[x(le,{title:"Time Tracker",icon:m(Ne)},null,8,["icon"]),v("div",Tt,[i.value?(f(),J(Ge,{key:0,onSwitchOrganization:K})):F("",!0),x(gt,{"current-time-entry":m(a),"onUpdate:currentTimeEntry":t[0]||(t[0]=b=>W(a)?a.value=b:null),"live-timer":m(s),"onUpdate:liveTimer":t[1]||(t[1]=b=>W(s)?s.value=b:null),"create-project":p,"enable-estimated-time":m(Fe)(),"can-create-project":m(Oe)(),"create-client":g,clients:m(A),tags:m(n),tasks:m(z),projects:m(M),"create-tag":C,"is-active":m(c),currency:m(Pe)(),onStartLiveTimer:m(o),onStopLiveTimer:m(w),onStartTimer:t[2]||(t[2]=b=>m($)(!0)),onStopTimer:t[3]||(t[3]=b=>m($)(!1)),onUpdateTimeEntry:j},null,8,["current-time-entry","live-timer","enable-estimated-time","can-create-project","clients","tags","tasks","projects","is-active","currency","onStartLiveTimer","onStopLiveTimer"])])],64))}});export{Bt as _};
