import{_ as ge}from"./CardTitle.vue_vue_type_script_setup_true_lang-ClAjIdUA.js";import{d as R,e as k,o as T,a as f,b as w,w as q,g as Te,m as H,p as Q,l as $,c as X,n as ue,u as m,f as F,t as K,r as b,D as ce,ae as de,q as O,i as ee,B as W,s as U,k as ye,x as xe,F as me,h as ke,Q as be,v as we,G as te}from"./app-CZLkYVhz.js";import{d as P,u as _e}from"./utc-YQln_hJX.js";import{i as je,p as Ee,g as re,j as he}from"./time-DR3Bm2fi.js";import{a as pe,u as ne}from"./useCurrentTimeEntry-CruyZJNI.js";import{g as ie}from"./useUser-Dc3_Hjqo.js";import{s as $e}from"./useOrganization-Dnx8kCk3.js";import{a as ae,b as De,u as se}from"./useMembers-B2Kv7mzm.js";import{u as oe}from"./init-DIMnQ95t.js";import{_ as Ce}from"./TagDropdown.vue_vue_type_script_setup_true_lang-fidraWsZ.js";import{t as ve}from"./bundle-mjs-D696Ktp4.js";import{r as Se}from"./TagIcon-D32GhY_O.js";import{T as Pe,d as Ae}from"./AppLayout.vue_vue_type_script_setup_true_lang-7v21bPMn.js";import{_ as Be}from"./Dropdown.vue_vue_type_script_setup_true_lang-2TV_nqEm.js";import{_ as ze,a as Le}from"./TimeTrackerProjectTaskDropdown.vue_vue_type_script_setup_true_lang-Bx-SG6KH.js";import{r as Ve,_ as Me}from"./BillableToggleButton.vue_vue_type_script_setup_true_lang-9IV1xJ9S.js";import{o as le,u as Ue,v as Oe}from"./index-CHolqtoz.js";import{u as Fe,o as Re,s as Ne,f as qe,a as He,l as Qe}from"./useFocusGuards-DKIr8CEw.js";/* empty css                                                                             */import{_ as Ge}from"./ProjectBadge.vue_vue_type_script_setup_true_lang-CJeOBiho.js";import{g as Je}from"./money-BufCQq2I.js";import{b as Ke}from"./notification-BrLDF-00.js";import{q as We}from"./permissions-hl9spDHx.js";import"./theme-DlEllDdR.js";import{_ as Xe}from"./SecondaryButton.vue_vue_type_script_setup_true_lang-iS1Fl1UI.js";import{i as Ye}from"./billing-F8TVwX2K.js";import{r as Ze}from"./ClockIcon-DtFwBiYn.js";const Ie={class:"absolute w-full h-full backdrop-blur-sm z-10 flex items-center justify-center"},et={class:"flex space-x-3 items-center w-full z-20 justify-center"},tt=R({__name:"TimeTrackerRunningInDifferentOrganizationOverlay",emits:["switchOrganization"],setup(c){return(d,n)=>(T(),k("div",Ie,[n[3]||(n[3]=f("div",{class:"w-full h-[calc(100%+10px)] absolute bg-default-background opacity-75 backdrop-blur-sm"},null,-1)),f("div",et,[n[2]||(n[2]=f("span",{class:"text-sm text-text-primary"}," The Timer is running in a different organization. ",-1)),w(Xe,{onClick:n[0]||(n[0]=e=>d.$emit("switchOrganization"))},{default:q(()=>n[1]||(n[1]=[Te("Switch to organization")])),_:1,__:[1]})])]))}}),rt={key:0,class:"font-extrabold absolute rounded-full text-xs w-3 h-3 block top-[15px] rotate-[45deg] right-[14px] text-card-background"},nt=R({__name:"TimeTrackerTagDropdown",props:H({tags:{},createTag:{type:Function}},{modelValue:{default:[]},modelModifiers:{}}),emits:H(["changed"],["update:modelValue"]),setup(c,{emit:d}){const n=d,e=Q(c,"modelValue"),a=$(()=>e.value.length>0?" dark:text-[#BFC7D6] focus:text-input-select-active-hover hover:dark:text-[#7D88A1]":" dark:text-[#7D88A1] text-icon-default hover:text-[#BFC7D6] focus:text-icon-active");return(l,p)=>(T(),X(Ce,{modelValue:e.value,"onUpdate:modelValue":p[0]||(p[0]=u=>e.value=u),"create-tag":l.createTag,tags:l.tags,onChanged:p[1]||(p[1]=u=>n("changed"))},{trigger:q(()=>[f("button",{"data-testid":"tag_dropdown",class:ue(m(ve)(a.value,"","flex-shrink-0 ring-0    focus:outline-none focus:ring-2 focus:ring-ring transition focus-visible:bg-card-background-separator hover:bg-card-background-separator rounded-full w-10 h-10 flex items-center justify-center"))},[w(m(Se),{class:"w-5 h-5 lg:h-6 lg:w-6"}),e.value.length>1?(T(),k("span",rt,K(e.value.length),1)):F("",!0)],2)]),_:1},8,["modelValue","create-tag","tags"]))}}),it={class:"relative"},at=["onKeydown"],st=R({__name:"TimeTrackerRangeSelector",props:{currentTimeEntry:{required:!0},currentTimeEntryModifiers:{},liveTimer:{},liveTimerModifiers:{}},emits:H(["startLiveTimer","stopLiveTimer","updateTimer","startTimer"],["update:currentTimeEntry","update:liveTimer"]),setup(c,{emit:d}){const n=Q(c,"currentTimeEntry"),e=Q(c,"liveTimer"),a=d,l=b(!1);function p(s){s.target.select(),a("stopLiveTimer")}function u(){v(),l.value=!1;const s=document.activeElement;s==null||s.blur()}const _=$({get(){if(E.value!=="")return E.value;if(e.value&&n.value.start){const s=P(n.value.start),o=e.value.diff(s,"seconds");return je(o)}return null},set(s){s?E.value=s:E.value=""}});function v(){const{seconds:s}=Ee(E.value,"minutes");if(s&&s>0){const o=P().subtract(s,"s");n.value.start=o.utc().format(),n.value.id!==""?a("updateTimer"):a("startTimer")}e.value=P().utc(),E.value="",a("startLiveTimer")}const E=b("");async function N(s){re()(s).isBefore(re()())&&(n.value.start=s,n.value.id?a("updateTimer"):a("startTimer"))}const A=$(()=>n.value.start&&n.value.start!==""?n.value.start:P().utc().format()),D=b(null),B=b(null);function z(s){var y;const o=s.relatedTarget;o&&((y=window.document.body.querySelector("#app"))!=null&&y.contains(o))&&(l.value=!0)}function C(s){var o;if(l.value){s.preventDefault();const y=(o=B.value)==null?void 0:o.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');y==null||y.focus()}}function L(){var s;l.value=!1,(s=D.value)==null||s.focus()}return(s,o)=>(T(),k("div",it,[w(Be,{modelValue:l.value,"onUpdate:modelValue":o[2]||(o[2]=y=>l.value=y),align:"center","auto-focus":!1,"close-on-content-click":!1,onSubmit:L},{trigger:q(()=>[ce(f("input",{ref_key:"inputField",ref:D,"onUpdate:modelValue":o[0]||(o[0]=y=>_.value=y),placeholder:"00:00:00","data-testid":"time_entry_time",class:"w-[110px] lg:w-[130px] h-full dark:text-[#7D88A1] py-2.5 rounded-lg dark:border-[#7D88A1] border text-center px-4 text-base lg:text-lg font-semibold dark:bg-[#13192B] border-none placeholder-muted focus:ring-0 transition",type:"text",onFocus:p,onFocusin:z,onKeydown:[O(ee(C,["exact"]),["tab"]),o[1]||(o[1]=O(ee(y=>l.value=!1,["exact","shift"]),["tab"])),O(u,["enter"])],onBlur:v},null,40,at),[[de,_.value]])]),content:q(()=>[f("div",{ref_key:"timeRangeSelector",ref:B},[w(ze,{start:A.value,end:null,onChanged:N,onClose:L},null,8,["start"])],512)]),_:1},8,["modelValue"])]))}}),ot=["data-select-id"],lt={key:0,class:"text-sm font-medium whitespace-nowrap"},ut={key:1,class:"text-sm text-text-tertiary font-medium"},ct={key:0,class:"flex items-center lg:space-x-1 min-w-0"},dt={class:"whitespace-nowrap text-xs"},mt={key:1,class:"min-w-0 shrink text-xs truncate"},pt={key:1},vt=R({__name:"TimeTrackerRecentlyTrackedEntry",props:{timeEntry:{},highlighted:{type:Boolean},projects:{},tasks:{}},setup(c){const d=c,n=$(()=>{var a;return(a=d.projects)==null?void 0:a.find(l=>l.id===d.timeEntry.project_id)}),e=$(()=>{var a;return(a=d.tasks)==null?void 0:a.find(l=>l.id===d.timeEntry.task_id)});return(a,l)=>{var p,u;return T(),k("button",{tabindex:"-1","data-select-id":a.timeEntry.id,class:ue(m(ve)("px-2 py-1.5 flex justify-between items-center space-x-2 w-full rounded overflow-hidden  hover:dark:text-[#BFC7D6] ",d.highlighted&&"bg-card-background-active"))},[a.timeEntry.description!==""?(T(),k("span",lt,K(a.timeEntry.description),1)):(T(),k("span",ut," No Description ")),w(m(Ge),{ref:"projectDropdownTrigger",color:(p=n.value)==null?void 0:p.color,name:(u=n.value)==null?void 0:u.name,class:""},{default:q(()=>{var _;return[n.value?(T(),k("div",ct,[f("span",dt,K((_=n.value)==null?void 0:_.name),1),e.value?(T(),X(m(Ve),{key:0,class:"w-4 lg:w-5 text-text-secondary shrink-0"})):F("",!0),e.value?(T(),k("div",mt,K(e.value.name),1)):F("",!0)])):(T(),k("div",pt," No Project "))]}),_:1},8,["color","name"])],10,ot)}}});function ft(c,d,n,e){function a(){if(p.value){const u=c.value.indexOf(p.value);u===0?d.value=n(c.value[c.value.length-1]):d.value=n(c.value[u-1])}else d.value=n(c.value[c.value.length-1])}function l(){if(p.value){const u=c.value.indexOf(p.value);u===c.value.length-1?d.value=n(c.value[0]):d.value=n(c.value[u+1])}else d.value=n(c.value[0])}const p=$(()=>c.value.find(u=>n(u)===d.value));le("ArrowDown",u=>{e.value===!0&&(l(),u.preventDefault())}),le("ArrowUp",u=>{e.value===!0&&(a(),u.preventDefault())}),W(e,u=>{u===!1&&(d.value=null)})}const gt={class:"flex items-center relative @container","data-testid":"dashboard_timer"},Tt={class:"flex grid sm:grid-cols-8 md:grid-cols-8 xl:grid-cols-8 2xl:grid-cols-9 @2xl:flex-row w-full justify-between relative rounded-lg dark:bg-[#13192B] bg-white transition shadow"},yt={class:"2xl:col-span-3 xl:col-span-3 md:col-span-8 sm:col-span-3 flex-1 items-center pr-6 w-full"},xt={class:"rounded-lg w-full fixed min-w-xl top-0 left-0 overflow-none shadow dark:bg-[#13192B] bg-white border dark:border-[#5D6370]"},kt={class:"text-text-secondary py-1 px-1.5"},bt={class:"flex grid grid-cols-4 2xl:col-span-5 xl:col-span-4 md:col-span-7 sm:col-span-3 items-center truncate justify-between pl-2 shrink min-w-0"},wt={class:"flex flex-1 items-center col-span-2 @2xl:w-auto shrink min-w-0"},_t={class:"flex flex-1 grid grid-cols-2 items-center col-span-1 @2xl:space-x-2 px-2 @2xl:px-4"},jt={class:"flex-1 col-span-1"},Et={class:"flex 2xl:col-span-1 xl:col-span-1 md:col-span-1 sm:col-span-3 absolute sm:relative top-[6px] sm:top-0 right-0"},ht=R({__name:"TimeTrackerControls",props:H({projects:{},tasks:{},tags:{},clients:{},createTag:{type:Function},createProject:{type:Function},createClient:{type:Function},isActive:{type:Boolean},currency:{},enableEstimatedTime:{type:Boolean},canCreateProject:{type:Boolean}},{currentTimeEntry:{required:!0},currentTimeEntryModifiers:{},liveTimer:{required:!0},liveTimerModifiers:{}}),emits:H(["startTimer","stopTimer","updateTimeEntry","startLiveTimer","stopLiveTimer","discard","reset"],["update:currentTimeEntry","update:liveTimer"]),setup(c,{emit:d}){const n=Ke(),e=Q(c,"currentTimeEntry"),a=Q(c,"liveTimer"),l=b(null),p=b(null),u=b(null),_=c,v=d;function E(){B(),v("updateTimeEntry")}function N(t){A(t),_.isActive?v("updateTimeEntry"):v("startTimer")}function A(t){e.value.description=t.description,e.value.project_id=t.project_id,e.value.task_id=t.task_id,e.value.tags=t.tags,e.value.billable=t.billable}function D(){if(x.value){const t=V.value.find(r=>r.id===x.value);t&&(A(t),S.value=!1)}else e.value.description=o.value;_.isActive?v("updateTimeEntry"):v("startTimer")}function B(){const t=_.projects.find(r=>r.id===e.value.project_id);t&&(e.value.billable=t.is_billable)}const z=b(!1),C=b(!1);function L(t){z.value=t}function s(t){var r;t?(v("startTimer"),C.value||(r=l.value)==null||r.focus()):(o.value||n.addNotification("error","Description is Empty","Please Input your Description you've working on."),e.value.project_id||n.addNotification("error","Project is Empty","Please Choose Project you've working on."),e.value.task_id?v("stopTimer"):n.addNotification("error","Task is Empty","Please Choose Task you've working on."))}const o=b(e.value.description);W(()=>e.value.description,()=>{o.value=e.value.description});function y(){e.value.description!==o.value&&(e.value.description=o.value,v("updateTimeEntry"))}const{timeEntries:Y}=U(pe()),V=$(()=>Y.value.filter(i=>i.end!==null).filter((i,M,G)=>M===G.findIndex(h=>h.description===i.description&&h.task_id===i.task_id&&h.project_id===i.project_id&&h.tags.length===i.tags.length&&h.tags.every(J=>i.tags.includes(J))&&h.billable===i.billable)).filter(i=>{var M,G,h,J;return(J=(M=i.description)==null?void 0:M.toLowerCase())==null?void 0:J.includes(((h=(G=o.value)==null?void 0:G.toLowerCase())==null?void 0:h.trim())||"")}).slice(0,5)),S=b(!1),{focused:Z}=Ue(l);W(Z,t=>{ye(()=>{S.value=t,t||(C.value=!0,setTimeout(()=>{C.value=!1},100))})});const I=Oe("(max-width: 640px)"),j=b(null),{floatingStyles:g}=Fe(l,j,{placement:"bottom-start",whileElementsMounted:He,middleware:[Re(10),...I.value?[]:[Ne({limiter:Qe({offset:5})}),qe({fallbackAxisSideDirection:"start"})]]}),x=b(null),fe=(t,r)=>{v("discard",t,[r]),v("reset")};return ft(V,x,t=>t.id,S),(t,r)=>(T(),k("div",gt,[f("div",Tt,[f("div",yt,[ce(f("input",{ref_key:"currentTimeEntryDescriptionInput",ref:l,"onUpdate:modelValue":r[0]||(r[0]=i=>o.value=i),placeholder:"What are you working on?","data-testid":"time_entry_description",class:"w-full rounded-l-lg py-4 sm:py-2.5 px-3.5 @2xl:px-4 text-base text-text-primary font-medium bg-transparent border-none placeholder-muted focus:ring-0 transition",type:"text",required:"",onKeydown:[O(D,["enter"]),r[1]||(r[1]=O(i=>S.value=!1,["esc"]))],onBlur:y},null,544),[[de,o.value]]),S.value&&V.value.length>0?(T(),k("div",{key:0,ref_key:"floating",ref:j,class:"z-50 absolute w-full",style:xe(m(g))},[f("div",xt,[r[15]||(r[15]=f("div",{class:"text-text-tertiary text-xs font-semibold px-2 py-1.5"}," Recently Tracked Time Entries ",-1)),f("div",kt,[(T(!0),k(me,null,ke(V.value,i=>(T(),X(vt,{key:i.id,"time-entry":i,highlighted:x.value===i.id,projects:t.projects,tasks:t.tasks,onMousedown:M=>N(i),onMouseenter:M=>x.value=i.id},null,8,["time-entry","highlighted","projects","tasks","onMousedown","onMouseenter"]))),128))])])],4)):F("",!0)]),f("div",bt,[f("div",wt,[w(Le,{project:e.value.project_id,"onUpdate:project":r[2]||(r[2]=i=>e.value.project_id=i),task:e.value.task_id,"onUpdate:task":r[3]||(r[3]=i=>e.value.task_id=i),"create-client":t.createClient,"can-create-project":t.canCreateProject,clients:t.clients,"create-project":t.createProject,currency:t.currency,projects:t.projects,tasks:t.tasks,"enable-estimated-time":t.enableEstimatedTime,class:"border-[#77D36F] truncate bg-[#D4FFD1] hover:bg-[#C1F7B0] dark:border-[#5D6370] dark:bg-[#13192B] dark:hover:bg-[#0C101E]",setOpen:L,open:z.value,ref_key:"currentTimeEntryProjectInput",ref:p,onChanged:E},null,8,["project","task","create-client","can-create-project","clients","create-project","currency","projects","tasks","enable-estimated-time","open"])]),f("div",_t,[w(nt,{modelValue:e.value.tags,"onUpdate:modelValue":r[4]||(r[4]=i=>e.value.tags=i),ref_key:"currentTimeEntryTaskInput",ref:u,"create-tag":t.createTag,tags:t.tags,onChanged:r[5]||(r[5]=i=>t.$emit("updateTimeEntry"))},null,8,["modelValue","create-tag","tags"]),w(Me,{modelValue:e.value.billable,"onUpdate:modelValue":r[6]||(r[6]=i=>e.value.billable=i),onChanged:r[7]||(r[7]=i=>t.$emit("updateTimeEntry"))},null,8,["modelValue"])]),f("div",jt,[w(st,{"current-time-entry":e.value,"onUpdate:currentTimeEntry":r[8]||(r[8]=i=>e.value=i),"live-timer":a.value,"onUpdate:liveTimer":r[9]||(r[9]=i=>a.value=i),onStartLiveTimer:r[10]||(r[10]=i=>v("startLiveTimer")),onStopLiveTimer:r[11]||(r[11]=i=>v("stopLiveTimer")),onUpdateTimer:r[12]||(r[12]=i=>v("updateTimeEntry")),onStartTimer:r[13]||(r[13]=i=>v("startTimer")),onKeydown:O(D,["enter"])},null,8,["current-time-entry","live-timer","onKeydown"])])]),f("div",Et,[w(Pe,{active:t.isActive,size:"large",onChanged:s},null,8,["active"]),t.isActive?(T(),k("button",{key:0,onClick:r[14]||(r[14]=i=>fe(t.isActive,e.value)),title:"Discard Entry",class:"p-2 rounded-full hover:bg-red-100 text-red-600 w-10 h-10 ml-3 text-center align-center flex"},[w(m(Ae),{class:"flex-1 w-5 h-5"})])):F("",!0)])])]))}}),$t={class:"relative dark:text-[#7D88A1]"},tr=R({__name:"TimeTracker",emits:["change"],setup(c,{emit:d}){const n=be();P.extend(he),P.extend(_e);const e=ne(),{currentTimeEntry:a,isActive:l,now:p}=U(e),{startLiveTimer:u,stopLiveTimer:_,setActiveState:v}=e,{discardTimer:E}=pe(),N=ae(),{projects:A}=U(N),D=De(),{tasks:B}=U(D),z=se(),{clients:C}=U(z),L=d;W(l,()=>{l.value?u():_(),L("change")}),we(async()=>{n.props.auth.user.current_team_id&&(await e.fetchCurrentTimeEntry(),p.value=P().utc())});function s(){a.value.id&&ne().updateTimer()}const o=$(()=>a.value.organization_id&&ie()&&a.value.organization_id!==ie());async function y(j){const g=await ae().createProject(j);return g&&(a.value.project_id=g.id),g}async function Y(j){return await se().createClient(j)}function V(){a.value.organization_id&&$e(a.value.organization_id)}async function S(j){return await oe().createTag(j)}const{tags:Z}=U(oe()),I=$(()=>{const j=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});return[...B.value].sort((g,x)=>j.compare(g.name,x.name))});return(j,g)=>(T(),k(me,null,[w(ge,{title:"Time Tracker",icon:m(Ze),class:"dark:text-[#7D88A1] w-full flex-1"},null,8,["icon"]),f("div",$t,[o.value?(T(),X(tt,{key:0,onSwitchOrganization:V})):F("",!0),w(ht,{"current-time-entry":m(a),"onUpdate:currentTimeEntry":g[0]||(g[0]=x=>te(a)?a.value=x:null),"live-timer":m(p),"onUpdate:liveTimer":g[1]||(g[1]=x=>te(p)?p.value=x:null),"create-project":y,"enable-estimated-time":m(Ye)(),"can-create-project":m(We)(),"create-client":Y,clients:m(C),tags:m(Z),tasks:I.value,projects:m(A),"create-tag":S,"is-active":m(l),currency:m(Je)(),onStartLiveTimer:m(u),onReset:g[2]||(g[2]=x=>m(e).fetchCurrentTimeEntry()),onStopLiveTimer:m(_),onStartTimer:g[3]||(g[3]=x=>m(v)(!0)),onStopTimer:g[4]||(g[4]=x=>m(v)(!1)),onDiscard:m(E),onUpdateTimeEntry:s},null,8,["current-time-entry","live-timer","enable-estimated-time","can-create-project","clients","tags","tasks","projects","is-active","currency","onStartLiveTimer","onStopLiveTimer","onDiscard"])])],64))}});export{tr as _};
//# sourceMappingURL=TimeTracker.vue_vue_type_script_setup_true_lang-BghaeNoS.js.map
