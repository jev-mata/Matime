{"version":3,"file":"approval-BKVyEbud.js","sources":["../../../extensions/Timesheet/resources/js/Pages/approval.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport AppLayout from \"@/Layouts/AppLayout.vue\";\r\nimport TimeTracker from \"@/Components/TimeTracker.vue\";\r\nimport MainContainer from \"@/packages/ui/src/MainContainer.vue\";\r\n\r\nimport { ClockIcon } from \"@heroicons/vue/24/outline\";\r\nimport { usePage } from \"@inertiajs/vue3\";\r\n\r\nimport type { Tag } from '@/packages/api/src';\r\nimport { useQueryClient } from \"@tanstack/vue-query\";\r\nimport { computed } from \"vue\";\r\nimport axios from \"axios\";\r\nimport { ref } from \"vue\";\r\nimport dayjs from \"dayjs\";\r\n\r\nconst queryClient = useQueryClient();\r\nconst refreshDashboardData = () => {\r\n  // Invalidate all dashboard queries to trigger refetching\r\n  queryClient.invalidateQueries({ queryKey: [\"latestTasks\"] });\r\n  queryClient.invalidateQueries({ queryKey: [\"lastSevenDays\"] });\r\n  queryClient.invalidateQueries({ queryKey: [\"dailyTrackedHours\"] });\r\n  queryClient.invalidateQueries({ queryKey: [\"latestTeamActivity\"] });\r\n  queryClient.invalidateQueries({ queryKey: [\"weeklyProjectOverview\"] });\r\n  queryClient.invalidateQueries({ queryKey: [\"totalWeeklyTime\"] });\r\n  queryClient.invalidateQueries({ queryKey: [\"totalWeeklyBillableTime\"] });\r\n  queryClient.invalidateQueries({ queryKey: [\"totalWeeklyBillableAmount\"] });\r\n  queryClient.invalidateQueries({ queryKey: [\"weeklyHistory\"] });\r\n  queryClient.invalidateQueries({ queryKey: [\"timeEntries\"] });\r\n};\r\n\r\nconst page = usePage<{\r\n  entries: any[];\r\n  totalHours: string;\r\n  totalHoursNotForm: any;\r\n  isSubmit: boolean;\r\n  from: string;\r\n  to: string;\r\n  timesheet: any[];\r\n\r\n}>();\r\n\r\nfunction goBack() {\r\n  window.history.back();\r\n}\r\nconst form = ref({\r\n  date_start: '',\r\n  date_end: '',\r\n  hours: page.props.totalHoursNotForm,\r\n})\r\n\r\nfunction formatDate2(dateStr: string) {\r\n  const date = new Date(dateStr)\r\n  return date.toLocaleDateString('en-US', {\r\n    month: 'long',\r\n    day: 'numeric',\r\n    year: 'numeric'\r\n  })\r\n}\r\nconst submit = async () => {\r\n  if (!page.props.isSubmit) {\r\n\r\n    await axios.post('/api/time/submit', form.value)\r\n    // load()\r\n    console.log('is unSubmit');\r\n  } else {\r\n    await axios.post('/api/time/unsubmit', form.value)\r\n\r\n    console.log('isSubmit');\r\n  }\r\n  goBack();\r\n\r\n}\r\nfunction formatDate(date: string) {\r\n  return new Date(date).toLocaleDateString('en-US', {\r\n    weekday: 'long',\r\n    year: 'numeric',\r\n    month: 'long',\r\n    day: '2-digit'\r\n  })\r\n}\r\nconst formattedFrom = computed(() => formatDate2(page.props.from))\r\nconst formattedTo = computed(() => formatDate2(page.props.to))\r\n\r\nfunction formatTime(dateString) {\r\n  return dateString ? dayjs(dateString).format('hh:mm:ss A') : '';\r\n}\r\nfunction duration(entry: { start: string; end: string }) {\r\n  const start = new Date(entry.start).getTime();\r\n  const end = new Date(entry.end).getTime();\r\n\r\n  if (isNaN(start) || isNaN(end)) return '0h 0m';\r\n\r\n  const diffInMinutes = Math.floor((end - start) / (1000 * 60));\r\n  const hours = Math.floor(diffInMinutes / 60);\r\n  const minutes = diffInMinutes % 60;\r\n\r\n  return `${hours}h ${minutes}m`;\r\n}\r\n\r\n</script>\r\n\r\n<template>\r\n  <AppLayout title=\"Dashboard\" data-testid=\"dashboard_view\">\r\n\r\n    <MainContainer\r\n      class=\"grid gap-5 sm:gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 pt-3 sm:pt-5 pb-4 sm:pb-6 border-b border-default-background-separator items-stretch\">\r\n      <div @click.self=\"goBack\" class=\"fixed inset-0 z-50 flex items-center justify-center\"\r\n        style=\"background-color: rgba(0,0,0,0.8);\">\r\n\r\n        <!-- Modal -->\r\n        <div class=\" my-1 p-5 border-2 \" style=\"width: 55%;\">\r\n          <div class=\"col-span-full my-1 py-1\">\r\n            <h2 class=\"text-lg font-semibold mb-1\">My Entries</h2>\r\n            <div class=\"text-md mb-2\">{{ formattedFrom }} - {{ formattedTo }}</div>\r\n            <div class=\"max-h-20 overflow-y-scroll \" style=\"max-height: 50vh;\">\r\n              <div v-for=\"(entries, date2) in page.props.entries\" :key=\"date2\" class=\"mt-4 mb-4 border\">\r\n                <h2 class=\"font-semibold text-md py-2 px-3 bg-gray-900 text-gray-300\">{{ formatDate(date2) }}</h2>\r\n\r\n                <ul class=\"\">\r\n                  <li v-for=\"entry in entries\" :key=\"entry.id\" class=\"flex flex-row px-3 rounded border py-2\">\r\n\r\n                    <div class=\"basis-64 flex content-center\">\r\n                      {{ formatTime(entry.start) }} - {{ formatTime(entry.end) }}\r\n                    </div>\r\n                    <div class=\"basis-64 flex content-center\">\r\n                      {{ duration(entry) }} - {{ entry.description || 'No description' }}\r\n                    </div>\r\n                    <div class=\"basis-64\">\r\n\r\n                      <ProjectBadge v-if=\"entry.project\" :color=\"entry.project.color\" :size=\"'large'\" :border=\"true\"\r\n                        :class=\"'focus:border-border-tertiary w-full focus:outline-0 focus:bg-card-background-separator min-w-0 relative '\r\n                          \">\r\n\r\n                        <div class=\"flex items-center lg:space-x-1 min-w-0\">\r\n                          <span class=\"whitespace-nowrap text-xs lg:text-sm\">\r\n                            {{ entry.project.name }}\r\n                          </span>\r\n                          <ChevronRightIcon v-if=\"entry.task\" class=\"w-4 lg:w-5 text-text-secondary shrink-0\">\r\n                          </ChevronRightIcon>\r\n                          <div v-if=\"entry.task\" class=\"min-w-0 shrink text-xs lg:text-sm truncate\">\r\n                            {{ entry.task.name }}\r\n                          </div>\r\n                        </div>\r\n                      </ProjectBadge>\r\n                    </div>\r\n                    <div class=\"basis-64 overflow-hidden\">\r\n                      <div v-if=\"entry.tags.length > 0\" class=\" w-full\">\r\n                        <TagBadge class=\"truncate text-ellipsis overflow-hidden whitespace-nowrap\" :border=\"false\"\r\n                          size=\"large\" :name=\"entry.tags.map((tag: Tag) => tag.name).join(', ')\" />\r\n                      </div>\r\n                    </div>\r\n\r\n\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n\r\n            </div>\r\n\r\n            <div\r\n              class=\" text-muted-foreground text-sm bold text-text-primary font-semibold text-sm lg:text-base flex items-center space-x-2 lg:space-x-2.5\">\r\n              <component :is=\"ClockIcon\" v-if=\"ClockIcon\" class=\"w-5 lg:w-4 text-icon-default mr-2\"></component>\r\n              <div>{{ page.props.totalHours }}</div>\r\n            </div>\r\n          </div>\r\n          <form @submit.prevent=\"submit\" class=\"space-y-4 w-full\">\r\n            <div class=\"flex w-full items-center space-x-2 lg:space-x-2.5\">\r\n\r\n              <Button @click.prevent=\"goBack\" class=\"px-4 py-2 bg-blue-600 text-white rounded\">\r\n                Close\r\n              </Button>\r\n              <Button type=\"submit\" :class=\"' px-4 py-2 bg-green-600 text-white rounded'\">Reject</Button>\r\n              <Button type=\"submit\" :class=\"'px-4 py-2 bg-red-600 text-white rounded'\">Approve</Button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n\r\n    </MainContainer>\r\n  </AppLayout>\r\n</template>"],"names":["useQueryClient","page","usePage","goBack","form","ref","formatDate2","dateStr","submit","axios","formatDate","date","formattedFrom","computed","formattedTo","formatTime","dateString","dayjs","duration","entry","start","end","diffInMinutes","hours","minutes","_createBlock","AppLayout","_createVNode","MainContainer","_createElementVNode","_hoisted_1","_hoisted_2","_cache","_hoisted_3","_toDisplayString","_hoisted_4","_createElementBlock","_Fragment","_renderList","_unref","entries","date2","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_component_ProjectBadge","_normalizeClass","_hoisted_10","_hoisted_11","_component_ChevronRightIcon","_openBlock","_hoisted_12","_hoisted_13","_hoisted_14","_component_TagBadge","tag","_hoisted_15","ClockIcon","_resolveDynamicComponent","_hoisted_16","_component_Button"],"mappings":"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"}